{
  "components.json": "{\n  \"$schema\": \"https://ui.shadcn.com/schema.json\",\n  \"style\": \"new-york\",\n  \"rsc\": true,\n  \"tsx\": false,\n  \"tailwind\": {\n    \"config\": \"\",\n    \"css\": \"src/app/globals.css\",\n    \"baseColor\": \"neutral\",\n    \"cssVariables\": true,\n    \"prefix\": \"\"\n  },\n  \"iconLibrary\": \"lucide\",\n  \"aliases\": {\n    \"components\": \"@/components\",\n    \"utils\": \"@/lib/utils\",\n    \"ui\": \"@/components/ui\",\n    \"lib\": \"@/lib\",\n    \"hooks\": \"@/hooks\"\n  },\n  \"registries\": {}\n}\n",
  "jsconfig.json": "{\n  \"compilerOptions\": {\n    \"paths\": {\n      \"@/*\": [\"./src/*\"]\n    }\n  }\n}\n",
  "package-lock.json": "{\n  \"name\": \"arkin\",\n  \"version\": \"0.1.0\",\n  \"lockfileVersion\": 3,\n  \"requires\": true,\n  \"packages\": {\n    \"\": {\n      \"name\": \"arkin\",\n      \"version\": \"0.1.0\",\n      \"dependencies\": {\n        \"@radix-ui/react-slot\": \"^1.2.4\",\n        \"@radix-ui/react-switch\": \"^1.2.6\",\n        \"@reduxjs/toolkit\": \"^2.11.0\",\n        \"@stripe/react-stripe-js\": \"^5.4.1\",\n        \"@stripe/stripe-js\": \"^8.5.3\",\n        \"bcryptjs\": \"^3.0.3\",\n        \"class-variance-authority\": \"^0.7.1\",\n        \"cloudinary\": \"^2.8.0\",\n        \"clsx\": \"^2.1.1\",\n        \"lucide-react\": \"^0.555.0\",\n        \"mongoose\": \"^9.0.0\",\n        \"motion\": \"^12.23.25\",\n        \"next\": \"^16.0.7\",\n        \"next-auth\": \"^4.24.13\",\n        \"nodemailer\": \"^7.0.11\",\n        \"razorpay\": \"^2.9.6\",\n        \"react\": \"19.2.0\",\n        \"react-dom\": \"19.2.0\",\n        \"react-hot-toast\": \"^2.6.0\",\n        \"react-redux\": \"^9.2.0\",\n        \"stripe\": \"^20.0.0\",\n        \"tailwind-merge\": \"^3.4.0\"\n      },\n      \"devDependencies\": {\n        \"@tailwindcss/postcss\": \"^4\",\n        \"eslint\": \"^9\",\n        \"eslint-config-next\": \"16.0.6\",\n        \"tailwindcss\": \"^4\",\n        \"tw-animate-css\": \"^1.4.0\"\n      }\n    },\n    \"node_modules/@alloc/quick-lru\": {\n      \"version\": \"5.2.0\",\n      \"dev\": true,\n      \"license\": \"MIT\",\n      \"engines\": {\n        \"node\": \">=10\"\n      },\n      \"funding\": {\n        \"url\": \"https://github.com/sponsors/sindresorhus\"\n      }\n    },\n    \"node_modules/@babel/code-frame\": {\n      \"version\": \"7.27.1\",\n      \"dev\": true,\n      \"license\": \"MIT\",\n      \"dependencies\": {\n        \"@babel/helper-validator-identifier\": \"^7.27.1\",\n        \"js-tokens\": \"^4.0.0\",\n        \"picocolors\": \"^1.1.1\"\n      },\n      \"engines\": {\n        \"node\": \">=6.9.0\"\n      }\n    },\n    \"node_modules/@babel/compat-data\": {\n      \"version\": \"7.28.5\",\n      \"dev\": true,\n      \"license\": \"MIT\",\n      \"engines\": {\n        \"node\": \">=6.9.0\"\n      }\n    },\n    \"node_modules/@babel/core\": {\n      \"version\": \"7.28.5\",\n      \"dev\": true,\n      \"license\": \"MIT\",\n      \"dependencies\": {\n        \"@babel/code-frame\": \"^7.27.1\",\n        \"@babel/generator\": \"^7.28.5\",\n        \"@babel/helper-compilation-targets\": \"^7.27.2\",\n        \"@babel/helper-module-transforms\": \"^7.28.3\",\n        \"@babel/helpers\": \"^7.28.4\",\n        \"@babel/parser\": \"^7.28.5\",\n        \"@babel/template\": \"^7.27.2\",\n        \"@babel/traverse\": \"^7.28.5\",\n        \"@babel/types\": \"^7.28.5\",\n        \"@jridgewell/remapping\": \"^2.3.5\",\n        \"convert-source-map\": \"^2.0.0\",\n        \"debug\": \"^4.1.0\",\n        \"gensync\": \"^1.0.0-beta.2\",\n        \"json5\": \"^2.2.3\",\n        \"semver\": \"^6.3.1\"\n      },\n      \"engines\": {\n        \"node\": \">=6.9.0\"\n      },\n      \"funding\": {\n        \"type\": \"opencollective\",\n        \"url\": \"https://opencollective.com/babel\"\n      }\n    },\n    \"node_modules/@babel/core/node_modules/json5\": {\n      \"version\": \"2.2.3\",\n      \"dev\": true,\n      \"license\": \"MIT\",\n      \"bin\": {\n        \"json5\": \"lib/cli.js\"\n      },\n      \"engines\": {\n        \"node\": \">=6\"\n      }\n    },\n    \"node_modules/@babel/generator\": {\n      \"version\": \"7.28.5\",\n      \"dev\": true,\n      \"license\": \"MIT\",\n      \"dependencies\": {\n        \"@babel/parser\": \"^7.28.5\",\n        \"@babel/types\": \"^7.28.5\",\n        \"@jridgewell/gen-mapping\": \"^0.3.12\",\n        \"@jridgewell/trace-mapping\": \"^0.3.28\",\n        \"jsesc\": \"^3.0.2\"\n      },\n      \"engines\": {\n        \"node\": \">=6.9.0\"\n      }\n    },\n    \"node_modules/@babel/helper-compilation-targets\": {\n      \"version\": \"7.27.2\",\n      \"dev\": true,\n      \"license\": \"MIT\",\n      \"dependencies\": {\n        \"@babel/compat-data\": \"^7.27.2\",\n        \"@babel/helper-validator-option\": \"^7.27.1\",\n        \"browserslist\": \"^4.24.0\",\n        \"lru-cache\": \"^5.1.1\",\n        \"semver\": \"^6.3.1\"\n      },\n      \"engines\": {\n        \"node\": \">=6.9.0\"\n      }\n    },\n    \"node_modules/@babel/helper-globals\": {\n      \"version\": \"7.28.0\",\n      \"dev\": true,\n      \"license\": \"MIT\",\n      \"engines\": {\n        \"node\": \">=6.9.0\"\n      }\n    },\n    \"node_modules/@babel/helper-module-imports\": {\n      \"version\": \"7.27.1\",\n      \"dev\": true,\n      \"license\": \"MIT\",\n      \"dependencies\": {\n        \"@babel/traverse\": \"^7.27.1\",\n        \"@babel/types\": \"^7.27.1\"\n      },\n      \"engines\": {\n        \"node\": \">=6.9.0\"\n      }\n    },\n    \"node_modules/@babel/helper-module-transforms\": {\n      \"version\": \"7.28.3\",\n      \"dev\": true,\n      \"license\": \"MIT\",\n      \"dependencies\": {\n        \"@babel/helper-module-imports\": \"^7.27.1\",\n        \"@babel/helper-validator-identifier\": \"^7.27.1\",\n        \"@babel/traverse\": \"^7.28.3\"\n      },\n      \"engines\": {\n        \"node\": \">=6.9.0\"\n      },\n      \"peerDependencies\": {\n        \"@babel/core\": \"^7.0.0\"\n      }\n    },\n    \"node_modules/@babel/helper-string-parser\": {\n      \"version\": \"7.27.1\",\n      \"dev\": true,\n      \"license\": \"MIT\",\n      \"engines\": {\n        \"node\": \">=6.9.0\"\n      }\n    },\n    \"node_modules/@babel/helper-validator-identifier\": {\n      \"version\": \"7.28.5\",\n      \"dev\": true,\n      \"license\": \"MIT\",\n      \"engines\": {\n        \"node\": \">=6.9.0\"\n      }\n    },\n    \"node_modules/@babel/helper-validator-option\": {\n      \"version\": \"7.27.1\",\n      \"dev\": true,\n      \"license\": \"MIT\",\n      \"engines\": {\n        \"node\": \">=6.9.0\"\n      }\n    },\n    \"node_modules/@babel/helpers\": {\n      \"version\": \"7.28.4\",\n      \"dev\": true,\n      \"license\": \"MIT\",\n      \"dependencies\": {\n        \"@babel/template\": \"^7.27.2\",\n        \"@babel/types\": \"^7.28.4\"\n      },\n      \"engines\": {\n        \"node\": \">=6.9.0\"\n      }\n    },\n    \"node_modules/@babel/parser\": {\n      \"version\": \"7.28.5\",\n      \"dev\": true,\n      \"license\": \"MIT\",\n      \"dependencies\": {\n        \"@babel/types\": \"^7.28.5\"\n      },\n      \"bin\": {\n        \"parser\": \"bin/babel-parser.js\"\n      },\n      \"engines\": {\n        \"node\": \">=6.0.0\"\n      }\n    },\n    \"node_modules/@babel/runtime\": {\n      \"version\": \"7.28.4\",\n      \"resolved\": \"https://registry.npmjs.org/@babel/runtime/-/runtime-7.28.4.tgz\",\n      \"integrity\": \"sha512-\n\n// ‚úÇÔ∏è Truncated for AI (original 145288 characters)",
  "package.json": "{\n  \"name\": \"arkin\",\n  \"version\": \"0.1.0\",\n  \"private\": true,\n  \"scripts\": {\n    \"dev\": \"next dev\",\n    \"build\": \"next build\",\n    \"start\": \"next start\",\n    \"lint\": \"eslint\"\n  },\n  \"dependencies\": {\n    \"@radix-ui/react-slot\": \"^1.2.4\",\n    \"@radix-ui/react-switch\": \"^1.2.6\",\n    \"@reduxjs/toolkit\": \"^2.11.0\",\n    \"@stripe/react-stripe-js\": \"^5.4.1\",\n    \"@stripe/stripe-js\": \"^8.5.3\",\n    \"bcryptjs\": \"^3.0.3\",\n    \"class-variance-authority\": \"^0.7.1\",\n    \"cloudinary\": \"^2.8.0\",\n    \"clsx\": \"^2.1.1\",\n    \"lucide-react\": \"^0.555.0\",\n    \"mongoose\": \"^9.0.0\",\n    \"motion\": \"^12.23.25\",\n    \"next\": \"^16.0.7\",\n    \"next-auth\": \"^4.24.13\",\n    \"nodemailer\": \"^7.0.11\",\n    \"razorpay\": \"^2.9.6\",\n    \"react\": \"19.2.0\",\n    \"react-dom\": \"19.2.0\",\n    \"react-hot-toast\": \"^2.6.0\",\n    \"react-redux\": \"^9.2.0\",\n    \"stripe\": \"^20.0.0\",\n    \"tailwind-merge\": \"^3.4.0\"\n  },\n  \"devDependencies\": {\n    \"@tailwindcss/postcss\": \"^4\",\n    \"eslint\": \"^9\",\n    \"eslint-config-next\": \"16.0.6\",\n    \"tailwindcss\": \"^4\",\n    \"tw-animate-css\": \"^1.4.0\"\n  }\n}\n",
  "README.md": "This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://github.com/vercel/next.js/tree/canary/packages/create-next-app).\n\n## Getting Started\n\nFirst, run the development server:\n\n```bash\nnpm run dev\n# or\nyarn dev\n# or\npnpm dev\n# or\nbun dev\n```\n\nOpen [http://localhost:3000](http://localhost:3000) with your browser to see the result.\n\nYou can start editing the page by modifying `app/page.js`. The page auto-updates as you edit the file.\n\nThis project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.\n\n## Learn More\n\nTo learn more about Next.js, take a look at the following resources:\n\n- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.\n- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.\n\nYou can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!\n\n## Deploy on Vercel\n\nThe easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.\n\nCheck out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.\n",
  "src\\app\\(admin)\\admin\\add\\page.js": "import ProductForm from \"@/features/admin/components/ProductForm\";\r\n\r\nexport default function AddProductPage() {\r\n    return (\r\n        <div className=\" bg-gray-50/50 min-h-screen\">\r\n            <ProductForm />\r\n        </div>\r\n    );\r\n}",
  "src\\app\\(admin)\\admin\\edit\\[id]\\page.js": "import { getProductById } from \"@/features/admin/actions\";\r\nimport ProductForm from \"@/features/admin/components/ProductForm\";\r\nimport { notFound } from \"next/navigation\";\r\n\r\nexport default async function EditProductPage({ params }) {\r\n    const { id } = await params;\r\n    const product = await getProductById(id);\r\n\r\n    if (!product) {\r\n        return notFound();\r\n    }\r\n\r\n    return (\r\n        <div className=\" bg-gray-50/50 min-h-screen\">\r\n            <ProductForm initialData={product} isEditMode={true} />\r\n        </div>\r\n    );\r\n}",
  "src\\app\\(admin)\\admin\\orders\\page.js": "import { getAllOrders } from '@/features/admin/actions';\r\nimport AdminOrderList from '@/features/admin/components/AdminOrderList';\r\n\r\nexport const metadata = {\r\n  title: \"Order Management | Admin\",\r\n};\r\n\r\nexport default async function AdminOrdersPage({ searchParams }) {\r\n  // Await searchParams for Next.js 15+\r\n  const params = await searchParams;\r\n  \r\n  const page = Number(params?.page) || 1;\r\n  const status = params?.status || 'All';\r\n\r\n  const { orders, pagination } = await getAllOrders({ page, status });\r\n\r\n  return (\r\n    <div className='p-4 md:p-6 max-w-7xl mx-auto'>\r\n        <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4\">\r\n            <div>\r\n                <h1 className=\"text-2xl font-bold text-gray-800\">Orders</h1>\r\n                <p className=\"text-sm text-gray-500\">Track and manage customer shipments</p>\r\n            </div>\r\n            <div className=\"bg-indigo-50 text-indigo-700 px-4 py-1.5 rounded-full text-sm font-medium border border-indigo-100\">\r\n                {pagination.totalItems} Total Orders\r\n            </div>\r\n        </div>\r\n\r\n        <AdminOrderList \r\n            initialOrders={orders} \r\n            pagination={pagination} \r\n            currentStatus={status}\r\n        />\r\n    </div>\r\n  );\r\n}",
  "src\\app\\(admin)\\admin\\page.js": "import React from 'react';\r\nimport { getDashboardStats } from '@/features/admin/actions';\r\nimport { getVisitorStats } from '@/features/analytics/actions';\r\nimport AdminAnalytics from '@/features/admin/components/AdminAnalytics';\r\nimport VisitorAnalytics from '@/features/admin/components/VisitorAnalytics';\r\n\r\nexport const metadata = {\r\n  title: \"Admin Dashboard | Dream Collection\",\r\n};\r\n\r\nexport default async function AdminDashboard() {\r\n  // Parallel data fetching\r\n  const [stats, visitorStats] = await Promise.all([\r\n    getDashboardStats(),\r\n    getVisitorStats()\r\n  ]);\r\n\r\n  return (\r\n    // Added 'pb-24' for mobile nav clearance and responsive padding\r\n    <div className='p-4 md:p-6 max-w-7xl mx-auto pb-24 md:pb-8'>\r\n      <div className=\"flex flex-col mb-6 md:mb-8\">\r\n         <h1 className=\"text-xl md:text-2xl font-bold text-gray-800\">Dashboard</h1>\r\n         <p className=\"text-xs md:text-sm text-gray-500\">Overview of your store performance</p>\r\n      </div>\r\n      \r\n      <div className=\"space-y-6\">\r\n        {/* 1. Store KPI Cards */}\r\n        <section>\r\n           <AdminAnalytics stats={stats} />\r\n        </section>\r\n\r\n        {/* 2. Visitor Analytics Charts */}\r\n        <section>\r\n           <VisitorAnalytics stats={visitorStats} />\r\n        </section>\r\n      </div>\r\n    </div>\r\n  );\r\n}",
  "src\\app\\(admin)\\admin\\products\\page.js": "import React from 'react';\r\nimport { getProducts } from '@/features/product/actions';\r\nimport AdminProductTable from '@/features/admin/components/AdminProductTable';\r\n\r\nexport const metadata = {\r\n  title: \"Product Management | Dream Collection\",\r\n};\r\n\r\nexport default async function AdminProductsPage({ searchParams }) {\r\n  const params = await searchParams;\r\n  \r\n  const query = params?.query || '';\r\n  const category = params?.category || '';\r\n  const page = Number(params?.page) || 1;\r\n\r\n  // Fetch data\r\n  const { products, pagination } = await getProducts({ \r\n    query, \r\n    category, \r\n    page \r\n  });\r\n\r\n  return (\r\n    <div className=' md:p-6 max-w-7xl mx-auto'>\r\n      <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4\">\r\n         <div>\r\n            <h1 className=\"text-2xl font-bold text-gray-800\">Products</h1>\r\n            <p className=\"text-sm text-gray-500\">Manage your inventory and catalog</p>\r\n         </div>\r\n         <div className=\"bg-indigo-50 text-indigo-700 px-4 py-1.5 rounded-full text-sm font-medium border border-indigo-100\">\r\n            {pagination.totalItems} Items Found\r\n         </div>\r\n      </div>\r\n      \r\n      <AdminProductTable \r\n        initialProducts={products} \r\n        pagination={pagination}\r\n      />\r\n    </div>\r\n  );\r\n}",
  "src\\app\\(admin)\\admin\\settings\\page.js": "import { getStoreSettings } from \"@/features/admin/settings/actions\";\r\nimport SettingsLayout from \"@/features/admin/settings/components/SettingsLayout\";\r\n\r\nexport const metadata = {\r\n  title: \"Store Settings | Admin\",\r\n};\r\n\r\nexport default async function AdminSettingsPage() {\r\n  const settings = await getStoreSettings();\r\n\r\n  return (\r\n    <div className=\"max-w-6xl mx-auto p-6\">\r\n       <div className=\"mb-6\">\r\n          <h1 className=\"text-2xl font-bold text-gray-900\">Store Configuration</h1>\r\n          <p className=\"text-sm text-gray-500\">Manage payments, shipping, and store preferences.</p>\r\n       </div>\r\n       \r\n       <SettingsLayout initialSettings={settings} />\r\n    </div>\r\n  );\r\n}",
  "src\\app\\(admin)\\layout.js": "import { Geist, Geist_Mono } from \"next/font/google\";\r\nimport \"../../app/globals.css\";\r\nimport AdminNavbar from \"@/features/admin/components/AdminNavbar\";\r\nimport AdminSidebar from \"@/features/admin/components/AdminSidebar\";\r\nimport { getServerSession } from \"next-auth\";\r\nimport { authOptions } from \"@/lib/auth.config\";\r\nimport { redirect } from \"next/navigation\";\r\nimport { ToastProvider } from \"@/context/ToastContext\"; \r\n\r\n// ... font definitions ...\r\n\r\nexport const metadata = {\r\n  title: \"Admin Dashboard | Dream Collection\",\r\n  description: \"Manage products, orders, and store settings.\",\r\n};\r\n\r\nexport default async function AdminLayout({ children }) {\r\n  const session = await getServerSession(authOptions);\r\n\r\n  if (!session) {\r\n    redirect(\"/login?callbackUrl=/admin\");\r\n  }\r\n\r\n  if (session.user.role !== \"admin\") {\r\n    redirect(\"/\"); \r\n  }\r\n\r\n  return (\r\n    <div className={`antialiased min-h-screen flex flex-col bg-gray-50/30`}>\r\n        <ToastProvider>\r\n            {/* Navbar acts as the top control strip */}\r\n            <AdminNavbar />\r\n            \r\n            {/* Flex container for Sidebar + Content */}\r\n            <div className=\"flex flex-col md:flex-row flex-1 relative\">\r\n                <AdminSidebar />\r\n                \r\n                {/* Sidebar handles navigation (Left on Desktop, Bottom on Mobile) */}\r\n                \r\n                {/* Main Content Area */}\r\n                <main className=\"flex-1 w-full p-4 md:p-8 overflow-x-hidden pb-24 md:pb-8\">\r\n                    {children} \r\n                </main>\r\n            </div>\r\n        </ToastProvider>\r\n    </div>\r\n  );\r\n}",
  "src\\app\\(user)\\cart\\page.js": "\"use client\";\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { useAppSelector, useAppDispatch } from '@/lib/hooks';\r\nimport { addToCart, removeFromCart, decrementItem, setCart } from '@/features/cart/cartSlice';\r\nimport { validateCart } from '@/features/cart/actions';\r\nimport { useToast } from '@/context/ToastContext';\r\nimport { Trash2, Plus, Minus, ArrowRight, Loader2, AlertTriangle } from 'lucide-react';\r\n\r\nexport default function CartPage() {\r\n    const { items, totalPrice, totalQuantity } = useAppSelector((state) => state.cart);\r\n    const dispatch = useAppDispatch();\r\n    const { addToast } = useToast();\r\n    const [isValidating, setIsValidating] = useState(true);\r\n\r\n    // Sync & Validate on Mount\r\n    useEffect(() => {\r\n        const syncCart = async () => {\r\n            if (items.length === 0) {\r\n                setIsValidating(false);\r\n                return;\r\n            }\r\n\r\n            // Call Server to validate prices/stock\r\n            const result = await validateCart(items);\r\n            \r\n            // If server returns warnings, show them\r\n            if (result.warnings.length > 0) {\r\n                result.warnings.forEach(msg => addToast(msg, \"warning\"));\r\n                // Update Redux with the \"clean\" cart from server\r\n                dispatch(setCart(result.cart));\r\n            }\r\n            \r\n            setIsValidating(false);\r\n        };\r\n\r\n        syncCart();\r\n    }, []); // Run once on mount\r\n\r\n    const taxAmount = totalPrice * 0.02;\r\n    const finalTotal = totalPrice + taxAmount;\r\n\r\n    if (items.length === 0) {\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center py-20 px-4 text-center min-h-[calc(100vh-130px)]\">\r\n                <div className=\"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-6\">\r\n                    <AlertTriangle className=\"text-gray-400\" size={40} />\r\n                </div>\r\n                <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Your cart is empty</h2>\r\n                <p className=\"text-gray-500 mb-8 max-w-md\">Looks like you haven't added any Hot Wheels yet. Start collecting to fill it up!</p>\r\n                <Link href=\"/\">\r\n                    <button className=\"bg-indigo-600 text-white px-8 py-3 rounded-full hover:bg-indigo-700 transition font-medium\">\r\n                        Start Shopping\r\n                    </button>\r\n                </Link>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"flex flex-col md:flex-row py-12 max-w-7xl w-full px-6 mx-auto gap-8 lg:gap-12 min-h-[calc(100vh-130px)]\">\r\n            <div className='flex-1 max-w-4xl'>\r\n                <div className=\"flex justify-between items-center mb-6\">\r\n                    <h1 className=\"text-3xl font-bold text-gray-900\">\r\n                        Shopping Cart\r\n                    </h1>\r\n                    <span className=\"text-sm font-medium bg-gray-100 px-3 py-1 rounded-full text-gray-600\">\r\n                        {totalQuantity} Items\r\n                    </span>\r\n                </div>\r\n\r\n                {isValidating && (\r\n                    <div className=\"bg-blue-50 text-blue-700 px-4 py-3 rounded-lg mb-6 flex items-center gap-2 text-sm\">\r\n                        <Loader2 className=\"animate-spin\" size={16} /> Verifying latest prices and stock...\r\n                    </div>\r\n                )}\r\n\r\n                {/* Header Row */}\r\n                <div className=\"hidden md:grid grid-cols-[3fr_1fr_1fr] text-gray-500 text-xs font-semibold uppercase tracking-wider pb-3 border-b border-gray-200\">\r\n                    <p>Product</p>\r\n                    <p className=\"text-center\">Quantity</p>\r\n                    <p className=\"text-right\">Total</p>\r\n                </div>\r\n\r\n                {/* Cart Items */}\r\n                <div className=\"flex flex-col divide-y divide-gray-100\">\r\n                    {items.map((item) => (\r\n                        <div key={item._id} className=\"py-6 grid grid-cols-1 md:grid-cols-[3fr_1fr_1fr] gap-4 md:items-center\">\r\n                            \r\n                            {/* Product Info */}\r\n                            <div className=\"flex gap-4\">\r\n                                <div className=\"w-20 h-20 md:w-24 md:h-24 bg-gray-100 rounded-lg overflow-hidden shrink-0 border border-gray-200\">\r\n                                    <img className=\"w-full h-full object-cover mix-blend-multiply\" src={item.image} alt={item.name} />\r\n                                </div>\r\n                                <div className=\"flex flex-col justify-between py-1\">\r\n                                    <div>\r\n                                        <Link href={`/products/all/${item.slug || '#'}`} className=\"font-semibold text-gray-900 hover:text-indigo-600 transition line-clamp-1\">\r\n                                            {item.name}\r\n                                        </Link>\r\n                                        <p className=\"text-sm text-gray-500 mt-1\">{item.series} ‚Ä¢ {item.year}</p>\r\n                                    </div>\r\n                                    <p className=\"text-sm font-medium text-gray-900 md:hidden\">${item.price}</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Quantity Controls */}\r\n                            <div className=\"flex items-center md:justify-center\">\r\n                                <div className=\"flex items-center border border-gray-300 rounded-lg overflow-hidden bg-white shadow-sm\">\r\n                                    <button \r\n                                        onClick={() => dispatch(decrementItem(item._id))}\r\n                                        className=\"px-3 py-1.5 hover:bg-gray-50 transition text-gray-600 active:bg-gray-200\"\r\n                                    >\r\n                                        <Minus size={14} />\r\n                              \n\n// ‚úÇÔ∏è Truncated for AI (original 10948 characters)",
  "src\\app\\(user)\\checkout\\page.js": "import { getServerSession } from \"next-auth\";\r\nimport { authOptions } from \"@/lib/auth.config\";\r\nimport { redirect } from \"next/navigation\";\r\nimport { getUserAddresses } from \"@/features/user/actions\";\r\nimport { getStoreSettings } from \"@/features/admin/settings/actions\";\r\nimport Checkout from \"@/features/checkout/components/Checkout\";\r\nimport { PAYMENT_GATEWAYS } from \"@/features/admin/settings/modules/payments/paymentRegistry\";\r\n\r\nexport const metadata = {\r\n  title: \"Checkout | Dream Collection\",\r\n};\r\n\r\nexport default async function CheckoutPage() {\r\n  const session = await getServerSession(authOptions);\r\n\r\n  if (!session) {\r\n    redirect(\"/login?callbackUrl=/checkout\");\r\n  }\r\n\r\n  // Parallel Fetch: User Addresses & Store Settings\r\n  const [addresses, settings] = await Promise.all([\r\n     getUserAddresses(session.user.id).catch(() => []),\r\n     getStoreSettings().catch(() => ({}))\r\n  ]);\r\n\r\n  // Filter enabled gateways for the frontend\r\n  const enabledGateways = PAYMENT_GATEWAYS.filter(g => {\r\n     const config = settings.paymentGateways?.find(sg => sg.id === g.id);\r\n     return config?.enabled;\r\n  }).map(g => ({\r\n     ...g,\r\n     // Pass non-sensitive config (like instructions/UPI ID) to frontend if needed\r\n     config: settings.paymentGateways.find(sg => sg.id === g.id)?.config || {} \r\n  }));\r\n\r\n  return (\r\n    <div className=\"bg-gray-50 min-h-screen\">\r\n        <Checkout \r\n            userId={session.user.id} \r\n            savedAddresses={addresses || []} \r\n            availableGateways={enabledGateways}\r\n        />\r\n    </div>\r\n  );\r\n}",
  "src\\app\\(user)\\contact\\page.js": "import ContactUs from '@/components/ContactUs'\r\nimport React from 'react'\r\n\r\nfunction page() {\r\n  return (\r\n    <ContactUs/>\r\n  )\r\n}\r\n\r\nexport default page",
  "src\\app\\(user)\\layout.js": "import Navbar from \"@/components/layout/Navbar/Navbar\";\r\nimport Footer from \"@/components/layout/Footer\";\r\n\r\nexport default function UserLayout({ children }) {\r\n  return (\r\n    <>\r\n       <header className='text-center'>\r\n          <Navbar />\r\n        </header>\r\n        {children}\r\n      <Footer />\r\n    </>\r\n  );\r\n}\r\n",
  "src\\app\\(user)\\products\\[category]\\page.js": "import ProductCard from \"@/features/product/components/ProductCard\";\r\nimport { getProductsByCategory } from \"@/features/product/actions\";\r\nimport Link from \"next/link\";\r\n\r\nexport async function generateMetadata({ params }) {\r\n    const { category } = await params;\r\n    return {\r\n        title: `${decodeURIComponent(category)} | Dream Collection`\r\n    }\r\n}\r\n\r\nexport default async function CategoryPage({ params }) {\r\n  const { category } = await params;\r\n  const decodedCategory = decodeURIComponent(category);\r\n  const products = await getProductsByCategory(category);\r\n\r\n  return (\r\n    <div className=\"flex flex-col items-center p-8 md:px-24 bg-gray-50/30 min-h-screen\">\r\n      <div className=\"w-full max-w-7xl\">\r\n        \r\n        {/* Breadcrumb */}\r\n        <p className=\"text-sm text-gray-500 mb-8\">\r\n            <Link href=\"/\" className=\"hover:text-indigo-600\">Home</Link> / \r\n            <span className=\"text-gray-900 ml-1\">{decodedCategory}</span>\r\n        </p>\r\n\r\n        {products.length > 0 ? (\r\n          <div className='grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6  max-w-7xl mx-auto -z-10'>\r\n            {products.map((product) => (\r\n              <ProductCard key={product._id} product={product} />\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <div className=\"text-center py-20 text-gray-500\">\r\n            No products found in this category.\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}   ",
  "src\\app\\(user)\\products\\[category]\\[slug]\\page.js": "import { getProductBySlug } from \"@/features/product/actions\";\r\nimport ProductDetail from \"@/features/product/components/ProductDetail\";\r\nimport { notFound } from \"next/navigation\";\r\n\r\nexport async function generateMetadata({ params }) {\r\n  const { slug } = await params;\r\n  const product = await getProductBySlug(slug);\r\n\r\n  if (!product) return { title: \"Not Found\" };\r\n\r\n  return {\r\n    title: `${product.seoTitle || product.name} | Dream Collection`,\r\n    description: product.seoDescription || product.description,\r\n  };\r\n}\r\n\r\nexport default async function ProductPage({ params }) {\r\n  const { slug } = await params;\r\n  const product = await getProductBySlug(slug);\r\n\r\n  if (!product) {\r\n    return notFound();\r\n  }\r\n\r\n  return (\r\n        <ProductDetail product={product} />\r\n  );\r\n}",
  "src\\app\\(user)\\profile\\page.js": "import { getServerSession } from \"next-auth\";\r\nimport { authOptions } from \"@/lib/auth.config\";\r\nimport { redirect } from \"next/navigation\";\r\nimport { getUserAddresses, getUserOrders } from \"@/features/user/actions\";\r\nimport UserProfile from \"@/features/user/components/UserProfile\";\r\n\r\nexport const metadata = {\r\n  title: \"My Profile | Dream Collection\",\r\n};\r\n\r\nexport default async function ProfilePage() {\r\n  const session = await getServerSession(authOptions);\r\n\r\n  if (!session) {\r\n    redirect(\"/login\");\r\n  }\r\n\r\n  // Parallel data fetching for speed\r\n  const [addresses, orders] = await Promise.all([\r\n    getUserAddresses(session.user.id),\r\n    getUserOrders(session.user.id)\r\n  ]);\r\n\r\n  return (\r\n    <div className=\"bg-gray-50 min-h-screen\">\r\n       <UserProfile \r\n          user={session.user} \r\n          addresses={addresses} \r\n          orders={orders} \r\n       />\r\n    </div>\r\n  );\r\n}",
  "src\\app\\(user)\\reset-password\\[token]\\page.js": "import ResetPasswordForm from \"@/features/auth/components/ResetPasswordForm\";\r\n\r\nexport const metadata = {\r\n  title: \"Reset Password | Dream Collection\",\r\n};\r\n\r\nexport default async function ResetPage({ params }) {\r\n  const { token } = await params;\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50/50 flex flex-col justify-center py-12 sm:px-6 lg:px-8\">\r\n      <div className=\"sm:mx-auto sm:w-full sm:max-w-md\">\r\n        <ResetPasswordForm token={token} />\r\n      </div>\r\n    </div>\r\n  );\r\n}",
  "src\\app\\api\\auth\\[...nextauth]\\route.js": "import NextAuth from \"next-auth\";\r\nimport { authOptions } from \"@/lib/auth.config\";\r\n\r\nconst handler = NextAuth(authOptions);\r\n\r\nexport { handler as GET, handler as POST };\r\n",
  "src\\app\\api\\webhooks\\route.js": "import { NextResponse } from 'next/server';\r\nimport { headers } from 'next/headers';\r\nimport Stripe from 'stripe';\r\nimport crypto from 'crypto';\r\nimport dbConnect from '@/lib/db';\r\nimport Order from '@/features/order/models/Order';\r\nimport { getStoreSettings } from '@/features/admin/settings/actions';\r\n\r\nexport async function POST(req) {\r\n  const body = await req.text();\r\n  const headerPayload = await headers(); // Next.js 15+ Requirement (await headers)\r\n  const signature = headerPayload.get('stripe-signature');\r\n  const razorpaySignature = headerPayload.get('x-razorpay-signature');\r\n\r\n  try {\r\n    await dbConnect();\r\n    const settings = await getStoreSettings();\r\n    const stripeConfig = settings.paymentGateways.find(g => g.id === 'stripe')?.config || {};\r\n    const razorpayConfig = settings.paymentGateways.find(g => g.id === 'razorpay')?.config || {};\r\n\r\n    // --- STRIPE HANDLER ---\r\n    if (signature) {\r\n        if (!stripeConfig.secretKey) return NextResponse.json({ error: 'Stripe not configured' }, { status: 400 });\r\n        \r\n        const stripe = new Stripe(stripeConfig.secretKey);\r\n        let event;\r\n\r\n        try {\r\n            const webhookSecret = stripeConfig.webhookSecret || process.env.STRIPE_WEBHOOK_SECRET;\r\n            if (webhookSecret) {\r\n                // Secure verification\r\n                event = stripe.webhooks.constructEvent(body, signature, webhookSecret);\r\n            } else {\r\n                 // Fallback for dev without secret (NOT SECURE for Prod)\r\n                 event = JSON.parse(body);\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Webhook signature verification failed.\", err.message);\r\n            return NextResponse.json({ error: `Webhook signature verification failed.` }, { status: 400 });\r\n        }\r\n\r\n        if (event.type === 'payment_intent.succeeded') {\r\n            const paymentIntent = event.data.object;\r\n            const orderId = paymentIntent.metadata.orderId;\r\n\r\n            if (orderId) {\r\n                await Order.findByIdAndUpdate(orderId, { \r\n                    status: 'Processing', \r\n                    paymentStatus: 'Paid',\r\n                    paymentMethod: 'stripe'\r\n                });\r\n            }\r\n        }\r\n        return NextResponse.json({ received: true });\r\n    }\r\n\r\n    // --- RAZORPAY HANDLER ---\r\n    if (razorpaySignature) {\r\n        const payload = JSON.parse(body);\r\n        const secret = razorpayConfig.webhookSecret || process.env.RAZORPAY_WEBHOOK_SECRET; \r\n        \r\n        if (!secret) return NextResponse.json({ error: \"No Razorpay secret found\" }, { status: 500 });\r\n\r\n        const shasum = crypto.createHmac(\"sha256\", secret);\r\n        shasum.update(body); // Use raw body for signature verification\r\n        const digest = shasum.digest(\"hex\");\r\n\r\n        if (digest === razorpaySignature) {\r\n            if (payload.event === \"order.paid\") {\r\n                const orderId = payload.payload.payment.entity.notes.orderId || payload.payload.order.entity.receipt;\r\n                if (orderId) {\r\n                     await Order.findByIdAndUpdate(orderId, { \r\n                        status: 'Processing', \r\n                        paymentStatus: 'Paid',\r\n                        paymentMethod: 'razorpay'\r\n                    });\r\n                }\r\n            }\r\n            return NextResponse.json({ status: \"ok\" });\r\n        } else {\r\n            return NextResponse.json({ error: \"Invalid signature\" }, { status: 400 });\r\n        }\r\n    }\r\n\r\n    return NextResponse.json({ error: \"Unknown provider\" }, { status: 400 });\r\n  } catch (err) {\r\n    console.error(\"Webhook Error:\", err);\r\n    return NextResponse.json({ error: \"Webhook handler failed\" }, { status: 500 });\r\n  }\r\n}",
  "src\\app\\forgot-password\\page.js": "import ForgotPasswordForm from \"@/features/auth/components/ForgotPasswordForm\";\r\nimport { Suspense } from \"react\";\r\n\r\nexport const metadata = {\r\n  title: \"Forgot Password | Dream Collection\",\r\n};\r\n\r\nexport default function ForgotPasswordPage() {\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50/50 flex flex-col justify-center py-12 sm:px-6 lg:px-8\">\r\n      <div className=\"sm:mx-auto sm:w-full sm:max-w-md\">\r\n                <Suspense fallback={<div className=\"text-center p-4\">Loading authentication...</div>}>\r\n        <ForgotPasswordForm />\r\n        </Suspense>\r\n      </div>\r\n    </div>\r\n  );\r\n}",
  "src\\app\\globals.css": "@import \"tailwindcss\";\n@import \"tw-animate-css\";\n\n@custom-variant dark (&:is(.dark *));\n\n@theme inline {\n  --color-background: var(--background);\n  --color-foreground: var(--foreground);\n  --font-sans: var(--font-geist-sans);\n  --font-mono: var(--font-geist-mono);\n  --color-sidebar-ring: var(--sidebar-ring);\n  --color-sidebar-border: var(--sidebar-border);\n  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);\n  --color-sidebar-accent: var(--sidebar-accent);\n  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);\n  --color-sidebar-primary: var(--sidebar-primary);\n  --color-sidebar-foreground: var(--sidebar-foreground);\n  --color-sidebar: var(--sidebar);\n  --color-chart-5: var(--chart-5);\n  --color-chart-4: var(--chart-4);\n  --color-chart-3: var(--chart-3);\n  --color-chart-2: var(--chart-2);\n  --color-chart-1: var(--chart-1);\n  --color-ring: var(--ring);\n  --color-input: var(--input);\n  --color-border: var(--border);\n  --color-destructive: var(--destructive);\n  --color-accent-foreground: var(--accent-foreground);\n  --color-accent: var(--accent);\n  --color-muted-foreground: var(--muted-foreground);\n  --color-muted: var(--muted);\n  --color-secondary-foreground: var(--secondary-foreground);\n  --color-secondary: var(--secondary);\n  --color-primary-foreground: var(--primary-foreground);\n  --color-primary: var(--primary);\n  --color-popover-foreground: var(--popover-foreground);\n  --color-popover: var(--popover);\n  --color-card-foreground: var(--card-foreground);\n  --color-card: var(--card);\n  --radius-sm: calc(var(--radius) - 4px);\n  --radius-md: calc(var(--radius) - 2px);\n  --radius-lg: var(--radius);\n  --radius-xl: calc(var(--radius) + 4px);\n}\n\n:root {\n  --radius: 0rem;\n  --background: oklch(1 0 0);\n  --foreground: oklch(0.145 0 0);\n  --card: oklch(1 0 0);\n  --card-foreground: oklch(0.145 0 0);\n  --popover: oklch(1 0 0);\n  --popover-foreground: oklch(0.145 0 0);\n  --primary: oklch(0.205 0 0);\n  --primary-foreground: oklch(0.985 0 0);\n  --secondary: oklch(0.97 0 0);\n  --secondary-foreground: oklch(0.205 0 0);\n  --muted: oklch(0.97 0 0);\n  --muted-foreground: oklch(0.556 0 0);\n  --accent: oklch(0.97 0 0);\n  --accent-foreground: oklch(0.205 0 0);\n  --destructive: oklch(0.577 0.245 27.325);\n  --border: oklch(0.922 0 0);\n  --input: oklch(0.922 0 0);\n  --ring: oklch(0.708 0 0);\n  --chart-1: oklch(0.646 0.222 41.116);\n  --chart-2: oklch(0.6 0.118 184.704);\n  --chart-3: oklch(0.398 0.07 227.392);\n  --chart-4: oklch(0.828 0.189 84.429);\n  --chart-5: oklch(0.769 0.188 70.08);\n  --sidebar: oklch(0.985 0 0);\n  --sidebar-foreground: oklch(0.145 0 0);\n  --sidebar-primary: oklch(0.205 0 0);\n  --sidebar-primary-foreground: oklch(0.985 0 0);\n  --sidebar-accent: oklch(0.97 0 0);\n  --sidebar-accent-foreground: oklch(0.205 0 0);\n  --sidebar-border: oklch(0.922 0 0);\n  --sidebar-ring: oklch(0.708 0 0);\n}\n\n.dark {\n  --background: oklch(0.145 0 0);\n  --foreground: oklch(0.985 0 0);\n  --card: oklch(0.205 0 0);\n  --card-foreground: oklch(0.985 0 0);\n  --popover: oklch(0.205 0 0);\n  --popover-foreground: oklch(0.985 0 0);\n  --primary: oklch(0.922 0 0);\n  --primary-foreground: oklch(0.205 0 0);\n  --secondary: oklch(0.269 0 0);\n  --secondary-foreground: oklch(0.985 0 0);\n  --muted: oklch(0.269 0 0);\n  --muted-foreground: oklch(0.708 0 0);\n  --accent: oklch(0.269 0 0);\n  --accent-foreground: oklch(0.985 0 0);\n  --destructive: oklch(0.704 0.191 22.216);\n  --border: oklch(1 0 0 / 10%);\n  --input: oklch(1 0 0 / 15%);\n  --ring: oklch(0.556 0 0);\n  --chart-1: oklch(0.488 0.243 264.376);\n  --chart-2: oklch(0.696 0.17 162.48);\n  --chart-3: oklch(0.769 0.188 70.08);\n  --chart-4: oklch(0.627 0.265 303.9);\n  --chart-5: oklch(0.645 0.246 16.439);\n  --sidebar: oklch(0.205 0 0);\n  --sidebar-foreground: oklch(0.985 0 0);\n  --sidebar-primary: oklch(0.488 0.243 264.376);\n  --sidebar-primary-foreground: oklch(0.985 0 0);\n  --sidebar-accent: oklch(0.269 0 0);\n  --sidebar-accent-foreground: oklch(0.985 0 0);\n  --sidebar-border: oklch(1 0 0 / 10%);\n  --sidebar-ring: oklch(0.556 0 0);\n}\n\n@layer base {\n  * {\n    @apply border-border outline-ring/50;\n  }\n  body {\n    @apply bg-background text-foreground;\n  }\n}\n\n.no-scrollbar::-webkit-scrollbar {\n    display: none;\n}\n.no-scrollbar {\n    -ms-overflow-style: none;  /* IE and Edge */\n    scrollbar-width: none;  /* Firefox */\n}",
  "src\\app\\layout.js": "import \"./globals.css\";\nimport StoreProvider from \"@/lib/StoreProvider\";\nimport AuthProvider from \"@/features/auth/components/AuthProvider\";\nimport SessionWrapper from \"@/features/auth/components/SessionWrapper\"; \nimport { ToastProvider } from \"@/context/ToastContext\"; \nimport CartSync from \"@/features/cart/components/CartSync\";\nimport AnalyticsTracker from \"@/features/analytics/components/AnalyticsTracker\"; // Import Tracker\n\n\nexport const metadata = {\n  title: \"Hot Wheels Store\",\n  description: \"Best Die-cast models\",\n};\n\nexport default function RootLayout({ children }) {\n  return (\n    <html lang=\"en\">\n      <body className={`antialiased relative`}>\n        <SessionWrapper>\n          <StoreProvider>\n            <AuthProvider>\n              <ToastProvider>\n                <CartSync/>\n                <AnalyticsTracker /> {/* Runs silently in background */}\n                {children}\n              </ToastProvider>\n            </AuthProvider>\n          </StoreProvider>\n        </SessionWrapper>\n      </body>\n    </html>\n  );\n}",
  "src\\app\\login\\page.js": "import LoginForm from \"@/features/auth/components/LoginForm\";\r\nimport { Suspense } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { ArrowLeft } from \"lucide-react\";\r\n\r\nexport const metadata = {\r\n  title: \"Login / Sign Up | Dream Collection\",\r\n  description: \"Access your account to manage orders and save your favorite cars.\",\r\n};\r\n\r\nexport default function LoginPage() {\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50/50 flex flex-col justify-center py-5 sm:px-6 lg:px-8\">\r\n      \r\n      {/* Back to Home Link */}\r\n      <div className=\"sm:mx-auto sm:w-full sm:max-w-md  px-4 sm:px-0\">\r\n        <Link href=\"/\" className=\"inline-flex items-center text-sm text-gray-500 hover:text-indigo-600 transition-colors mb-6\">\r\n            <ArrowLeft size={16} className=\"mr-2\" /> Back to Store\r\n        </Link>\r\n        \r\n        <h2 className=\"text-center text-2xl font-bold tracking-tight text-gray-600\">\r\n          Welcome to Dream Collection\r\n        </h2>\r\n      </div>\r\n\r\n      <div className=\"sm:mx-auto sm:w-full sm:max-w-[480px]\">\r\n        <Suspense fallback={<div className=\"text-center p-4\">Loading authentication...</div>}>\r\n          <LoginForm />\r\n        </Suspense>\r\n\r\n        {/* Trust/Benefits Section */}\r\n        <div className=\"mt-3 grid grid-cols-3 gap-4 text-center text-xs text-gray-500 px-6 sm:px-0\">\r\n            <div className=\"flex flex-col items-center gap-1\">\r\n                <span className=\"p-2 bg-indigo-50 text-indigo-600 rounded-full\">üöö</span>\r\n                <span>Order Tracking</span>\r\n            </div>\r\n            <div className=\"flex flex-col items-center gap-1\">\r\n                <span className=\"p-2 bg-indigo-50 text-indigo-600 rounded-full\">üõí</span>\r\n                <span>Saved Cart</span>\r\n            </div>\r\n            <div className=\"flex flex-col items-center gap-1\">\r\n                <span className=\"p-2 bg-indigo-50 text-indigo-600 rounded-full\">‚ö°</span>\r\n                <span>Fast Checkout</span>\r\n            </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}",
  "src\\app\\page.js": "import Navbar from \"@/components/layout/Navbar/Navbar\";\nimport Footer from \"@/components/layout/Footer\";\nimport AllProducts from \"@/features/product/components/AllProducts\";\nimport Link from \"next/link\";\n\nexport default async function Home() {\n\n  return (\n    <>\n      <header className='text-center'>\n        <Navbar />\n      </header>\n      <main className='flex min-h-screen flex-col items-center p-8 md:px-24 bg-gray-50/30'>\n        <div className='w-full max-w-7xl'>\n                  {/* Breadcrumb */}\n                  <p className=\"text-sm text-gray-500 mb-8\">\n                      <Link href=\"/\" className=\"hover:text-indigo-600\">Home</Link> / \n                  </p>\n          <AllProducts />\n        </div>\n      </main>\n      <Footer />\n    </>\n  );\n}\n\n// import Hero from \"@/components/home/Hero\";\n// import Categories from \"@/components/home/Categories\";\n// import PromoBanner from \"@/components/home/PromoBanner\";\n// import TrustSignals from \"@/components/home/TrustSignals\";\n// import ProductCard from \"@/features/product/components/ProductCard\";\n// import Footer from \"@/components/layout/Footer\";\n// import { getProducts } from \"@/features/product/actions\";\n// import Link from \"next/link\";\n\n// export default async function Home() {\n//   // Fetch products on the server\n//   const products = await getProducts();\n\n//   // Slice top 8 for \"Featured\"\n//   const featuredProducts = products.slice(0, 8);\n\n//   return (\n//     <main className=\"bg-white min-h-screen\">\n//       <Hero />\n\n//       <Categories />\n\n//       {/* Featured Products Section */}\n//       <section id=\"featured\" className=\"py-10 px-6 max-w-7xl mx-auto\">\n//         <div className=\"flex flex-col md:flex-row justify-between items-end mb-8 gap-4\">\n//           <div>\n//             <h2 className=\"text-3xl font-bold text-gray-900\">Featured Drops</h2>\n//             <p className=\"text-gray-500 mt-2\">Fresh from the factory to your shelf</p>\n//           </div>\n//           <Link href=\"/search\">\n//              <button className=\"px-6 py-2.5 rounded-full border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition\">\n//                 View All Products\n//              </button>\n//           </Link>\n//         </div>\n\n//         {products.length > 0 ? (\n//           <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6\">\n//             {featuredProducts.map(product => (\n//               <ProductCard key={product._id} product={product} />\n//             ))}\n//           </div>\n//         ) : (\n//           <div className=\"text-center py-20 bg-gray-50 rounded-xl border border-dashed border-gray-200\">\n//             <p className=\"text-gray-500\">No products found. Check back later!</p>\n//           </div>\n//         )}\n//       </section>\n\n//       {/* Ads / Promo Section */}\n//       <PromoBanner />\n\n//       <TrustSignals />\n\n//       <Footer />\n//     </main>\n//   );\n// }\n",
  "src\\app\\verify-email\\page.js": "import { verifyEmail } from \"@/features/auth/actions\";\r\nimport Link from \"next/link\";\r\nimport { CheckCircle, XCircle } from \"lucide-react\";\r\n\r\nexport const metadata = {\r\n  title: \"Verify Email | Dream Collection\",\r\n};\r\n\r\nexport default async function VerifyEmailPage({ searchParams }) {\r\n  const { token } = await searchParams;\r\n\r\n  if (!token) {\r\n    return <StatusCard success={false} message=\"Missing token\" />;\r\n  }\r\n\r\n  const result = await verifyEmail(token);\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50/50 p-4\">\r\n      <StatusCard success={result.success} message={result.message || result.error} />\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction StatusCard({ success, message }) {\r\n  return (\r\n    <div className=\"bg-white p-8 rounded-xl shadow-lg border border-gray-100 max-w-md w-full text-center\">\r\n      <div className={`mx-auto flex items-center justify-center h-16 w-16 rounded-full mb-4 ${success ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}`}>\r\n        {success ? <CheckCircle size={32} /> : <XCircle size={32} />}\r\n      </div>\r\n      <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">\r\n        {success ? \"Email Verified!\" : \"Verification Failed\"}\r\n      </h2>\r\n      <p className=\"text-gray-500 mb-6\">{message}</p>\r\n      \r\n      <Link href=\"/login\">\r\n        <button className=\"w-full bg-indigo-600 text-white py-3 rounded-lg font-medium hover:bg-indigo-700 transition\">\r\n            Back to Login\r\n        </button>\r\n      </Link>\r\n    </div>\r\n  );\r\n}",
  "src\\components\\ContactUs.js": "import React from 'react'\r\n\r\nfunction ContactUs() {\r\n  return (\r\n        <form className=\"flex flex-col items-center text-sm my-8\">\r\n            <p className=\"text-lg text-blue-600 font-medium pb-2\">Contact Us</p>\r\n            <h1 className=\"text-4xl font-semibold text-slate-700 pb-4\">Get in touch with us</h1>\r\n            <p className=\"text-sm text-gray-500 text-center pb-10\">Lorem Ipsum is simply dummy text of the printing and typesetting industry.<br />Lorem Ipsum has been the industry's standard dummy text.</p>\r\n            \r\n            <div className=\"flex flex-col md:flex-row items-center gap-8 w-[350px] md:w-[700px]\">\r\n                <div className=\"w-full\">\r\n                    <label className=\"text-black/70\" htmlFor=\"name\">Your Name</label>\r\n                    <input className=\"h-12 p-2 mt-2 w-full border border-gray-500/30 rounded outline-none focus:border-indigo-300\" type=\"text\" required />\r\n                </div>\r\n                <div className=\"w-full\">\r\n                    <label className=\"text-black/70\" htmlFor=\"name\">Your Email</label>\r\n                    <input className=\"h-12 p-2 mt-2 w-full border border-gray-500/30 rounded outline-none focus:border-indigo-300\" type=\"email\" required />\r\n                </div>\r\n            </div>\r\n        \r\n            <div className=\"mt-6 w-[350px] md:w-[700px]\">\r\n                <label className=\"text-black/70\" htmlFor=\"name\">Message</label>\r\n                <textarea className=\"w-full mt-2 p-2 h-40 border border-gray-500/30 rounded resize-none outline-none focus:border-indigo-300\" required></textarea>\r\n            </div>\r\n        \r\n            <button type=\"submit\" className=\"mt-5 bg-indigo-600 text-white h-12 w-56 px-4 rounded active:scale-95 transition\">Send Message</button>\r\n        </form>\r\n    );\r\n}\r\n\r\nexport default ContactUs",
  "src\\components\\home\\Categories.js": "\"use client\";\r\nimport Link from \"next/link\";\r\nimport { motion } from \"framer-motion\";\r\n\r\nconst categories = [\r\n  { name: \"Muscle\", image: \"https://images.unsplash.com/photo-1552519507-da3b142c6e3d?auto=format&fit=crop&q=80&w=800\", count: \"12 Items\" },\r\n  { name: \"JDM Legends\", image: \"https://images.unsplash.com/photo-1626668893632-6f3a4466d22f?auto=format&fit=crop&q=80&w=800\", count: \"8 Items\" },\r\n  { name: \"Exotics\", image: \"https://images.unsplash.com/photo-1544636331-e26879cd4d9b?auto=format&fit=crop&q=80&w=800\", count: \"15 Items\" },\r\n  { name: \"Off-Road\", image: \"https://images.unsplash.com/photo-1533473359331-0135ef1b58bf?auto=format&fit=crop&q=80&w=800\", count: \"6 Items\" },\r\n];\r\n\r\nexport default function Categories() {\r\n  return (\r\n    <section className=\"py-20 px-6 max-w-7xl mx-auto\">\r\n      <div className=\"flex justify-between items-end mb-10\">\r\n        <div>\r\n          <h2 className=\"text-3xl font-bold text-gray-900\">Shop by Category</h2>\r\n          <p className=\"text-gray-500 mt-2\">Find the perfect addition to your garage</p>\r\n        </div>\r\n        <Link href=\"/search\" className=\"text-indigo-600 font-medium hover:underline hidden md:block\">\r\n          View All Categories\r\n        </Link>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6\">\r\n        {categories.map((cat, idx) => (\r\n          <motion.div\r\n            key={idx}\r\n            whileHover={{ y: -5 }}\r\n            className=\"group relative h-64 rounded-2xl overflow-hidden cursor-pointer shadow-md\"\r\n          >\r\n            <Link href={`/search?category=${cat.name}`}>\r\n              <img \r\n                src={cat.image} \r\n                alt={cat.name} \r\n                className=\"absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-110\"\r\n              />\r\n              <div className=\"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent\" />\r\n              <div className=\"absolute bottom-0 left-0 p-6\">\r\n                <h3 className=\"text-xl font-bold text-white\">{cat.name}</h3>\r\n                <p className=\"text-gray-300 text-sm group-hover:text-white transition-colors\">{cat.count}</p>\r\n              </div>\r\n            </Link>\r\n          </motion.div>\r\n        ))}\r\n      </div>\r\n    </section>\r\n  );\r\n}",
  "src\\components\\home\\Hero.js": "\"use client\";\r\nimport { motion } from \"framer-motion\";\r\nimport Link from \"next/link\";\r\nimport { ArrowRight } from \"lucide-react\";\r\n\r\nexport default function Hero() {\r\n  return (\r\n    <section className=\"relative w-full h-[500px] md:h-[600px] bg-gray-900 overflow-hidden\">\r\n      {/* Background Image with Overlay */}\r\n      <div className=\"absolute inset-0\">\r\n        <img \r\n          src=\"https://images.unsplash.com/photo-1594787318286-3d835c1d207f?q=80&w=2070&auto=format&fit=crop\" \r\n          alt=\"Hot Wheels Collection\" \r\n          className=\"w-full h-full object-cover opacity-60\"\r\n        />\r\n        <div className=\"absolute inset-0 bg-gradient-to-r from-black/80 via-black/50 to-transparent\" />\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"relative h-full max-w-7xl mx-auto px-6 flex flex-col justify-center text-white\">\r\n        <motion.div\r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          transition={{ duration: 0.6 }}\r\n          className=\"max-w-2xl space-y-6\"\r\n        >\r\n          <span className=\"inline-block px-4 py-1.5 rounded-full bg-indigo-600/90 text-sm font-semibold tracking-wide uppercase\">\r\n            New 2024 Collection\r\n          </span>\r\n          <h1 className=\"text-4xl md:text-6xl lg:text-7xl font-bold leading-tight\">\r\n            Collect Your <br />\r\n            <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-cyan-400\">\r\n              Dream Ride\r\n            </span>\r\n          </h1>\r\n          <p className=\"text-lg md:text-xl text-gray-300 max-w-lg\">\r\n            Discover rare die-cast models, limited editions, and the classics you loved growing up.\r\n          </p>\r\n          \r\n          <div className=\"flex flex-wrap gap-4 pt-4\">\r\n            <Link href=\"#featured\">\r\n              <button className=\"px-8 py-4 bg-white text-gray-900 rounded-full font-bold hover:bg-gray-100 transition flex items-center gap-2\">\r\n                Shop Now <ArrowRight size={20} />\r\n              </button>\r\n            </Link>\r\n            <Link href=\"/about\">\r\n              <button className=\"px-8 py-4 bg-transparent border border-white/30 text-white rounded-full font-bold hover:bg-white/10 transition backdrop-blur-sm\">\r\n                View Series\r\n              </button>\r\n            </Link>\r\n          </div>\r\n        </motion.div>\r\n      </div>\r\n    </section>\r\n  );\r\n}",
  "src\\components\\home\\PromoBanner.js": "\"use client\";\r\nimport { motion } from \"framer-motion\";\r\n\r\nexport default function PromoBanner() {\r\n  return (\r\n    <section className=\"py-10 px-6 max-w-7xl mx-auto\">\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n        \r\n        {/* Ad Spot 1: Internal Promo */}\r\n        <motion.div \r\n          whileHover={{ scale: 1.01 }}\r\n          className=\"relative h-64 rounded-2xl overflow-hidden bg-gray-900 flex items-center shadow-lg\"\r\n        >\r\n          <div className=\"absolute inset-0 opacity-40 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]\"></div>\r\n          <div className=\"relative z-10 p-8 md:p-12\">\r\n            <span className=\"bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider mb-3 inline-block\">\r\n              Limited Time\r\n            </span>\r\n            <h3 className=\"text-3xl font-bold text-white mb-2\">Red Line Club</h3>\r\n            <p className=\"text-gray-300 mb-6 max-w-xs\">Join the exclusive club for premium members and get early access.</p>\r\n            <button className=\"text-white font-semibold underline decoration-2 underline-offset-4 hover:text-red-400 transition\">\r\n              Join Now\r\n            </button>\r\n          </div>\r\n          {/* Decorative Circle */}\r\n          <div className=\"absolute -right-10 -bottom-10 w-64 h-64 bg-red-600 rounded-full blur-3xl opacity-20\" />\r\n        </motion.div>\r\n\r\n        {/* Ad Spot 2: External / Partner Ad Placeholder */}\r\n        <div className=\"relative h-64 rounded-2xl overflow-hidden bg-indigo-50 border-2 border-indigo-100 border-dashed flex flex-col items-center justify-center text-center p-6\">\r\n            <div className=\"space-y-2\">\r\n                <span className=\"text-xs font-bold text-gray-400 uppercase tracking-widest border border-gray-300 px-2 py-0.5 rounded\">Ad / Sponsor</span>\r\n                <h4 className=\"text-xl font-semibold text-indigo-900\">Your Ad Here</h4>\r\n                <p className=\"text-gray-500 text-sm max-w-xs mx-auto\">\r\n                    Place Google AdSense or affiliate banners in this dedicated slot to monetize your traffic.\r\n                </p>\r\n            </div>\r\n        </div>\r\n\r\n      </div>\r\n    </section>\r\n  );\r\n}",
  "src\\components\\home\\TrustSignals.js": "import { Truck, ShieldCheck, RefreshCw, Headphones } from \"lucide-react\";\r\n\r\nconst features = [\r\n  { icon: <Truck size={28} />, title: \"Free Shipping\", desc: \"On all orders over $50\" },\r\n  { icon: <ShieldCheck size={28} />, title: \"Authentic Models\", desc: \"100% genuine die-cast\" },\r\n  { icon: <RefreshCw size={28} />, title: \"Easy Returns\", desc: \"30-day money back guarantee\" },\r\n  { icon: <Headphones size={28} />, title: \"24/7 Support\", desc: \"Expert collectors support\" },\r\n];\r\n\r\nexport default function TrustSignals() {\r\n  return (\r\n    <section className=\"bg-gray-50 py-16 border-y border-gray-200 mt-20\">\r\n      <div className=\"max-w-7xl mx-auto px-6\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8\">\r\n          {features.map((feature, idx) => (\r\n            <div key={idx} className=\"flex items-start gap-4\">\r\n              <div className=\"p-3 bg-white rounded-lg shadow-sm text-indigo-600 border border-gray-100\">\r\n                {feature.icon}\r\n              </div>\r\n              <div>\r\n                <h4 className=\"font-semibold text-gray-900\">{feature.title}</h4>\r\n                <p className=\"text-sm text-gray-500 mt-1\">{feature.desc}</p>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n}",
  "src\\components\\layout\\Footer.js": "import React from 'react'\r\n\r\nfunction Footer() {\r\n      return (\r\n        <>\r\n            <style>{`\r\n                @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');\r\n            \r\n                * {\r\n                    font-family: 'Poppins', sans-serif;\r\n                }\r\n            `}</style>\r\n            \r\n            <footer className=\"flex flex-col md:flex-row gap-3 items-center justify-around w-full py-4 text-sm bg-slate-800 text-white/70\">\r\n                <p className='text-xs md:text-sm'>Copyright ¬© 2025 dreamcollection. All rights reservered.</p>\r\n                <div className=\"flex items-center gap-4\">\r\n                    <a href=\"/contact\" className=\"hover:text-white transition-all\">\r\n                        Contact Us\r\n                    </a>\r\n                    <div className=\"h-8 w-px bg-white/20\"></div>\r\n                    <a href=\"#\" className=\"hover:text-white transition-all\">\r\n                        Privacy Policy\r\n                    </a>\r\n                    <div className=\"h-8 w-px bg-white/20\"></div>\r\n                    <div className=\"flex items-center justify-center gap-2 \">\r\n                    <a href=\"#\" className=\"hover:-translate-y-0.5 transition-all duration-300\">\r\n                        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                            <path d=\"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z\" stroke=\"#fff\" strokeOpacity=\".5\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\r\n                        </svg>\r\n                    </a>\r\n                    <a href=\"#\" className=\"hover:-translate-y-0.5 transition-all duration-300\">\r\n                        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                            <path d=\"M17 2H7a5 5 0 0 0-5 5v10a5 5 0 0 0 5 5h10a5 5 0 0 0 5-5V7a5 5 0 0 0-5-5\" stroke=\"#fff\" strokeOpacity=\".5\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\r\n                            <path d=\"M16 11.37a4 4 0 1 1-7.914 1.173A4 4 0 0 1 16 11.37m1.5-4.87h.01\" stroke=\"#fff\" strokeOpacity=\".5\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\r\n                        </svg>\r\n                    </a>\r\n                </div>\r\n                </div>\r\n            </footer>\r\n        </>\r\n    );\r\n}\r\n\r\nexport default Footer\r\n\r\n\r\n\r\n// import Link from \"next/link\";\r\n// import { Facebook, Twitter, Instagram, Youtube } from \"lucide-react\";\r\n\r\n// export default function Footer() {\r\n//   return (\r\n//     <footer className=\"bg-white border-t border-gray-200 pt-16 pb-8\">\r\n//       <div className=\"max-w-7xl mx-auto px-6\">\r\n//         <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-16\">\r\n          \r\n//           {/* Brand */}\r\n//           <div className=\"space-y-4\">\r\n//             <h2 className=\"text-xl font-bold text-gray-900\">dream collection</h2>\r\n//             <p className=\"text-gray-500 text-sm leading-relaxed\">\r\n//               Your premier destination for rare and collectible Hot Wheels die-cast models. Fueling the passion for collectors worldwide.\r\n//             </p>\r\n//             <div className=\"flex gap-4\">\r\n//               <SocialIcon icon={<Instagram size={20} />} />\r\n//               <SocialIcon icon={<Twitter size={20} />} />\r\n//               <SocialIcon icon={<Facebook size={20} />} />\r\n//               <SocialIcon icon={<Youtube size={20} />} />\r\n//             </div>\r\n//           </div>\r\n\r\n//           {/* Quick Links */}\r\n//           <div>\r\n//             <h3 className=\"font-semibold text-gray-900 mb-4\">Shop</h3>\r\n//             <ul className=\"space-y-3 text-sm text-gray-500\">\r\n//               <FooterLink href=\"#\">New Arrivals</FooterLink>\r\n//               <FooterLink href=\"#\">Best Sellers</FooterLink>\r\n//               <FooterLink href=\"#\">Pre-Orders</FooterLink>\r\n//               <FooterLink href=\"#\">Sale</FooterLink>\r\n//             </ul>\r\n//           </div>\r\n\r\n//           {/* Support */}\r\n//           <div>\r\n//             <h3 className=\"font-semibold text-gray-900 mb-4\">Support</h3>\r\n//             <ul className=\"space-y-3 text-sm text-gray-500\">\r\n//               <FooterLink href=\"/profile\">My Account</FooterLink>\r\n//               <FooterLink href=\"#\">Track Order</FooterLink>\r\n//               <FooterLink href=\"#\">Shipping Policy</FooterLink>\r\n//               <FooterLink href=\"#\">Returns</FooterLink>\r\n//             </ul>\r\n//           </div>\r\n\r\n//           {/* Newsletter */}\r\n//           <div>\r\n//             <h3 className=\"font-semibold text-gray-900 mb-4\">Stay in the Loop</h3>\r\n//             <p className=\"text-sm text-gray-500 mb-4\">Subscribe for latest drops and exclusive offers.</p>\r\n//             <div className=\"flex gap-2\">\r\n//               <input \r\n//                 type=\"email\" \r\n//                 placeholder=\"Email address\" \r\n//                 className=\"bg-gray-50 border border-gray-300 text-sm rounded-lg px-4 py-2.5 w-full outline-none focus:border-indigo-500 transition\"\r\n//               />\r\n//               <button className=\"bg-indigo-600 text-white px-4 py-2.5 rounded-lg hover:bg-indigo-700 transition\">\r\n//                 Subscribe\r\n//               </button>\r\n//             </div>\r\n//           </div>\r\n//         </div>\r\n\r\n//         <div className=\"border-t border-gray-200 pt-8 flex flex-col md:flex-row justify-between items-center gap-4 text-sm text-gray-500\">\r\n//           <p>¬© {new Date().getFullYear()} Dream Collection. All rights reserved.</p>\r\n//           <div className=\"flex gap-6\">\r\n//             <Link href=\"#\" className=\"hover:text-gray-900\">Privacy Policy</Link>\r\n//             <Link href=\"#\" className=\"hover:text-gray-900\">Terms of Service</Link>\r\n//           </div>\r\n//         </div>\r\n//       </div>\r\n/\n\n// ‚úÇÔ∏è Truncated for AI (original 6522 characters)",
  "src\\components\\layout\\Navbar\\Navbar.js": "\"use client\"\r\nimport Link from 'next/link';\r\nimport { useAppSelector } from '@/lib/hooks';\r\nimport { useState } from 'react';\r\nimport { useSession, signOut } from 'next-auth/react';\r\n\r\nfunction Navbar() {\r\n    const { data: session } = useSession();\r\n    const totalQty = useAppSelector((state) => state.cart.totalQuantity);\r\n    const [open, setOpen] = useState(false); \r\n\r\n    return (\r\n        <nav className=\"flex items-center justify-between px-6 md:px-16 lg:px-24 xl:px-32 py-4 border-b border-gray-300 bg-white relative transition-all z-50\">\r\n\r\n            <Link href=\"/\">\r\n                <h1 className='font-semibold md:text-xl'>dream collection</h1>\r\n            </Link>\r\n\r\n            {/* Desktop Menu */}\r\n            <div className=\"hidden sm:flex items-center gap-8\">\r\n                <Link href=\"/\" className=\"hover:text-indigo-600 transition\">Home</Link>\r\n                <Link href=\"#\" className=\"hover:text-indigo-600 transition\">About</Link>\r\n                <Link href=\"/contact\" className=\"hover:text-indigo-600 transition\">Contact</Link>\r\n\r\n                {/* Search Bar */}\r\n                <div className=\"hidden lg:flex items-center text-sm gap-2 border border-gray-300 px-3 rounded-full\">\r\n                    <input className=\"py-1.5 w-full bg-transparent outline-none placeholder-gray-500\" type=\"text\" placeholder=\"Search products\" />\r\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                        <path d=\"M10.836 10.615 15 14.695\" stroke=\"#7A7B7D\" strokeWidth=\"1.2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\r\n                        <path clipRule=\"evenodd\" d=\"M9.141 11.738c2.729-1.136 4.001-4.224 2.841-6.898S7.67.921 4.942 2.057C2.211 3.193.94 6.281 2.1 8.955s4.312 3.92 7.041 2.783\" stroke=\"#7A7B7D\" strokeWidth=\"1.2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\r\n                    </svg>\r\n                </div>\r\n\r\n                {/* Cart Icon */}\r\n                <div className=\"relative cursor-pointer\">\r\n                    <Link href={'/cart'}>\r\n                        <div className=\"relative\">\r\n                            <svg width=\"18\" height=\"18\" viewBox=\"0 0 14 14\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                <path d=\"M.583.583h2.333l1.564 7.81a1.17 1.17 0 0 0 1.166.94h5.67a1.17 1.17 0 0 0 1.167-.94l.933-4.893H3.5m2.333 8.75a.583.583 0 1 1-1.167 0 .583.583 0 0 1 1.167 0m6.417 0a.583.583 0 1 1-1.167 0 .583.583 0 0 1 1.167 0\" stroke=\"#615fff\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\r\n                            </svg>\r\n                            <span className=\"absolute -top-2 -right-3 text-xs text-white bg-indigo-500 w-[18px] h-[18px] rounded-full flex items-center justify-center\">\r\n                                {totalQty}\r\n                            </span>\r\n                        </div>\r\n                    </Link>\r\n                </div>\r\n\r\n                {/* Profile Icon (ONLY when logged in) */}\r\n                {session && (\r\n                    <Link href=\"/profile\">\r\n                        <div className=\"w-10 h-10 rounded-full overflow-hidden cursor-pointer border border-gray-200\">\r\n                            {session.user?.image ? (\r\n                                <img src={session.user.image} className=\"w-full h-full object-cover\" />\r\n                            ) : (\r\n                                <div className=\"w-full h-full bg-gray-100 flex items-center justify-center\">\r\n                                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                                        <path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"></path>\r\n                                        <circle cx=\"12\" cy=\"7\" r=\"4\"></circle>\r\n                                    </svg>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </Link>\r\n                )}\r\n\r\n                {/* If NOT logged in show Login */}\r\n                {!session && (\r\n                    <Link href=\"/login\">\r\n                        <button className=\"cursor-pointer px-8 py-2 bg-indigo-500 hover:bg-indigo-600 transition text-white rounded-full\">\r\n                            Login\r\n                        </button>\r\n                    </Link>\r\n                )}\r\n            </div>\r\n\r\n            {/* Mobile Navbar */}\r\n            <div className=\" flex gap-4 justify-center items-center sm:hidden\">\r\n\r\n                {/* Cart Icon */}\r\n                <Link href={'/cart'} className=\"relative cursor-pointer\">\r\n                    <svg width=\"18\" height=\"18\" viewBox=\"0 0 14 14\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                        <path d=\"M.583.583h2.333l1.564 7.81a1.17 1.17 0 0 0 1.166.94h5.67a1.17 1.17 0 0 0 1.167-.94l.933-4.893H3.5m2.333 8.75a.583.583 0 1 1-1.167 0 .583.583 0 0 1 1.167 0m6.417 0a.583.583 0 1 1-1.167 0 .583.583 0 0 1 1.167 0\" stroke=\"#615fff\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\r\n                    </svg>\r\n                    <span className=\"absolute -top-2 -right-3 text-xs text-white bg-indigo-500 w-[18px] h-[18px] rounded-full flex items-center justify-center\">\r\n                        {totalQty}\r\n                    </span>\r\n                </Link>\r\n\r\n                {/* Mobile Profile Icon */}\r\n                {session && (\r\n                    <Link href=\"/profile\">\r\n                        <div className=\"relative -right-2 w-8 h-8 rounded-full overflow-hidden border border-gray-200 cursor-pointer\">\r\n                            {session.user?.image ? (\r\n                                <img src={session.user.image} className=\"w-full h-full object-cover\" />\r\n                            ) : (\r\n                                <div className=\"w-full h-full bg-gray-100 flex items-center justify-cente\n\n// ‚úÇÔ∏è Truncated for AI (original 8339 characters)",
  "src\\components\\ui\\badge.jsx": "import * as React from \"react\"\r\nimport { Slot } from \"@radix-ui/react-slot\"\r\nimport { cva } from \"class-variance-authority\";\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst badgeVariants = cva(\r\n  \"inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default:\r\n          \"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90\",\r\n        secondary:\r\n          \"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90\",\r\n        destructive:\r\n          \"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60\",\r\n        outline:\r\n          \"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nfunction Badge({\r\n  className,\r\n  variant,\r\n  asChild = false,\r\n  ...props\r\n}) {\r\n  const Comp = asChild ? Slot : \"span\"\r\n\r\n  return (\r\n    <Comp\r\n      data-slot=\"badge\"\r\n      className={cn(badgeVariants({ variant }), className)}\r\n      {...props} />\r\n  );\r\n}\r\n\r\nexport { Badge, badgeVariants }\r\n",
  "src\\components\\ui\\button.jsx": "import * as React from \"react\"\r\nimport { Slot } from \"@radix-ui/react-slot\"\r\nimport { cva } from \"class-variance-authority\";\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst buttonVariants = cva(\r\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\r\n        destructive:\r\n          \"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60\",\r\n        outline:\r\n          \"border-1 bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50\",\r\n        secondary:\r\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\r\n        ghost:\r\n          \"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50\",\r\n        link: \"text-primary underline-offset-4 hover:underline\",\r\n      },\r\n      size: {\r\n        default: \"h-9 px-4 py-2 has-[>svg]:px-3\",\r\n        sm: \"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5\",\r\n        lg: \"h-10 rounded-md px-6 has-[>svg]:px-4\",\r\n        icon: \"size-9\",\r\n        \"icon-sm\": \"size-8\",\r\n        \"icon-lg\": \"size-10\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nfunction Button({\r\n  className,\r\n  variant,\r\n  size,\r\n  asChild = false,\r\n  ...props\r\n}) {\r\n  const Comp = asChild ? Slot : \"button\"\r\n\r\n  return (\r\n    <Comp\r\n      data-slot=\"button\"\r\n      className={cn(buttonVariants({ variant, size, className }))}\r\n      {...props} />\r\n  );\r\n}\r\n\r\nexport { Button, buttonVariants }\r\n",
  "src\\components\\ui\\input.jsx": "import * as React from \"react\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nfunction Input({\r\n  className,\r\n  type,\r\n  ...props\r\n}) {\r\n  return (\r\n    <input\r\n      type={type}\r\n      data-slot=\"input\"\r\n      className={cn(\r\n        \"file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\r\n        \"focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]\",\r\n        \"aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\r\n        className\r\n      )}\r\n      {...props} />\r\n  );\r\n}\r\n\r\nexport { Input }\r\n",
  "src\\components\\ui\\switch.jsx": "\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport * as SwitchPrimitive from \"@radix-ui/react-switch\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nfunction Switch({\r\n  className,\r\n  ...props\r\n}) {\r\n  return (\r\n    <SwitchPrimitive.Root\r\n      data-slot=\"switch\"\r\n      className={cn(\r\n        \"peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50\",\r\n        className\r\n      )}\r\n      {...props}>\r\n      <SwitchPrimitive.Thumb\r\n        data-slot=\"switch-thumb\"\r\n        className={cn(\r\n          \"bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0\"\r\n        )} />\r\n    </SwitchPrimitive.Root>\r\n  );\r\n}\r\n\r\nexport { Switch }\r\n",
  "src\\context\\ToastContext.js": "\"use client\";\r\nimport { createContext, useContext, useState, useCallback } from \"react\";\r\nimport { AnimatePresence, motion } from \"framer-motion\";\r\nimport { X, CheckCircle, AlertCircle, Info, AlertTriangle, Loader2 } from \"lucide-react\";\r\n\r\nconst ToastContext = createContext();\r\n\r\nexport const useToast = () => {\r\n  const context = useContext(ToastContext);\r\n  if (!context) {\r\n    throw new Error(\"useToast must be used within a ToastProvider\");\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const ToastProvider = ({ children }) => {\r\n  const [toasts, setToasts] = useState([]);\r\n\r\n  const addToast = useCallback((message, type = \"info\") => {\r\n    const id = Math.random().toString(36).substr(2, 9);\r\n    setToasts((prev) => [...prev, { id, message, type }]);\r\n\r\n    // Auto-dismiss standard toasts\r\n    if (type !== \"loading\") {\r\n      setTimeout(() => {\r\n        removeToast(id);\r\n      }, 5000);\r\n    }\r\n    return id;\r\n  }, []);\r\n\r\n  const removeToast = useCallback((id) => {\r\n    setToasts((prev) => prev.filter((t) => t.id !== id));\r\n  }, []);\r\n\r\n  return (\r\n    <ToastContext.Provider value={{ addToast, removeToast }}>\r\n      {children}\r\n      <div className=\"fixed top-4 right-4 z-[9999] flex flex-col gap-2 w-full max-w-sm pointer-events-none p-4\">\r\n        <AnimatePresence mode=\"popLayout\">\r\n          {toasts.map((toast) => (\r\n            <ToastItem key={toast.id} toast={toast} onDismiss={removeToast} />\r\n          ))}\r\n        </AnimatePresence>\r\n      </div>\r\n    </ToastContext.Provider>\r\n  );\r\n};\r\n\r\nconst ToastItem = ({ toast, onDismiss }) => {\r\n  const styles = {\r\n    success: { bg: \"bg-emerald-50\", border: \"border-emerald-200\", text: \"text-emerald-800\", icon: <CheckCircle size={20} className=\"text-emerald-500\" /> },\r\n    error: { bg: \"bg-red-50\", border: \"border-red-200\", text: \"text-red-800\", icon: <AlertCircle size={20} className=\"text-red-500\" /> },\r\n    warning: { bg: \"bg-amber-50\", border: \"border-amber-200\", text: \"text-amber-800\", icon: <AlertTriangle size={20} className=\"text-amber-500\" /> },\r\n    info: { bg: \"bg-blue-50\", border: \"border-blue-200\", text: \"text-blue-800\", icon: <Info size={20} className=\"text-blue-500\" /> },\r\n    loading: { bg: \"bg-gray-50\", border: \"border-gray-200\", text: \"text-gray-800\", icon: <Loader2 size={20} className=\"text-indigo-600 animate-spin\" /> },\r\n  };\r\n\r\n  const style = styles[toast.type] || styles.info;\r\n\r\n  return (\r\n    <motion.div\r\n      layout\r\n      initial={{ opacity: 0, y: -20, scale: 0.95 }}\r\n      animate={{ opacity: 1, y: 0, scale: 1 }}\r\n      exit={{ opacity: 0, scale: 0.95, transition: { duration: 0.2 } }}\r\n      className={`pointer-events-auto flex items-start gap-3 p-4 rounded-lg border shadow-lg ${style.bg} ${style.border}`}\r\n    >\r\n      <div className=\"shrink-0 mt-0.5\">{style.icon}</div>\r\n      <div className={`flex-1 text-sm font-medium ${style.text}`}>{toast.message}</div>\r\n      <button \r\n        onClick={() => onDismiss(toast.id)} \r\n        className={`shrink-0 p-1 rounded-full hover:bg-black/5 transition ${style.text}`}\r\n      >\r\n        <X size={16} />\r\n      </button>\r\n    </motion.div>\r\n  );\r\n};",
  "src\\features\\admin\\actions.js": "\"use server\";\r\n\r\nimport dbConnect from '@/lib/db';\r\nimport Product from '@/features/product/models/Product';\r\nimport Order from '@/features/order/models/Order';\r\nimport { User } from '@/features/auth/models/User';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { v2 as cloudinary } from 'cloudinary';\r\n\r\ncloudinary.config({\r\n  cloud_name: process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,\r\n  api_key: process.env.CLOUDINARY_API_KEY,\r\n  api_secret: process.env.CLOUDINARY_API_SECRET,\r\n});\r\n\r\n// --- Analytics Actions ---\r\nexport const getDashboardStats = async () => {\r\n  await dbConnect();\r\n\r\n  try {\r\n    const [totalOrders, totalUsers, activeProducts, revenueResult] = await Promise.all([\r\n      // 1. Total Orders\r\n      Order.countDocuments(),\r\n      \r\n      // 2. Active Users (excluding admins)\r\n      User.countDocuments({ isAdmin: false }),\r\n      \r\n      // 3. Products In Stock\r\n      Product.countDocuments({ inStock: true }),\r\n      \r\n      // 4. Total Revenue (Sum of non-cancelled orders)\r\n      Order.aggregate([\r\n        { $match: { status: { $ne: 'Cancelled' } } },\r\n        { $group: { _id: null, total: { $sum: \"$totalAmount\" } } }\r\n      ])\r\n    ]);\r\n\r\n    const totalRevenue = revenueResult[0]?.total || 0;\r\n\r\n    return {\r\n      totalOrders,\r\n      totalUsers,\r\n      activeProducts,\r\n      totalRevenue\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Dashboard Stats Error:\", error);\r\n    return { totalOrders: 0, totalUsers: 0, activeProducts: 0, totalRevenue: 0 };\r\n  }\r\n};\r\n\r\n// --- Product Actions ---\r\nexport async function uploadImage(formData) {\r\n  const file = formData.get('file');\r\n  if (!file) return { error: \"No file provided\" };\r\n  try {\r\n    const arrayBuffer = await file.arrayBuffer();\r\n    const buffer = new Uint8Array(arrayBuffer);\r\n    const result = await new Promise((resolve, reject) => {\r\n      cloudinary.uploader.upload_stream({ folder: \"hotwheels-store\" }, (error, result) => {\r\n          if (error) reject(error); else resolve(result);\r\n        }).end(buffer);\r\n    });\r\n    return { success: true, url: result.secure_url };\r\n  } catch (error) { return { error: \"Image upload failed\" }; }\r\n}\r\n\r\nexport const getProductById = async (id) => {\r\n    await dbConnect();\r\n    const product = await Product.findById(id).lean();\r\n    if(!product) return null;\r\n    return { ...product, _id: product._id.toString() };\r\n}\r\n\r\nexport const addProduct = async (productData) => {\r\n  await dbConnect();\r\n  try {\r\n    const slug = productData.slug || productData.name.toLowerCase().replace(/ /g, '-').replace(/[^\\w-]+/g, '');\r\n    await Product.create({ ...productData, slug });\r\n    revalidatePath('/admin');\r\n    revalidatePath('/');\r\n    return { success: true };\r\n  } catch (error) { return { error: error.message || \"Failed to add product\" }; }\r\n};\r\n\r\nexport const updateProduct = async (id, productData) => {\r\n    await dbConnect();\r\n    try {\r\n        await Product.findByIdAndUpdate(id, productData);\r\n        revalidatePath('/admin');\r\n        return { success: true };\r\n    } catch (error) { return { error: \"Failed to update product\" }; }\r\n}\r\n\r\nexport const deleteProduct = async (productId) => {\r\n  await dbConnect();\r\n  try {\r\n    await Product.findByIdAndDelete(productId);\r\n    revalidatePath('/admin');\r\n    return { success: true };\r\n  } catch (error) { return { error: \"Failed to delete product\" }; }\r\n};\r\n\r\n// --- Order Actions ---\r\nexport const getAllOrders = async ({ page = 1, limit = 10, status = '' } = {}) => {\r\n  await dbConnect();\r\n\r\n  try {\r\n    const query = {};\r\n    if (status && status !== 'All') {\r\n      query.status = status;\r\n    }\r\n\r\n    const skip = (page - 1) * limit;\r\n\r\n    const [orders, totalItems] = await Promise.all([\r\n      Order.find(query)\r\n        .sort({ createdAt: -1 })\r\n        .skip(skip)\r\n        .limit(limit)\r\n        .populate('userId', 'name email') \r\n        .lean(),\r\n      Order.countDocuments(query)\r\n    ]);\r\n\r\n    const totalPages = Math.ceil(totalItems / limit);\r\n\r\n    const serializedOrders = orders.map(order => ({\r\n      ...order,\r\n      _id: order._id.toString(),\r\n      userId: order.userId ? {\r\n        _id: order.userId._id.toString(),\r\n        name: order.userId.name,\r\n        email: order.userId.email,\r\n      } : { name: 'Unknown User', email: 'N/A' },\r\n      createdAt: order.createdAt?.toISOString() || new Date().toISOString(),\r\n      updatedAt: order.updatedAt?.toISOString() || new Date().toISOString(),\r\n      items: order.items.map(item => ({...item, _id: item._id?.toString() }))\r\n    }));\r\n\r\n    return {\r\n      orders: serializedOrders,\r\n      pagination: {\r\n        currentPage: page,\r\n        totalPages,\r\n        totalItems,\r\n        limit\r\n      }\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Fetch Orders Error:\", error);\r\n    return { orders: [], pagination: { currentPage: 1, totalPages: 1, totalItems: 0 } };\r\n  }\r\n};\r\n\r\nexport const updateOrderStatus = async (orderId, newStatus) => {\r\n  await dbConnect();\r\n  await Order.findByIdAndUpdate(orderId, { status: newStatus });\r\n  revalidatePath('/admin/orders');\r\n  return { success: true };\r\n};",
  "src\\features\\admin\\components\\AdminAnalytics.js": "\"use client\";\r\nimport { Users, ShoppingBag, DollarSign, PackageCheck } from \"lucide-react\";\r\nimport { motion } from \"framer-motion\";\r\n\r\nexport default function AdminAnalytics({ stats }) {\r\n    const cards = [\r\n        {\r\n            label: \"Total Revenue\",\r\n            value: `$${stats.totalRevenue.toLocaleString()}`,\r\n            icon: <DollarSign className=\"text-emerald-600\" size={20} />, // Slightly smaller icon\r\n            bg: \"bg-emerald-50\",\r\n            border: \"border-emerald-100\"\r\n        },\r\n        {\r\n            label: \"Total Orders\",\r\n            value: stats.totalOrders,\r\n            icon: <ShoppingBag className=\"text-blue-600\" size={20} />,\r\n            bg: \"bg-blue-50\",\r\n            border: \"border-blue-100\"\r\n        },\r\n        {\r\n            label: \"Total Customers\",\r\n            value: stats.totalUsers,\r\n            icon: <Users className=\"text-purple-600\" size={20} />,\r\n            bg: \"bg-purple-50\",\r\n            border: \"border-purple-100\"\r\n        },\r\n        {\r\n            label: \"Products In Stock\",\r\n            value: stats.activeProducts,\r\n            icon: <PackageCheck className=\"text-orange-600\" size={20} />,\r\n            bg: \"bg-orange-50\",\r\n            border: \"border-orange-100\"\r\n        }\r\n    ];\r\n\r\n    return (\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4\">\r\n            {cards.map((card, index) => (\r\n                <motion.div \r\n                    key={index}\r\n                    initial={{ opacity: 0, y: 20 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    transition={{ delay: index * 0.1 }}\r\n                    className={`\r\n                        p-4 md:p-5 rounded-xl border ${card.border} ${card.bg} \r\n                        flex items-center justify-between shadow-sm hover:shadow-md transition-shadow\r\n                    `}\r\n                >\r\n                    <div>\r\n                        <p className=\"text-xs md:text-sm text-gray-600 font-medium mb-0.5\">{card.label}</p>\r\n                        <h3 className=\"text-xl md:text-2xl font-bold text-gray-900\">{card.value}</h3>\r\n                    </div>\r\n                    <div className=\"p-2.5 bg-white rounded-lg shadow-sm border border-gray-100/50 shrink-0\">\r\n                        {card.icon}\r\n                    </div>\r\n                </motion.div>\r\n            ))}\r\n        </div>\r\n    );\r\n}",
  "src\\features\\admin\\components\\AdminNavbar.js": "\"use client\";\r\nimport React, { useState } from 'react';\r\nimport Link from 'next/link';\r\nimport { LogOut, Settings, Menu, X } from 'lucide-react';\r\nimport { signOut, useSession } from 'next-auth/react';\r\n\r\nexport default function AdminNavbar() {\r\n  const { data: session } = useSession();\r\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\r\n\r\n  return (\r\n    <nav className=\"sticky top-0 z-50 bg-white border-b border-gray-200 shadow-sm h-16\">\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-full\">\r\n        <div className=\"flex justify-between items-center h-full\">\r\n          \r\n          <Link href=\"/admin\" className=\"flex items-center gap-2 group\">\r\n            <div className=\"w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center shadow-sm group-hover:bg-indigo-700 transition\">\r\n              <span className=\"text-white font-bold text-lg\">D</span>\r\n            </div>\r\n            <span className=\"font-bold text-xl text-gray-900 hidden sm:block tracking-tight\">Dream Admin</span>\r\n          </Link>\r\n\r\n          <div className=\"flex items-center gap-3 md:gap-4\">\r\n            \r\n            {/* Direct Settings Link */}\r\n            <Link \r\n              href=\"/admin/settings\"\r\n              className=\"hidden md:flex items-center justify-center p-2 rounded-full text-gray-500 hover:text-indigo-600 hover:bg-gray-100 transition\"\r\n              title=\"Store Settings\"\r\n            >\r\n              <Settings size={20} />\r\n            </Link>\r\n\r\n            <div className=\"h-6 w-px bg-gray-200 hidden md:block\" />\r\n\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"text-right hidden lg:block\">\r\n                <p className=\"text-sm font-medium text-gray-900 leading-none\">{session?.user?.name || 'Admin'}</p>\r\n                <p className=\"text-[10px] text-gray-500 uppercase tracking-wider mt-0.5\">Manager</p>\r\n              </div>\r\n              \r\n              <div className=\"h-9 w-9 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold border-2 border-white shadow-sm ring-1 ring-gray-100\">\r\n                {session?.user?.name?.[0] || 'A'}\r\n              </div>\r\n              \r\n              <button \r\n                onClick={() => signOut({ callbackUrl: '/login' })}\r\n                className=\"hidden md:block p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-full transition\"\r\n                title=\"Sign Out\"\r\n              >\r\n                <LogOut size={18} />\r\n              </button>\r\n\r\n              <button\r\n                onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}\r\n                className=\"md:hidden p-2 rounded-md text-gray-500 hover:text-gray-700 hover:bg-gray-100 focus:outline-none\"\r\n              >\r\n                {isMobileMenuOpen ? <X size={24} /> : <Menu size={24} />}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {isMobileMenuOpen && (\r\n        <div className=\"md:hidden border-t border-gray-200 bg-white absolute w-full shadow-lg z-50\">\r\n          <div className=\"pt-4 pb-3 border-b border-gray-200 px-5\">\r\n            <div className=\"flex items-center\">\r\n              <div className=\"flex-shrink-0\">\r\n                <div className=\"h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold\">\r\n                  {session?.user?.name?.[0] || 'A'}\r\n                </div>\r\n              </div>\r\n              <div className=\"ml-3\">\r\n                <div className=\"text-base font-medium leading-none text-gray-800\">{session?.user?.name}</div>\r\n                <div className=\"text-sm font-medium leading-none text-gray-500 mt-1\">{session?.user?.email}</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"py-2 px-2 space-y-1\">\r\n             <Link \r\n                href=\"/admin/settings\" \r\n                onClick={() => setIsMobileMenuOpen(false)}\r\n                className=\"flex items-center gap-3 px-3 py-3 rounded-md text-base font-medium text-gray-700 hover:text-indigo-600 hover:bg-gray-50\"\r\n             >\r\n               <Settings size={20} /> Store Settings\r\n             </Link>\r\n             <button \r\n               onClick={() => signOut({ callbackUrl: '/login' })}\r\n               className=\"w-full flex items-center gap-3 px-3 py-3 rounded-md text-base font-medium text-red-600 hover:bg-red-50\"\r\n             >\r\n               <LogOut size={20} /> Sign out\r\n             </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </nav>\r\n  );\r\n}",
  "src\\features\\admin\\components\\AdminOrderList.js": "\"use client\";\r\n\r\nimport { useState, Fragment } from 'react';\r\nimport { updateOrderStatus } from '../actions';\r\nimport { \r\n    ChevronDown, ChevronUp, ChevronLeft, ChevronRight, \r\n    Box, Calendar, User, Mail, MapPin, CreditCard, Package, Truck, AlertCircle \r\n} from 'lucide-react';\r\nimport { useRouter, usePathname, useSearchParams } from 'next/navigation';\r\nimport { useToast } from \"@/context/ToastContext\"; // Added toast\r\n\r\nconst STATUS_OPTIONS = ['Pending', 'Processing', 'Shipped', 'Delivered', 'Cancelled'];\r\n\r\nexport default function AdminOrderList({ initialOrders, pagination, currentStatus }) {\r\n    const router = useRouter();\r\n    const pathname = usePathname();\r\n    const searchParams = useSearchParams();\r\n    const { addToast } = useToast();\r\n    \r\n    // Optimistic State\r\n    const [orders, setOrders] = useState(initialOrders);\r\n    const [expandedOrderId, setExpandedOrderId] = useState(null);\r\n    const [updatingId, setUpdatingId] = useState(null);\r\n\r\n    if (initialOrders !== orders && initialOrders.length !== orders.length) {\r\n         setOrders(initialOrders);\r\n    }\r\n\r\n    const updateUrl = (key, value) => {\r\n        const params = new URLSearchParams(searchParams);\r\n        if (value && value !== 'All') {\r\n            params.set(key, value);\r\n        } else {\r\n            params.delete(key);\r\n        }\r\n        if (key !== 'page') params.set('page', 1);\r\n        router.replace(`${pathname}?${params.toString()}`);\r\n    };\r\n\r\n    const handleStatusChange = async (orderId, newStatus) => {\r\n        setUpdatingId(orderId);\r\n        // Optimistic update\r\n        const previousOrders = [...orders];\r\n        const updatedOrders = orders.map(o => \r\n            o._id === orderId ? { ...o, status: newStatus } : o\r\n        );\r\n        setOrders(updatedOrders);\r\n\r\n        const res = await updateOrderStatus(orderId, newStatus);\r\n        setUpdatingId(null);\r\n        \r\n        if (res.success) {\r\n            addToast(`Order status updated to ${newStatus}`, \"success\");\r\n        } else {\r\n            setOrders(previousOrders); // Revert\r\n            addToast(\"Failed to update status\", \"error\");\r\n        }\r\n    };\r\n\r\n    const toggleExpand = (id) => {\r\n        setExpandedOrderId(expandedOrderId === id ? null : id);\r\n    };\r\n\r\n    const getStatusColor = (status) => {\r\n        switch(status) {\r\n            case 'Pending': return 'bg-yellow-100 text-yellow-800 border-yellow-200';\r\n            case 'Processing': return 'bg-blue-100 text-blue-800 border-blue-200';\r\n            case 'Shipped': return 'bg-purple-100 text-purple-800 border-purple-200';\r\n            case 'Delivered': return 'bg-green-100 text-green-800 border-green-200';\r\n            case 'Cancelled': return 'bg-red-100 text-red-800 border-red-200';\r\n            default: return 'bg-gray-100 text-gray-800';\r\n        }\r\n    };\r\n\r\n    // --- Reusable Expanded Content ---\r\n    const renderOrderDetails = (order) => (\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8 text-left\">\r\n            \r\n            {/* 1. Products */}\r\n            <div className=\"lg:col-span-2 space-y-4\">\r\n                <h4 className=\"text-xs font-semibold uppercase text-gray-500 tracking-wider flex items-center gap-2\">\r\n                    <Package size={14} /> Order Items\r\n                </h4>\r\n                <div className=\"space-y-3\">\r\n                    {order.items.map((item, idx) => (\r\n                        <div key={idx} className=\"flex items-center gap-4 p-3 bg-white border border-gray-200 rounded-lg\">\r\n                            <div className=\"h-12 w-12 bg-gray-100 rounded overflow-hidden shrink-0 border border-gray-100\">\r\n                                <img src={item.image || '/placeholder.png'} alt={item.name} className=\"h-full w-full object-contain mix-blend-multiply\" />\r\n                            </div>\r\n                            <div className=\"flex-1 min-w-0\">\r\n                                <p className=\"text-sm font-medium text-gray-900 truncate\">{item.name}</p>\r\n                                <p className=\"text-xs text-gray-500\">Qty: {item.quantity} √ó ${item.price}</p>\r\n                            </div>\r\n                            <p className=\"font-medium text-gray-900 text-sm\">${item.quantity * item.price}</p>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* 2. Shipping & Workflow */}\r\n            <div className=\"space-y-6\">\r\n                <div>\r\n                    <h4 className=\"text-xs font-semibold uppercase text-gray-500 tracking-wider flex items-center gap-2 mb-3\">\r\n                        <MapPin size={14} /> Shipping Address\r\n                    </h4>\r\n                    <div className=\"bg-white p-4 rounded-lg border border-gray-200 text-sm text-gray-600 leading-relaxed shadow-sm\">\r\n                        <p className=\"font-medium text-gray-900 mb-1 flex items-center gap-2\">\r\n                            <User size={14} className=\"text-gray-400\"/> {order.userId?.name || 'Guest'}\r\n                        </p>\r\n                        <p>{order.shippingAddress?.street}</p>\r\n                        <p>{order.shippingAddress?.city}, {order.shippingAddress?.state} {order.shippingAddress?.zip}</p>\r\n                        <p>{order.shippingAddress?.country}</p>\r\n                        <p className=\"mt-2 text-xs text-gray-400 font-mono flex items-center gap-1\">\r\n                             üìû {order.shippingAddress?.phone || 'No Phone'}\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div>\r\n                    <h4 className=\"text-xs font-semibold uppercase text-gray-500 tracking-wider flex items-center gap-2 mb-3\">\r\n                        <CreditCard size={14} /> Workflow Actions\r\n                    </h4>\r\n                    <div className=\"bg-white p-4 rounded-lg border border-gray-200 space-y-3 shadow-sm\">\r\n                        <div>\r\n                            <label \n\n// ‚úÇÔ∏è Truncated for AI (original 18567 characters)",
  "src\\features\\admin\\components\\AdminProductTable.js": "\"use client\";\r\n\r\nimport { deleteProduct } from \"../actions\";\r\nimport { Trash2, ExternalLink, Pencil, Search, Filter, ChevronLeft, ChevronRight, X } from \"lucide-react\";\r\nimport Link from \"next/link\";\r\nimport { useRouter, useSearchParams, usePathname } from \"next/navigation\";\r\nimport { useState, useEffect } from \"react\"; \r\nimport { useToast } from \"@/context/ToastContext\"; // Import toast\r\n\r\nexport default function AdminProductTable({ initialProducts, pagination }) {\r\n    const router = useRouter();\r\n    const pathname = usePathname();\r\n    const searchParams = useSearchParams();\r\n    const { addToast } = useToast();\r\n\r\n    // Local state for immediate UI feedback\r\n    const [searchTerm, setSearchTerm] = useState(searchParams.get('query') || '');\r\n    const [categoryFilter, setCategoryFilter] = useState(searchParams.get('category') || '');\r\n\r\n    // Debounce Search Logic\r\n    useEffect(() => {\r\n        const delayDebounceFn = setTimeout(() => {\r\n            handleSearch(searchTerm);\r\n        }, 500);\r\n\r\n        return () => clearTimeout(delayDebounceFn);\r\n    }, [searchTerm]);\r\n\r\n    const updateUrl = (key, value) => {\r\n        const params = new URLSearchParams(searchParams);\r\n        if (value) {\r\n            params.set(key, value);\r\n        } else {\r\n            params.delete(key);\r\n        }\r\n        // Reset to page 1 on filter change\r\n        if (key !== 'page') {\r\n            params.set('page', 1);\r\n        }\r\n        router.replace(`${pathname}?${params.toString()}`);\r\n    };\r\n\r\n    const handleSearch = (term) => {\r\n        const params = new URLSearchParams(searchParams);\r\n        if (term) {\r\n            params.set('query', term);\r\n        } else {\r\n            params.delete('query');\r\n        }\r\n        params.set('page', 1); // Reset page\r\n        router.replace(`${pathname}?${params.toString()}`);\r\n    };\r\n\r\n    const handleCategoryChange = (e) => {\r\n        setCategoryFilter(e.target.value);\r\n        updateUrl('category', e.target.value);\r\n    };\r\n\r\n    const handlePageChange = (newPage) => {\r\n        updateUrl('page', newPage);\r\n    };\r\n\r\n    const handleClearFilters = () => {\r\n        setSearchTerm('');\r\n        setCategoryFilter('');\r\n        router.replace(pathname);\r\n    };\r\n\r\n    const handleDelete = async (id) => {\r\n        if(confirm(\"Are you sure you want to delete this product?\")) {\r\n            const res = await deleteProduct(id);\r\n            if (res.success) {\r\n                addToast(\"Product deleted successfully\", \"success\");\r\n            } else {\r\n                addToast(\"Failed to delete product\", \"error\");\r\n            }\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-4 w-full max-w-[100vw]\">\r\n            {/* --- Toolbar --- */}\r\n            <div className=\"bg-white p-3 md:p-4 rounded-lg border border-gray-200 shadow-sm flex flex-col md:flex-row gap-4 justify-between items-center\">\r\n                \r\n                {/* Search */}\r\n                <div className=\"relative w-full md:w-80\">\r\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" size={18} />\r\n                    <input \r\n                        type=\"text\" \r\n                        placeholder=\"Search products...\" \r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                        className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 transition\"\r\n                    />\r\n                </div>\r\n\r\n                {/* Filters */}\r\n                <div className=\"flex flex-col sm:flex-row gap-3 w-full md:w-auto\">\r\n                    <div className=\"relative w-full sm:w-48\">\r\n                        <Filter className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\" size={16} />\r\n                        <select \r\n                            value={categoryFilter}\r\n                            onChange={handleCategoryChange}\r\n                            className=\"w-full pl-9 pr-4 py-2 border border-gray-300 rounded-lg text-sm bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500 cursor-pointer appearance-none\"\r\n                        >\r\n                            <option value=\"\">All Categories</option>\r\n                            <option value=\"Muscle\">Muscle</option>\r\n                            <option value=\"Exotic\">Exotic</option>\r\n                            <option value=\"JDM\">JDM</option>\r\n                            <option value=\"Trucks\">Trucks</option>\r\n                            <option value=\"Fantasy\">Fantasy</option>\r\n                        </select>\r\n                    </div>\r\n\r\n                    {(searchTerm || categoryFilter) && (\r\n                        <button \r\n                            onClick={handleClearFilters}\r\n                            className=\"w-full sm:w-auto justify-center px-3 py-2 text-sm text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition flex items-center gap-1 border border-red-200\"\r\n                        >\r\n                            <X size={16} /> Clear\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* --- Table --- */}\r\n            <div className=\"w-full overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm\">\r\n                <div className=\"w-full overflow-x-auto scrollbar-thin\">\r\n                    <table className=\"min-w-full text-left text-sm text-gray-500 whitespace-nowrap\">\r\n                        <thead className=\"bg-gray-50 text-xs uppercase text-gray-700\">\r\n                            <tr>\r\n                                <th className=\"px-3 py-3 md:px-6\">Product</th>\r\n                                <th className=\"px-6 py-3 hidden md:table-cell\">Category</th>\r\n                                <th className=\"px-6 py-3 hidden lg:table-cell\">Series</th>\r\n                                <th className=\"px-3 py-3 md:px\n\n// ‚úÇÔ∏è Truncated for AI (original 14564 characters)",
  "src\\features\\admin\\components\\AdminSidebar.js": "\"use client\";\r\nimport React from \"react\";\r\nimport Link from \"next/link\";\r\nimport { usePathname } from \"next/navigation\";\r\nimport { \r\n  LayoutDashboard, \r\n  ShoppingBag, \r\n  Package, \r\n  Settings, \r\n  BarChart3, \r\n  Users,\r\n  PlusCircle \r\n} from \"lucide-react\";\r\n\r\nexport default function AdminSidebar() {\r\n  const pathname = usePathname();\r\n\r\n  // Define Groups for scalable navigation\r\n  const menuGroups = [\r\n    {\r\n      label: \"Overview\",\r\n      items: [\r\n        { \r\n          name: \"Dashboard\", \r\n          path: \"/admin\", \r\n          icon: <LayoutDashboard size={20} />,\r\n          // Active strictly on root admin or dashboard sub-pages\r\n          isActive: (path) => path === \"/admin\" \r\n        },\r\n        // Placeholder for future Analytics feature\r\n        // { name: \"Analytics\", path: \"/admin/analytics\", icon: <BarChart3 size={20} /> } \r\n      ]\r\n    },\r\n    {\r\n      label: \"Management\",\r\n      items: [\r\n        { \r\n          name: \"Products\", \r\n          path: \"/admin/products\", \r\n          icon: <Package size={20} />,\r\n          // Active for product list, add product, or edit pages\r\n          isActive: (path) => path.startsWith(\"/admin/products\") || path.startsWith(\"/admin/edit\") || path.startsWith(\"/admin/add\")\r\n        },\r\n        { \r\n          name: \"Orders\", \r\n          path: \"/admin/orders\", \r\n          icon: <ShoppingBag size={20} />,\r\n          isActive: (path) => path.startsWith(\"/admin/orders\")\r\n        },\r\n        // Placeholder for future User Management\r\n        // { name: \"Customers\", path: \"/admin/users\", icon: <Users size={20} /> }\r\n      ]\r\n    },\r\n    {\r\n      label: \"Configuration\",\r\n      items: [\r\n        {\r\n          name: \"Store Settings\",\r\n          path: \"/admin/settings\",\r\n          icon: <Settings size={20} />,\r\n          isActive: (path) => path.startsWith(\"/admin/settings\")\r\n        }\r\n      ]\r\n    }\r\n  ];\r\n\r\n  const checkActive = (item) => item.isActive ? item.isActive(pathname) : pathname === item.path;\r\n\r\n  return (\r\n    <>\r\n      {/* Mobile Bottom Nav Spacer */}\r\n      <div className=\"md:hidden h-16 w-full shrink-0\" />\r\n\r\n      {/* Sidebar Container */}\r\n      <aside className='\r\n        z-40\r\n        /* Mobile: Fixed Bottom Bar */\r\n        fixed bottom-0 left-0 w-full h-16 bg-white border-t border-gray-200 flex flex-row justify-around items-center px-2\r\n        \r\n        /* Desktop: Sticky Sidebar */\r\n        md:relative md:w-64 md:h-[calc(100vh-60px)] md:border-r md:border-t-0 md:flex-col md:justify-start md:px-4 md:py-6 md:gap-6 md:shadow-none\r\n      '\r\n      aria-label=\"Admin Navigation\"\r\n      >\r\n        {menuGroups.map((group, groupIndex) => (\r\n          <div key={groupIndex} className={`contents md:block w-full ${group.label === 'Configuration' ? 'hidden md:block' : ''}`}>\r\n             {/* Note: Configuration is hidden on mobile bottom bar to save space, accessible via other means or \"More\" menu if needed later */}\r\n             \r\n            {/* Group Label (Desktop Only) */}\r\n            <h3 className=\"hidden md:block text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2 px-3\">\r\n              {group.label}\r\n            </h3>\r\n\r\n            {/* Group Items */}\r\n            <nav className=\"contents md:flex md:flex-col md:gap-1\">\r\n              {group.items.map((item, itemIndex) => {\r\n                const isActive = checkActive(item);\r\n                \r\n                return (\r\n                  <Link\r\n                    href={item.path}\r\n                    key={itemIndex}\r\n                    className={`\r\n                      group relative flex items-center transition-all duration-200 outline-none rounded-lg\r\n                      \r\n                      /* Mobile: Column layout, centered, small text */\r\n                      flex-1 flex-col justify-center h-full py-1\r\n                      \r\n                      /* Desktop: Row layout, left aligned, padding */\r\n                      md:flex-none md:flex-row md:justify-start md:px-3 md:py-2.5 md:h-auto\r\n\r\n                      /* Focus Styles */\r\n                      focus-visible:ring-2 focus-visible:ring-indigo-500 focus-visible:ring-offset-1\r\n\r\n                      ${isActive \r\n                        ? \"text-indigo-600 bg-indigo-50\" \r\n                        : \"text-gray-500 hover:text-gray-900 hover:bg-gray-50\"\r\n                      }\r\n                    `}\r\n                    aria-current={isActive ? \"page\" : undefined}\r\n                  >\r\n                    {/* Mobile Top Indicator line for active state */}\r\n                    {isActive && (\r\n                      <span className=\"absolute top-0 w-8 h-0.5 bg-indigo-600 rounded-full md:hidden\" />\r\n                    )}\r\n\r\n                    {/* Icon */}\r\n                    <span className={`transition-colors ${isActive ? 'text-indigo-600' : 'text-gray-500 group-hover:text-gray-700'}`}>\r\n                      {item.icon}\r\n                    </span>\r\n                    \r\n                    {/* Label */}\r\n                    <span className={`\r\n                      text-[10px] font-medium mt-1\r\n                      md:text-sm md:mt-0 md:ml-3\r\n                      ${isActive ? 'font-semibold' : ''}\r\n                    `}>\r\n                      {item.name}\r\n                    </span>\r\n                  </Link>\r\n                );\r\n              })}\r\n            </nav>\r\n          </div>\r\n        ))}\r\n      </aside>\r\n    </>\r\n  );\r\n}",
  "src\\features\\admin\\components\\ProductForm.js": "\"use client\";\r\nimport { useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { Upload, X, Loader2, Save, ArrowLeft } from \"lucide-react\";\r\nimport { addProduct, updateProduct, uploadImage } from \"@/features/admin/actions\";\r\nimport { useToast } from \"@/context/ToastContext\"; // Import hook\r\nimport Link from \"next/link\";\r\n\r\nexport default function ProductForm({ initialData = null, isEditMode = false }) {\r\n    const router = useRouter();\r\n    // FIX: Destructure removeToast from the hook\r\n    const { addToast, removeToast } = useToast(); \r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n    const [uploadingImg, setUploadingImg] = useState(false);\r\n    \r\n    // Form State\r\n    const [formData, setFormData] = useState({\r\n        name: initialData?.name || \"\",\r\n        description: initialData?.description || \"\",\r\n        category: initialData?.category || \"\",\r\n        series: initialData?.series || \"\",\r\n        year: initialData?.year || new Date().getFullYear(),\r\n        price: initialData?.price || \"\",\r\n        originalPrice: initialData?.originalPrice || \"\",\r\n        inStock: initialData?.inStock ?? true,\r\n        // SEO\r\n        seoTitle: initialData?.seoTitle || \"\",\r\n        seoDescription: initialData?.seoDescription || \"\",\r\n        seoKeywords: initialData?.seoKeywords || \"\",\r\n    });\r\n\r\n    const [images, setImages] = useState(initialData?.images || []);\r\n\r\n    const handleChange = (e) => {\r\n        const { name, value, type, checked } = e.target;\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            [name]: type === 'checkbox' ? checked : value\r\n        }));\r\n    };\r\n\r\n    const handleFileUpload = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n\r\n        setUploadingImg(true);\r\n        // Start loading toast and capture ID\r\n        const loadId = addToast(\"Uploading image...\", \"loading\"); \r\n        \r\n        const data = new FormData();\r\n        data.append('file', file);\r\n\r\n        const res = await uploadImage(data);\r\n        \r\n        // FIX: Remove the specific loading toast using its ID\r\n        removeToast(loadId); \r\n        \r\n        if (res.success) {\r\n            setImages(prev => [...prev, res.url]);\r\n            addToast(\"Image uploaded successfully\", \"success\");\r\n        } else {\r\n            addToast(\"Image upload failed\", \"error\");\r\n        }\r\n        setUploadingImg(false);\r\n    };\r\n\r\n    const removeImage = (indexToRemove) => {\r\n        setImages(prev => prev.filter((_, i) => i !== indexToRemove));\r\n        addToast(\"Image removed\", \"info\");\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        setIsSubmitting(true);\r\n\r\n        if (images.length === 0) {\r\n            addToast(\"Please upload at least one image\", \"warning\");\r\n            setIsSubmitting(false);\r\n            return;\r\n        }\r\n\r\n        const payload = {\r\n            ...formData,\r\n            price: Number(formData.price),\r\n            originalPrice: Number(formData.originalPrice),\r\n            year: Number(formData.year),\r\n            images: images\r\n        };\r\n\r\n        let res;\r\n        if (isEditMode) {\r\n            res = await updateProduct(initialData._id, payload);\r\n        } else {\r\n            res = await addProduct(payload);\r\n        }\r\n\r\n        if (res.success) {\r\n            addToast(isEditMode ? \"Product updated successfully!\" : \"Product created successfully!\", \"success\");\r\n            router.push('/admin');\r\n        } else {\r\n            addToast(res.error || \"Something went wrong\", \"error\");\r\n        }\r\n        setIsSubmitting(false);\r\n    };\r\n\r\n    return (\r\n        <motion.div \r\n            initial={{ opacity: 0, y: 10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"max-w-5xl mx-auto px-4 pb-20 md:pb-0\" \r\n        >\r\n            {/* Header - Stacks on mobile */}\r\n            <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6 pt-4\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <Link href=\"/admin\">\r\n                        <button className=\"p-2 hover:bg-gray-100 rounded-md transition text-gray-500\">\r\n                            <ArrowLeft size={20} />\r\n                        </button>\r\n                    </Link>\r\n                    <h1 className=\"text-xl md:text-2xl font-bold text-gray-800\">\r\n                        {isEditMode ? \"Edit Product\" : \"Add Product\"}\r\n                    </h1>\r\n                </div>\r\n                <button\r\n                    onClick={handleSubmit}\r\n                    disabled={isSubmitting}\r\n                    className=\"w-full sm:w-auto flex items-center justify-center gap-2 bg-indigo-600 text-white px-6 py-2.5 rounded-md font-medium hover:bg-indigo-700 transition disabled:opacity-70 shadow-sm text-sm\"\r\n                >\r\n                    {isSubmitting ? <Loader2 size={18} className=\"animate-spin\" /> : <Save size={18} />}\r\n                    {isEditMode ? \"Update\" : \"Save Product\"}\r\n                </button>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8\">\r\n                {/* Left Column: Main Info */}\r\n                <div className=\"lg:col-span-2 space-y-6\">\r\n                    \r\n                    {/* Basic Details Card */}\r\n                    <div className=\"bg-white p-4 md:p-6 rounded-md border border-gray-200 shadow-sm\">\r\n                        <h3 className=\"font-semibold text-gray-900 mb-4 border-b pb-2\">Basic Information</h3>\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                <InputGroup label=\"Product Name\" name=\"name\" value={formData.name} onChange={handleChange} placeholder=\"e.g. 1969 Chevy Camaro\" required />\r\n                                <InputGroup label=\"Series\" name=\"series\" value={fo\n\n// ‚úÇÔ∏è Truncated for AI (original 15127 characters)",
  "src\\features\\admin\\components\\SettingsForm.js": "\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { updateStoreSettings } from \"@/features/admin/settingsActions\";\r\nimport { Loader2, Save, MessageCircle } from \"lucide-react\";\r\n\r\nexport default function SettingsForm({ initialSettings }) {\r\n  const [formData, setFormData] = useState({\r\n    upiId: initialSettings.upiId || \"\",\r\n    whatsappNumber: initialSettings.whatsappNumber || \"\",\r\n    isWhatsAppEnabled: initialSettings.isWhatsAppEnabled ?? false,\r\n    instructions: initialSettings.instructions || \"\"\r\n  });\r\n  const [isSaving, setIsSaving] = useState(false);\r\n\r\n  const handleChange = (e) => {\r\n    const { name, value, type, checked } = e.target;\r\n    setFormData(prev => ({\r\n        ...prev,\r\n        [name]: type === 'checkbox' ? checked : value\r\n    }));\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setIsSaving(true);\r\n    const res = await updateStoreSettings(formData);\r\n    if (res.success) {\r\n        alert(\"Settings saved successfully!\");\r\n    } else {\r\n        alert(\"Failed to save settings.\");\r\n    }\r\n    setIsSaving(false);\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"bg-white p-6 rounded-xl border border-gray-200 shadow-sm space-y-8\">\r\n        \r\n        {/* Toggle Section */}\r\n        <div className=\"flex items-center justify-between pb-6 border-b border-gray-100\">\r\n            <div className=\"flex gap-4\">\r\n                <div className=\"p-2 bg-green-50 rounded-lg text-green-600 h-fit\">\r\n                    <MessageCircle size={24} />\r\n                </div>\r\n                <div>\r\n                    <h3 className=\"font-medium text-gray-900\">Enable WhatsApp Orders</h3>\r\n                    <p className=\"text-sm text-gray-500\">Allow customers to checkout via WhatsApp.</p>\r\n                </div>\r\n            </div>\r\n            <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                <input type=\"checkbox\" name=\"isWhatsAppEnabled\" checked={formData.isWhatsAppEnabled} onChange={handleChange} className=\"sr-only peer\" />\r\n                <div className=\"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600\"></div>\r\n            </label>\r\n        </div>\r\n\r\n        {/* Inputs */}\r\n        <div className=\"grid gap-6\">\r\n            <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">WhatsApp Phone Number</label>\r\n                <div className=\"relative\">\r\n                    <span className=\"absolute left-3 top-2.5 text-gray-400 font-medium\">+</span>\r\n                    <input \r\n                        type=\"text\" \r\n                        name=\"whatsappNumber\" \r\n                        value={formData.whatsappNumber} \r\n                        onChange={handleChange}\r\n                        placeholder=\"919876543210\"\r\n                        className=\"w-full pl-7 pr-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 outline-none transition text-sm\"\r\n                    />\r\n                </div>\r\n                <p className=\"text-xs text-gray-500 mt-1\">Include country code (e.g. 91 for India).</p>\r\n            </div>\r\n\r\n            <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">UPI ID (VPA)</label>\r\n                <input \r\n                    type=\"text\" \r\n                    name=\"upiId\" \r\n                    value={formData.upiId} \r\n                    onChange={handleChange}\r\n                    placeholder=\"merchant@upi\"\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 outline-none transition text-sm\"\r\n                />\r\n            </div>\r\n\r\n            <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Confirmation Instructions</label>\r\n                <textarea \r\n                    name=\"instructions\" \r\n                    rows={3}\r\n                    value={formData.instructions} \r\n                    onChange={handleChange}\r\n                    placeholder=\"E.g. Please pay via UPI and share the screenshot to confirm your order.\"\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 outline-none transition text-sm resize-none\"\r\n                />\r\n            </div>\r\n        </div>\r\n\r\n        <div className=\"pt-4 flex justify-end\">\r\n            <button \r\n                type=\"submit\" \r\n                disabled={isSaving}\r\n                className=\"flex items-center gap-2 bg-indigo-600 text-white px-6 py-2.5 rounded-md font-medium hover:bg-indigo-700 transition disabled:opacity-70 shadow-sm\"\r\n            >\r\n                {isSaving ? <Loader2 className=\"animate-spin\" size={18} /> : <Save size={18} />}\r\n                Save Settings\r\n            </button>\r\n        </div>\r\n    </form>\r\n  );\r\n}",
  "src\\features\\admin\\components\\VisitorAnalytics.js": "\"use client\";\r\n\r\nimport { motion } from \"framer-motion\";\r\nimport { Users, Activity, Clock } from \"lucide-react\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { getVisitorStats } from \"@/features/analytics/actions\";\r\n\r\nexport default function VisitorAnalytics({ stats: initialStats }) {\r\n  const [stats, setStats] = useState(initialStats);\r\n\r\n  // Poll for updates to ensure \"Real-Time\" data is accurate and not misleading\r\n  useEffect(() => {\r\n    const interval = setInterval(async () => {\r\n      try {\r\n        const freshStats = await getVisitorStats();\r\n        setStats(freshStats);\r\n      } catch (err) {\r\n        console.error(\"Analytics polling error:\", err);\r\n      }\r\n    }, 5000); // Update every 5 seconds\r\n\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  const activeUsers = stats?.activeUsers || 0;\r\n  const dailyVisits = stats?.dailyVisits || 0;\r\n  const data = stats?.hourlyTraffic || [];\r\n\r\n  // Determine scaling factor\r\n  const maxVisits = Math.max(...data.map(d => d.visits), 10);\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6\">\r\n      \r\n      {/* 1. Live Metrics Card */}\r\n      <div className=\"bg-white p-4 md:p-6 rounded-xl border border-gray-200 shadow-sm flex flex-col justify-between h-full\">\r\n        <div>\r\n            <div className=\"flex items-center justify-between mb-3\">\r\n                <h3 className=\"text-gray-500 font-medium text-xs uppercase tracking-wider\">Real-Time</h3>\r\n                <span className=\"relative flex h-2.5 w-2.5\">\r\n                  <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75\"></span>\r\n                  <span className=\"relative inline-flex rounded-full h-2.5 w-2.5 bg-green-500\"></span>\r\n                </span>\r\n            </div>\r\n            <div className=\"flex items-end gap-2 md:gap-3\">\r\n                <h2 className=\"text-3xl md:text-4xl font-bold text-gray-900 transition-all duration-300\">\r\n                    {activeUsers}\r\n                </h2>\r\n                <p className=\"text-xs md:text-sm text-gray-500 mb-1.5 font-medium\">Active Users</p>\r\n            </div>\r\n        </div>\r\n        <div className=\"mt-4 pt-3 border-t border-gray-100 flex items-center gap-2 text-xs md:text-sm text-gray-600\">\r\n            <Activity size={14} className=\"text-indigo-600\" />\r\n            <span>Browsing right now</span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* 2. Today's Traffic Card */}\r\n      <div className=\"bg-white p-4 md:p-6 rounded-xl border border-gray-200 shadow-sm flex flex-col justify-between h-full\">\r\n        <div>\r\n            <h3 className=\"text-gray-500 font-medium text-xs uppercase tracking-wider mb-3\">Today's Traffic</h3>\r\n            <div className=\"flex items-end gap-2 md:gap-3\">\r\n                <h2 className=\"text-3xl md:text-4xl font-bold text-gray-900 transition-all duration-300\">\r\n                    {dailyVisits}\r\n                </h2>\r\n                <p className=\"text-xs md:text-sm text-gray-500 mb-1.5 font-medium\">Total Visits</p>\r\n            </div>\r\n        </div>\r\n        <div className=\"mt-4 pt-3 border-t border-gray-100 flex items-center gap-2 text-xs md:text-sm text-gray-600\">\r\n            <Users size={14} className=\"text-blue-600\" />\r\n            <span>Unique sessions today</span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* 3. Hourly Trends Chart */}\r\n      <div className=\"bg-white p-4 md:p-6 rounded-xl border border-gray-200 shadow-sm lg:row-span-2 lg:col-span-3\">\r\n        <div className=\"flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-2\">\r\n            <div>\r\n                <h3 className=\"text-base md:text-lg font-bold text-gray-900\">Traffic Trends</h3>\r\n                <p className=\"text-xs md:text-sm text-gray-500\">Visitor activity over the last 24 hours</p>\r\n            </div>\r\n            <div className=\"self-start sm:self-auto flex items-center gap-2 px-2 py-1 bg-gray-50 rounded-full border border-gray-200 text-[10px] md:text-xs font-medium text-gray-600\">\r\n                <Clock size={12} /> 24 Hour View\r\n            </div>\r\n        </div>\r\n\r\n        {/* Custom Responsive Bar Chart Container */}\r\n        <div className=\"h-32 md:h-48 w-full flex items-end gap-0.5 sm:gap-2\">\r\n            {data.map((point, i) => {\r\n                const heightPercent = (point.visits / maxVisits) * 100;\r\n                return (\r\n                    <div key={i} className=\"flex-1 flex flex-col items-center group relative h-full justify-end\">\r\n                        {/* Tooltip (Hidden on small touch devices mostly) */}\r\n                        <div className=\"hidden sm:block absolute -top-8 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-[10px] py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10 pointer-events-none\">\r\n                            {point.visits} visits at {point.hour}\r\n                        </div>\r\n                        \r\n                        {/* Bar */}\r\n                        <motion.div \r\n                            initial={{ height: 0 }}\r\n                            animate={{ height: `${heightPercent}%` }}\r\n                            transition={{ duration: 0.5, delay: i * 0.02 }}\r\n                            className={`\r\n                                w-full max-w-[20px] sm:max-w-[30px] rounded-t-sm min-h-[4px] transition-colors\r\n                                ${heightPercent > 80 ? 'bg-indigo-600' : 'bg-indigo-200 group-hover:bg-indigo-400'}\r\n                            `}\r\n                        />\r\n                        \r\n                        {/* Label (Sparse labeling for mobile) */}\r\n                        {i % 4 === 0 && (\r\n                            <span className=\"text-[9px] md:text-[10px] text-gray-400 mt-1 absolute -bottom-5 md:-bottom-6\">{point.hour}</span>\r\n                        )}\r\n                    </div>\r\n                );\r\n            })}\r\n        </div>\r\n        {/* Spacer for bottom labels */}\r\n  \n\n// ‚úÇÔ∏è Truncated for AI (original 6071 characters)",
  "src\\features\\admin\\models\\Settings.js": "import mongoose from 'mongoose';\r\n\r\nconst SettingsSchema = new mongoose.Schema({\r\n  upiId: { type: String, default: '' },\r\n  whatsappNumber: { type: String, default: '' }, // e.g., \"919876543210\"\r\n  isWhatsAppEnabled: { type: Boolean, default: true },\r\n  instructions: { type: String, default: \"Please pay via UPI and share the screenshot.\" }\r\n}, { timestamps: true });\r\n\r\n// Singleton pattern: We typically only need one settings document\r\nexport default mongoose.models.Settings || mongoose.model('Settings', SettingsSchema);",
  "src\\features\\admin\\settings\\actions.js": "\"use server\";\r\n\r\nimport dbConnect from '@/lib/db';\r\nimport StoreSettings from './models/StoreSettings';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport const getStoreSettings = async () => {\r\n  await dbConnect();\r\n  \r\n  let settings = await StoreSettings.findOne().lean();\r\n  \r\n  if (!settings) {\r\n    settings = await StoreSettings.create({});\r\n    settings = await StoreSettings.findById(settings._id).lean();\r\n  }\r\n\r\n  // Ensure paymentGateways array exists\r\n  if (!settings.paymentGateways) settings.paymentGateways = [];\r\n\r\n  // SERIALIZATION FIX: Convert all ObjectIds and Dates to strings/numbers\r\n  const serializedSettings = JSON.parse(JSON.stringify({\r\n    ...settings,\r\n    _id: settings._id.toString(),\r\n    paymentGateways: settings.paymentGateways.map(gw => ({\r\n        ...gw,\r\n        _id: gw._id ? gw._id.toString() : undefined // Handle nested _id if it exists\r\n    }))\r\n  }));\r\n\r\n  return serializedSettings;\r\n};\r\n\r\nexport const updatePaymentGateway = async (gatewayId, enabled, configData) => {\r\n  await dbConnect();\r\n  try {\r\n    const settings = await StoreSettings.findOne();\r\n    \r\n    if (!settings) {\r\n        // Create initial if missing\r\n        await StoreSettings.create({\r\n            paymentGateways: [{ id: gatewayId, enabled, config: configData }]\r\n        });\r\n    } else {\r\n        // Find existing gateway index\r\n        const existingIndex = settings.paymentGateways.findIndex(g => g.id === gatewayId);\r\n        \r\n        if (existingIndex > -1) {\r\n            // Update existing\r\n            settings.paymentGateways[existingIndex].enabled = enabled;\r\n            settings.paymentGateways[existingIndex].config = configData;\r\n        } else {\r\n            // Add new\r\n            settings.paymentGateways.push({ id: gatewayId, enabled, config: configData });\r\n        }\r\n        await settings.save();\r\n    }\r\n    \r\n    revalidatePath('/'); // Refresh app\r\n    return { success: true, message: `${gatewayId} updated successfully` };\r\n  } catch (error) {\r\n    console.error(\"Update Error:\", error);\r\n    return { error: \"Failed to update settings\" };\r\n  }\r\n};",
  "src\\features\\admin\\settings\\components\\modules\\PaymentSettings.js": "\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { updatePaymentGateway } from \"../../actions\";\r\nimport { useToast } from \"@/context/ToastContext\";\r\nimport { Loader2, Save, ChevronDown, ChevronUp } from \"lucide-react\";\r\nimport { PAYMENT_GATEWAYS } from \"@/features/admin/settings/modules/payments/paymentRegistry\";\r\n\r\nexport default function PaymentSettings({ settings }) {\r\n  const { addToast } = useToast();\r\n  \r\n  return (\r\n    <div className=\"space-y-6\">\r\n       {PAYMENT_GATEWAYS.map((gateway) => {\r\n         const currentConfig = settings?.paymentGateways?.find(g => g.id === gateway.id) || {};\r\n         \r\n         return (\r\n           <PaymentGatewayCard \r\n              key={gateway.id}\r\n              gateway={gateway}\r\n              currentConfig={currentConfig}\r\n              onSave={async (enabled, data) => {\r\n                  const res = await updatePaymentGateway(gateway.id, enabled, data);\r\n                  if(res.success) addToast(`${gateway.label} settings saved`, \"success\");\r\n                  else addToast(res.error, \"error\");\r\n              }}\r\n           />\r\n         );\r\n       })}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction PaymentGatewayCard({ gateway, currentConfig, onSave }) {\r\n    const [enabled, setEnabled] = useState(currentConfig.enabled ?? false);\r\n    const [isExpanded, setIsExpanded] = useState(false);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        setIsSaving(true);\r\n        const formData = new FormData(e.target);\r\n        \r\n        // FIX: Sanitize all inputs by trimming whitespace\r\n        const data = {};\r\n        for (const [key, value] of formData.entries()) {\r\n            data[key] = typeof value === 'string' ? value.trim() : value;\r\n        }\r\n        \r\n        await onSave(enabled, data);\r\n        setIsSaving(false);\r\n    };\r\n\r\n    return (\r\n        <div className={`bg-white rounded-xl border transition-all duration-200 ${enabled ? 'border-indigo-200 shadow-sm' : 'border-gray-200 opacity-80 hover:opacity-100'}`}>\r\n            <div className=\"p-6 flex items-start justify-between\">\r\n                <div className=\"flex gap-4 cursor-pointer flex-1\" onClick={() => setIsExpanded(!isExpanded)}>\r\n                    <div className={`p-3 rounded-lg h-fit ${enabled ? 'bg-indigo-50' : 'bg-gray-100'}`}>\r\n                        {gateway.icon}\r\n                    </div>\r\n                    <div>\r\n                        <h3 className=\"font-semibold text-gray-900 flex items-center gap-2\">\r\n                            {gateway.label}\r\n                            {enabled && <span className=\"px-2 py-0.5 rounded-full bg-green-100 text-green-700 text-[10px] font-bold uppercase\">Active</span>}\r\n                        </h3>\r\n                        <p className=\"text-sm text-gray-500 mt-1 max-w-md\">{gateway.description}</p>\r\n                    </div>\r\n                </div>\r\n                \r\n                <div className=\"flex items-center gap-4\">\r\n                    <button onClick={() => setIsExpanded(!isExpanded)} className=\"text-gray-400 hover:text-gray-600\">\r\n                        {isExpanded ? <ChevronUp size={20} /> : <ChevronDown size={20} />}\r\n                    </button>\r\n                    <button \r\n                        type=\"button\"\r\n                        onClick={() => setEnabled(!enabled)}\r\n                        className={`relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none ${enabled ? 'bg-indigo-600' : 'bg-gray-200'}`}\r\n                    >\r\n                        <span className={`pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${enabled ? 'translate-x-5' : 'translate-x-0'}`} />\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {(isExpanded || enabled) && (\r\n                <form onSubmit={handleSubmit} className=\"border-t border-gray-100 p-6 bg-gray-50/50 rounded-b-xl animate-in slide-in-from-top-2\">\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                        {gateway.fields.map(field => (\r\n                            <div key={field.name} className={field.type === 'textarea' ? 'md:col-span-2' : ''}>\r\n                                <label className=\"block text-xs font-medium text-gray-700 mb-1.5 uppercase tracking-wide\">\r\n                                    {field.label} {field.required && <span className=\"text-red-500\">*</span>}\r\n                                </label>\r\n                                {field.type === 'textarea' ? (\r\n                                    <textarea \r\n                                        name={field.name}\r\n                                        defaultValue={currentConfig.config?.[field.name]}\r\n                                        rows={field.rows || 3}\r\n                                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 transition resize-none\"\r\n                                        required={field.required}\r\n                                    />\r\n                                ) : (\r\n                                    <input \r\n                                        type={field.type}\r\n                                        name={field.name}\r\n                                        defaultValue={currentConfig.config?.[field.name] || field.defaultValue}\r\n                                        placeholder={field.placeholder}\r\n                                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 transition\"\r\n                                        required={field.required}\r\n                                    />\r\n                                )}\r\n          \n\n// ‚úÇÔ∏è Truncated for AI (original 6781 characters)",
  "src\\features\\admin\\settings\\components\\SettingsLayout.js": "\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { CreditCard, Truck, Palette, Bell, Shield, Wallet } from \"lucide-react\";\r\nimport PaymentSettings from \"./modules/PaymentSettings\";\r\n\r\nexport default function SettingsLayout({ initialSettings }) {\r\n  const [activeTab, setActiveTab] = useState(\"payments\");\r\n\r\n  // Navigation Items\r\n  const tabs = [\r\n    { id: \"payments\", label: \"Payments\", icon: <CreditCard size={18} /> },\r\n    { id: \"shipping\", label: \"Shipping\", icon: <Truck size={18} /> },\r\n    { id: \"branding\", label: \"Branding\", icon: <Palette size={18} /> },\r\n    { id: \"notifications\", label: \"Notifications\", icon: <Bell size={18} /> },\r\n    { id: \"security\", label: \"Security\", icon: <Shield size={18} /> },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"flex flex-col md:flex-row gap-6 md:gap-8\">\r\n       \r\n       {/* 1. Navigation Sidebar */}\r\n       <nav className=\"w-full md:w-64 flex-shrink-0\">\r\n          <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden\">\r\n             {tabs.map((tab) => (\r\n                <button\r\n                   key={tab.id}\r\n                   onClick={() => setActiveTab(tab.id)}\r\n                   className={`\r\n                      w-full flex items-center gap-3 px-4 py-3 text-sm font-medium transition-colors text-left border-l-4\r\n                      ${activeTab === tab.id \r\n                         ? 'bg-indigo-50 text-indigo-700 border-indigo-600' \r\n                         : 'text-gray-600 hover:bg-gray-50 border-transparent'\r\n                      }\r\n                   `}\r\n                >\r\n                   {tab.icon} {tab.label}\r\n                </button>\r\n             ))}\r\n          </div>\r\n       </nav>\r\n\r\n       {/* 2. Main Content Area */}\r\n       <div className=\"flex-1 min-h-[400px]\">\r\n          {activeTab === 'payments' && <PaymentSettings settings={initialSettings.payments} />}\r\n          \r\n          {activeTab === 'shipping' && (\r\n             <PlaceholderModule title=\"Shipping Configuration\" icon={<Truck size={32} />} />\r\n          )}\r\n          {activeTab === 'branding' && (\r\n             <PlaceholderModule title=\"Store Branding\" icon={<Palette size={32} />} />\r\n          )}\r\n          {activeTab === 'notifications' && (\r\n             <PlaceholderModule title=\"Notification Rules\" icon={<Bell size={32} />} />\r\n          )}\r\n          {activeTab === 'security' && (\r\n             <PlaceholderModule title=\"Security Settings\" icon={<Shield size={32} />} />\r\n          )}\r\n       </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction PlaceholderModule({ title, icon }) {\r\n    return (\r\n        <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm p-12 text-center flex flex-col items-center justify-center h-full text-gray-400\">\r\n            <div className=\"bg-gray-50 p-4 rounded-full mb-4\">{icon}</div>\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-1\">{title}</h3>\r\n            <p>This module is coming soon.</p>\r\n        </div>\r\n    )\r\n}",
  "src\\features\\admin\\settings\\models\\StoreSettings.js": "import mongoose from 'mongoose';\r\n\r\nconst StoreSettingsSchema = new mongoose.Schema({\r\n  // Dynamic Payment Configs: stored as an array of objects\r\n  paymentGateways: [\r\n    {\r\n      id: { type: String, required: true }, // e.g. 'whatsapp', 'cod'\r\n      enabled: { type: Boolean, default: false },\r\n      config: { type: mongoose.Schema.Types.Mixed, default: {} } // Flexible config storage\r\n    }\r\n  ],\r\n\r\n  // Branding (Standard fields)\r\n  branding: {\r\n    storeName: { type: String, default: 'Dream Collection' },\r\n    currency: { type: String, default: 'USD' },\r\n    logoUrl: { type: String }\r\n  },\r\n\r\n  // Shipping\r\n  shipping: {\r\n    freeShippingThreshold: { type: Number, default: 0 },\r\n    standardRate: { type: Number, default: 0 }\r\n  }\r\n}, { timestamps: true });\r\n\r\nexport default mongoose.models.StoreSettings || mongoose.model('StoreSettings', StoreSettingsSchema);",
  "src\\features\\admin\\settings\\modules\\payments\\paymentRegistry.js": "import { MessageCircle, Banknote, CreditCard, Smartphone, DollarSign } from \"lucide-react\";\r\n\r\nexport const PAYMENT_GATEWAYS = [\r\n  {\r\n    id: \"whatsapp\",\r\n    label: \"Order on WhatsApp\",\r\n    description: \"Allow customers to place orders via WhatsApp message and pay via UPI.\",\r\n    icon: <MessageCircle size={24} className=\"text-green-600\" />,\r\n    supportsRedirect: true, \r\n    fields: [\r\n      { name: \"phone\", label: \"WhatsApp Number (with country code)\", type: \"tel\", placeholder: \"919876543210\", required: true },\r\n      { name: \"upiId\", label: \"UPI ID (VPA)\", type: \"text\", placeholder: \"merchant@upi\", required: true },\r\n      { name: \"instructions\", label: \"Payment Instructions\", type: \"textarea\", placeholder: \"Please pay via UPI and share screenshot...\", rows: 3 }\r\n    ]\r\n  },\r\n  {\r\n    id: \"cod\",\r\n    label: \"Cash on Delivery (COD)\",\r\n    description: \"Accept cash payments when the order is delivered.\",\r\n    icon: <Banknote size={24} className=\"text-gray-600\" />,\r\n    supportsRedirect: false,\r\n    fields: [\r\n      { name: \"label\", label: \"Checkout Label\", type: \"text\", defaultValue: \"Cash on Delivery\", required: true },\r\n      { name: \"additionalFee\", label: \"Additional Fee (Optional)\", type: \"number\", placeholder: \"0\" }\r\n    ]\r\n  },\r\n  {\r\n    id: \"stripe\",\r\n    label: \"Stripe\",\r\n    description: \"Accept credit/debit cards securely via Stripe.\",\r\n    icon: <CreditCard size={24} className=\"text-indigo-600\" />,\r\n    supportsRedirect: true,\r\n    fields: [\r\n      { name: \"publishableKey\", label: \"Publishable Key\", type: \"text\", required: true },\r\n      { name: \"secretKey\", label: \"Secret Key\", type: \"password\", required: true }\r\n    ]\r\n  },\r\n  {\r\n    id: \"razorpay\",\r\n    label: \"Razorpay\",\r\n    description: \"Indian payment gateway for Cards, UPI, and Netbanking.\",\r\n    icon: <Smartphone size={24} className=\"text-blue-600\" />,\r\n    supportsRedirect: true,\r\n    fields: [\r\n      { name: \"keyId\", label: \"Key ID\", type: \"text\", required: true },\r\n      { name: \"keySecret\", label: \"Key Secret\", type: \"password\", required: true }\r\n    ]\r\n  }\r\n];\r\n\r\nexport const getGatewayConfig = (id) => PAYMENT_GATEWAYS.find(g => g.id === id);",
  "src\\features\\admin\\settingsActions.js": "\"use server\";\r\n\r\nimport dbConnect from '@/lib/db';\r\nimport Settings from './models/Settings';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport const getStoreSettings = async () => {\r\n  await dbConnect();\r\n  const settings = await Settings.findOne().lean();\r\n  if (!settings) {\r\n     // Create default if not exists\r\n     return { upiId: \"\", whatsappNumber: \"\", isWhatsAppEnabled: false, instructions: \"\" };\r\n  }\r\n  return { ...settings, _id: settings._id.toString() };\r\n};\r\n\r\nexport const updateStoreSettings = async (data) => {\r\n  await dbConnect();\r\n  try {\r\n    // Upsert (Update if exists, insert if not)\r\n    await Settings.findOneAndUpdate({}, data, { upsert: true, new: true });\r\n    revalidatePath('/'); // Revalidate everywhere to reflect changes immediately\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { error: \"Failed to save settings\" };\r\n  }\r\n};",
  "src\\features\\analytics\\actions.js": "\"use server\";\r\n\r\nimport dbConnect from '@/lib/db';\r\nimport VisitorLog from './models/VisitorLog';\r\n\r\n// --- 1. Track a Visit ---\r\nexport const trackVisit = async (path) => {\r\n  try {\r\n    await dbConnect();\r\n    // Fire and forget - don't await this to keep UI fast\r\n    VisitorLog.create({ page: path }); \r\n  } catch (error) {\r\n    console.error(\"Tracking Error:\", error);\r\n  }\r\n};\r\n\r\n// --- 2. Get Dashboard Stats ---\r\nexport const getVisitorStats = async () => {\r\n  await dbConnect();\r\n  \r\n  const now = new Date();\r\n  \r\n  // A. Active Users (Last 5 minutes)\r\n  const fiveMinutesAgo = new Date(now.getTime() - 5 * 60 * 1000);\r\n  \r\n  // B. Daily Visits (Since start of today)\r\n  const startOfDay = new Date(now);\r\n  startOfDay.setHours(0, 0, 0, 0);\r\n\r\n  // C. Hourly Traffic (Last 24 hours for Graph)\r\n  const twentyFourHoursAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);\r\n\r\n  try {\r\n    const [activeUsers, dailyVisits, hourlyData] = await Promise.all([\r\n      // Count visits in last 5 mins\r\n      VisitorLog.countDocuments({ timestamp: { $gte: fiveMinutesAgo } }),\r\n      \r\n      // Count visits today\r\n      VisitorLog.countDocuments({ timestamp: { $gte: startOfDay } }),\r\n      \r\n      // Aggregate last 24h by hour\r\n      VisitorLog.aggregate([\r\n        { $match: { timestamp: { $gte: twentyFourHoursAgo } } },\r\n        { \r\n          $group: { \r\n            _id: { $hour: \"$timestamp\" }, // Group by Hour (0-23)\r\n            count: { $sum: 1 } \r\n          }\r\n        },\r\n        { $sort: { \"_id\": 1 } }\r\n      ])\r\n    ]);\r\n\r\n    // Format Hourly Data for Chart (Fill missing hours with 0)\r\n    const formattedHourly = Array.from({ length: 24 }, (_, i) => {\r\n      const hourData = hourlyData.find(d => d._id === i);\r\n      return { hour: `${i}:00`, visits: hourData ? hourData.count : 0 };\r\n    });\r\n\r\n    return {\r\n      activeUsers,\r\n      dailyVisits,\r\n      hourlyTraffic: formattedHourly\r\n    };\r\n\r\n  } catch (error) {\r\n    console.error(\"Analytics Stats Error:\", error);\r\n    return { activeUsers: 0, dailyVisits: 0, hourlyTraffic: [] };\r\n  }\r\n};",
  "src\\features\\analytics\\components\\AnalyticsTracker.js": "\"use client\";\r\n\r\nimport { useEffect } from \"react\";\r\nimport { usePathname } from \"next/navigation\";\r\nimport { trackVisit } from \"../actions\";\r\n\r\nexport default function AnalyticsTracker() {\r\n  const pathname = usePathname();\r\n\r\n  useEffect(() => {\r\n    // Avoid tracking admin pages to keep data clean\r\n    if (!pathname.startsWith(\"/admin\")) {\r\n        trackVisit(pathname);\r\n    }\r\n  }, [pathname]);\r\n\r\n  return null; // Invisible component\r\n}",
  "src\\features\\analytics\\models\\VisitorLog.js": "import mongoose from 'mongoose';\r\n\r\nconst VisitorLogSchema = new mongoose.Schema({\r\n  timestamp: { type: Date, default: Date.now },\r\n  page: { type: String }, // Optional: Track which page was visited\r\n  // We don't store IPs to respect basic privacy/GDPR, but you could hash session IDs here\r\n}, { timestamps: false }); // Disable default timestamps as we have our own indexed timestamp\r\n\r\n// Index for fast date-range queries\r\nVisitorLogSchema.index({ timestamp: 1 });\r\n\r\nexport default mongoose.models.VisitorLog || mongoose.model('VisitorLog', VisitorLogSchema);",
  "src\\features\\auth\\actions.js": "\"use server\";\r\n\r\nimport dbConnect from \"@/lib/db\";\r\nimport { User } from \"./models/User\";\r\nimport bcrypt from \"bcryptjs\";\r\nimport crypto from \"crypto\";\r\nimport { sendVerificationEmail, sendPasswordResetEmail } from \"@/lib/mail\";\r\n\r\n// --- Registration ---\r\nexport const registerUser = async (formData) => {\r\n  const { name, email, password } = formData;\r\n\r\n  try {\r\n    await dbConnect();\r\n    const existingUser = await User.findOne({ email });\r\n    if (existingUser) return { error: \"User already exists!\" };\r\n\r\n    const hashedPassword = await bcrypt.hash(password, 10);\r\n    \r\n    const verificationToken = crypto.randomBytes(32).toString(\"hex\");\r\n    const verificationTokenExpire = Date.now() + 24 * 60 * 60 * 1000; \r\n\r\n    const newUser = new User({ \r\n        name, \r\n        email, \r\n        password: hashedPassword,\r\n        isVerified: false,\r\n        verificationToken,\r\n        verificationTokenExpire\r\n    });\r\n\r\n    await newUser.save();\r\n    await sendVerificationEmail(email, verificationToken);\r\n\r\n    return { success: true, message: \"Confirmation email sent!\" };\r\n\r\n  } catch (err) {\r\n    console.error(\"Registration Error:\", err);\r\n    return { error: \"Something went wrong!\" };\r\n  }\r\n};\r\n\r\n// --- Resend Verification Email ---\r\nexport const resendVerificationEmail = async (email) => {\r\n  try {\r\n    await dbConnect();\r\n    const user = await User.findOne({ email });\r\n\r\n    if (!user) return { error: \"User not found.\" };\r\n    if (user.isVerified) return { error: \"Email is already verified. Please login.\" };\r\n\r\n    const verificationToken = crypto.randomBytes(32).toString(\"hex\");\r\n    user.verificationToken = verificationToken;\r\n    user.verificationTokenExpire = Date.now() + 24 * 60 * 60 * 1000;\r\n    \r\n    await user.save();\r\n    await sendVerificationEmail(email, verificationToken);\r\n\r\n    return { success: true, message: \"Verification email resent!\" };\r\n  } catch (err) {\r\n    console.error(\"Resend Error:\", err);\r\n    return { error: \"Failed to resend email.\" };\r\n  }\r\n};\r\n\r\n// --- Verify Email ---\r\nexport const verifyEmail = async (token) => {\r\n    await dbConnect();\r\n    const user = await User.findOne({\r\n        verificationToken: token,\r\n        verificationTokenExpire: { $gt: Date.now() }\r\n    });\r\n\r\n    if (!user) return { error: \"Invalid or expired token\" };\r\n\r\n    user.isVerified = true;\r\n    user.verificationToken = undefined;\r\n    user.verificationTokenExpire = undefined;\r\n    await user.save();\r\n\r\n    return { success: true, message: \"Email verified successfully!\" };\r\n};\r\n\r\n// --- Password Reset Request ---\r\nexport const requestPasswordReset = async (email) => {\r\n  await dbConnect();\r\n  try {\r\n    const user = await User.findOne({ email, provider: \"credentials\" });\r\n    if (!user) return { success: true, message: \"If an account exists, a reset link has been sent.\" };\r\n\r\n    const resetToken = crypto.randomBytes(20).toString(\"hex\");\r\n    const resetTokenHash = crypto.createHash(\"sha256\").update(resetToken).digest(\"hex\");\r\n\r\n    user.resetPasswordToken = resetTokenHash;\r\n    user.resetPasswordExpire = Date.now() + 10 * 60 * 1000;\r\n    await user.save();\r\n\r\n    await sendPasswordResetEmail(user.email, resetToken);\r\n    return { success: true, message: \"Reset link sent to your email!\" };\r\n\r\n  } catch (error) {\r\n    return { error: \"Failed to process request\" };\r\n  }\r\n};\r\n\r\n// --- Reset Password ---\r\nexport const resetPassword = async (token, newPassword) => {\r\n  await dbConnect();\r\n  try {\r\n    const resetTokenHash = crypto.createHash(\"sha256\").update(token).digest(\"hex\");\r\n    const user = await User.findOne({\r\n      resetPasswordToken: resetTokenHash,\r\n      resetPasswordExpire: { $gt: Date.now() },\r\n    });\r\n\r\n    if (!user) return { error: \"Invalid or expired token\" };\r\n\r\n    user.password = await bcrypt.hash(newPassword, 10);\r\n    user.resetPasswordToken = undefined;\r\n    user.resetPasswordExpire = undefined;\r\n    await user.save();\r\n    return { success: true };\r\n\r\n  } catch (error) {\r\n    return { error: \"Failed to reset password\" };\r\n  }\r\n};",
  "src\\features\\auth\\authSlice.js": "import { createSlice } from \"@reduxjs/toolkit\";\r\n\r\nconst initialState = {\r\n  userInfo: null, // Will hold { name, email, isAdmin, etc }\r\n  isAuthenticated: false,\r\n};\r\n\r\nconst authSlice = createSlice({\r\n  name: \"auth\",\r\n  initialState,\r\n  reducers: {\r\n    setCredentials: (state, action) => {\r\n      state.userInfo = action.payload;\r\n      state.isAuthenticated = true;\r\n    },\r\n    logout: (state) => {\r\n      state.userInfo = null;\r\n      state.isAuthenticated = false;\r\n    },\r\n  },\r\n});\r\n\r\nexport const { setCredentials, logout } = authSlice.actions;\r\nexport default authSlice.reducer;",
  "src\\features\\auth\\components\\AuthProvider.jsx": "\"use client\";\r\n\r\nimport { useSession } from \"next-auth/react\";\r\nimport { useEffect } from \"react\";\r\nimport { useAppDispatch } from \"@/lib/hooks\";\r\nimport { setCredentials } from \"../authSlice\";\r\n\r\nexport default function AuthProvider({ children }) {\r\n  const { data: session } = useSession();\r\n  const dispatch = useAppDispatch();\r\n\r\n  useEffect(() => {\r\n    if (session?.user) {\r\n      dispatch(setCredentials(session.user));\r\n    }\r\n  }, [session, dispatch]);\r\n\r\n  return <>{children}</>;\r\n}",
  "src\\features\\auth\\components\\ForgotPasswordForm.jsx": "\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { requestPasswordReset } from \"../actions\";\r\nimport { useToast } from \"@/context/ToastContext\";\r\nimport { Loader2, ArrowLeft, Mail, AlertCircle, Lock } from \"lucide-react\";\r\nimport Link from \"next/link\";\r\nimport { useSearchParams } from \"next/navigation\";\r\n\r\nexport default function ForgotPasswordForm() {\r\n  const { addToast } = useToast();\r\n  const searchParams = useSearchParams();\r\n  \r\n  // Auto-fill from URL param if available\r\n  const email = searchParams.get(\"email\");\r\n  \r\n  const [loading, setLoading] = useState(false);\r\n  const [isSent, setIsSent] = useState(false);\r\n\r\n  // If accessed directly without email, force back to login to ensure validation\r\n  if (!email) {\r\n    return (\r\n        <div className=\"bg-white py-8 px-6 shadow-xl sm:rounded-xl sm:px-10 border border-gray-100 text-center\">\r\n            <div className=\"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4\">\r\n                <AlertCircle className=\"h-6 w-6 text-red-600\" />\r\n            </div>\r\n            <h3 className=\"text-lg font-bold text-gray-900 mb-2\">Email Required</h3>\r\n            <p className=\"text-sm text-gray-500 mb-6\">\r\n                Please go back to the login page and enter your email address to reset your password.\r\n            </p>\r\n            <Link href=\"/login\">\r\n                <Button variant=\"outline\" className=\"w-full\">Back to Login</Button>\r\n            </Link>\r\n        </div>\r\n    );\r\n  }\r\n\r\n  const handleSendReset = async () => {\r\n    setLoading(true);\r\n    const res = await requestPasswordReset(email);\r\n\r\n    if (res.success) {\r\n      setIsSent(true);\r\n      addToast(res.message, \"success\");\r\n    } else {\r\n      addToast(res.error, \"error\");\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  if (isSent) {\r\n    return (\r\n      <div className=\"bg-white py-8 px-6 shadow-xl sm:rounded-xl sm:px-10 border border-gray-100 text-center animate-in fade-in zoom-in-95\">\r\n        <div className=\"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4\">\r\n          <Mail className=\"h-6 w-6 text-green-600\" />\r\n        </div>\r\n        <h3 className=\"text-xl font-bold text-gray-900 mb-2\">Check your email</h3>\r\n        <p className=\"text-sm text-gray-500 mb-6\">\r\n          We have sent a password reset link to <br/><strong>{email}</strong>.\r\n        </p>\r\n        <div className=\"text-xs text-gray-400 mb-6 bg-gray-50 p-3 rounded\">\r\n            Click the link in the email to sign in or set a new password.\r\n        </div>\r\n        <Link href=\"/login\">\r\n            <Button variant=\"outline\" className=\"w-full\">Back to Login</Button>\r\n        </Link>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-white py-8 px-6 shadow-xl sm:rounded-xl sm:px-10 border border-gray-100 text-center\">\r\n      <div className=\"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100 mb-4\">\r\n          <Lock className=\"h-6 w-6 text-indigo-600\" />\r\n      </div>\r\n      \r\n      <h3 className=\"text-xl font-bold text-gray-900 mb-2\">Reset Password</h3>\r\n      \r\n      <p className=\"text-sm text-gray-500 mb-6\">\r\n        Send password reset instructions to:<br/>\r\n        <span className=\"font-medium text-gray-900\">{email}</span>\r\n      </p>\r\n\r\n      <div className=\"space-y-3\">\r\n        <Button \r\n            onClick={handleSendReset} \r\n            disabled={loading} \r\n            className=\"w-full bg-indigo-600 hover:bg-indigo-700 text-white\"\r\n        >\r\n            {loading ? <Loader2 className=\"animate-spin mr-2\" size={18} /> : null}\r\n            Send Reset Link\r\n        </Button>\r\n        \r\n        <Link href=\"/login\">\r\n             <Button variant=\"ghost\" className=\"w-full text-gray-500\">Cancel</Button>\r\n        </Link>\r\n      </div>\r\n    </div>\r\n  );\r\n}",
  "src\\features\\auth\\components\\LoginForm.jsx": "\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { signIn } from \"next-auth/react\";\r\nimport { useRouter, useSearchParams } from \"next/navigation\";\r\nimport { Button } from \"@/components/ui/button\"; \r\nimport { Input } from \"@/components/ui/input\";\r\nimport { registerUser, resendVerificationEmail } from \"../actions\";\r\nimport { useToast } from \"@/context/ToastContext\";\r\nimport { Loader2, Mail, Lock, User, RefreshCw } from \"lucide-react\";\r\nimport Link from \"next/link\"; \r\n\r\nconst LoginForm = () => {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n  const callbackUrl = searchParams.get(\"callbackUrl\") || \"/\";\r\n  const { addToast } = useToast();\r\n\r\n  const [isLogin, setIsLogin] = useState(true);\r\n  const [loading, setLoading] = useState(false);\r\n  const [success, setSuccess] = useState(false);\r\n  const [unverifiedEmail, setUnverifiedEmail] = useState(null);\r\n  \r\n  const [formData, setFormData] = useState({\r\n    name: \"\",\r\n    email: \"\",\r\n    password: \"\"\r\n  });\r\n\r\n  const handleChange = (e) => {\r\n    setFormData({ ...formData, [e.target.name]: e.target.value });\r\n  };\r\n\r\n  const handleResend = async () => {\r\n    if (!unverifiedEmail) return;\r\n    setLoading(true);\r\n    const res = await resendVerificationEmail(unverifiedEmail);\r\n    setLoading(false);\r\n    if (res.success) {\r\n        addToast(\"Verification email sent!\", \"success\");\r\n        setUnverifiedEmail(null); \r\n    } else {\r\n        addToast(res.error, \"error\");\r\n    }\r\n  };\r\n\r\n  const handleForgotPassword = () => {\r\n    const cleanEmail = formData.email.trim().toLowerCase();\r\n    if (!cleanEmail || !cleanEmail.includes(\"@\")) {\r\n        addToast(\"Please enter your email to reset password.\", \"warning\");\r\n        return;\r\n    }\r\n    router.push(`/forgot-password?email=${encodeURIComponent(cleanEmail)}`);\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    setUnverifiedEmail(null);\r\n    \r\n    const cleanData = {\r\n        ...formData,\r\n        email: formData.email.trim().toLowerCase()\r\n    };\r\n\r\n    if (isLogin) {\r\n      const res = await signIn(\"credentials\", {\r\n        email: cleanData.email,\r\n        password: cleanData.password,\r\n        redirect: false,\r\n      });\r\n\r\n      if (res?.error) {\r\n        if (res.error === \"unverified\") {\r\n            setUnverifiedEmail(cleanData.email);\r\n            addToast(\"Account not verified. Please check your email.\", \"warning\");\r\n        } else {\r\n            addToast(\"Invalid email or password.\", \"error\");\r\n        }\r\n        setLoading(false);\r\n      } else {\r\n        addToast(\"Welcome back!\", \"success\");\r\n        router.push(callbackUrl);\r\n        router.refresh();\r\n      }\r\n    } else {\r\n      const res = await registerUser(cleanData);\r\n      \r\n      if (res.error) {\r\n        addToast(res.error, \"error\");\r\n        setLoading(false);\r\n      } else {\r\n        setSuccess(true);\r\n        setLoading(false);\r\n      }\r\n    }\r\n  };\r\n\r\n  if (success) {\r\n    return (\r\n        <div className=\"bg-white py-10 px-6 shadow-xl sm:rounded-xl sm:px-10 border border-gray-100 text-center\">\r\n            <div className=\"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-6\">\r\n                <Mail className=\"h-8 w-8 text-green-600\" />\r\n            </div>\r\n            <h3 className=\"text-2xl font-bold text-gray-900 mb-2\">Check your email</h3>\r\n            <p className=\"text-gray-500 mb-8\">\r\n                Verification link sent to <span className=\"font-medium text-gray-900\">{formData.email}</span>.\r\n            </p>\r\n            <Button onClick={() => setIsLogin(true) || setSuccess(false)} variant=\"outline\" className=\"w-full\">\r\n                Back to Login\r\n            </Button>\r\n        </div>\r\n    );\r\n  }\r\n\r\n  if (unverifiedEmail) {\r\n    return (\r\n        <div className=\"bg-white py-10 px-6 shadow-xl sm:rounded-xl sm:px-10 border border-gray-100 text-center\">\r\n            <div className=\"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-amber-100 mb-6\">\r\n                <Mail className=\"h-8 w-8 text-amber-600\" />\r\n            </div>\r\n            <h3 className=\"text-xl font-bold text-gray-900 mb-2\">Verification Required</h3>\r\n            <p className=\"text-gray-500 mb-6 text-sm\">\r\n                Verify <strong>{unverifiedEmail}</strong> to continue.\r\n            </p>\r\n            <div className=\"space-y-3\">\r\n                <Button onClick={handleResend} disabled={loading} className=\"w-full bg-indigo-600 hover:bg-indigo-700 text-white\">\r\n                    {loading ? <Loader2 className=\"animate-spin mr-2\" size={18} /> : <RefreshCw className=\"mr-2\" size={18} />}\r\n                    Resend Email\r\n                </Button>\r\n                <Button onClick={() => setUnverifiedEmail(null)} variant=\"ghost\" className=\"w-full\">\r\n                    Use a different email\r\n                </Button>\r\n            </div>\r\n        </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-white py-8 px-4 shadow-xl sm:rounded-xl sm:px-10 border border-gray-100\">\r\n      <div className=\"mb-6\">\r\n        <h3 className=\"text-xl font-bold text-gray-900\">\r\n            {isLogin ? \"Sign in to your account\" : \"Create your account\"}\r\n        </h3>\r\n        <p className=\"text-sm text-gray-500 mt-1\">\r\n            {isLogin ? \"Access your orders & wishlist.\" : \"Join us to start collecting today.\"}\r\n        </p>\r\n      </div>\r\n\r\n      <form className=\"space-y-5\" onSubmit={handleSubmit}>\r\n        {!isLogin && (\r\n            <div className=\"relative\">\r\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400\">\r\n                    <User size={18} />\r\n                </div>\r\n                <Input \r\n                    name=\"name\"\r\n                    type=\"text\" \r\n                    placeholder=\"Full Name\" \r\n                    value={formData.name}\r\n                    onChange={handleChange}\r\n                    className=\"pl-10\"\r\n                    required\r\n \n\n// ‚úÇÔ∏è Truncated for AI (original 9716 characters)",
  "src\\features\\auth\\components\\ResetPasswordForm.jsx": "\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { resetPassword } from \"../actions\";\r\nimport { useToast } from \"@/context/ToastContext\";\r\nimport { Loader2, Lock } from \"lucide-react\";\r\n\r\nexport default function ResetPasswordForm({ token }) {\r\n  const router = useRouter();\r\n  const { addToast } = useToast();\r\n  const [password, setPassword] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (password.length < 6) {\r\n        addToast(\"Password must be at least 6 characters\", \"warning\");\r\n        return;\r\n    }\r\n    \r\n    setLoading(true);\r\n    const res = await resetPassword(token, password);\r\n\r\n    if (res.success) {\r\n      addToast(\"Password reset successfully! Login now.\", \"success\");\r\n      router.push(\"/login\");\r\n    } else {\r\n      addToast(res.error, \"error\");\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white py-8 px-6 shadow-xl sm:rounded-xl sm:px-10 border border-gray-100\">\r\n      <div className=\"mb-6\">\r\n        <h3 className=\"text-xl font-bold text-gray-900\">Set New Password</h3>\r\n        <p className=\"text-sm text-gray-500 mt-1\">\r\n          Your new password must be different to previously used passwords.\r\n        </p>\r\n      </div>\r\n\r\n      <form className=\"space-y-5\" onSubmit={handleSubmit}>\r\n        <div className=\"relative\">\r\n             <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400\">\r\n                <Lock size={18} />\r\n            </div>\r\n            <Input \r\n                type=\"password\" \r\n                placeholder=\"New Password\" \r\n                value={password}\r\n                onChange={(e) => setPassword(e.target.value)}\r\n                className=\"pl-10\"\r\n                required \r\n                disabled={loading}\r\n            />\r\n        </div>\r\n\r\n        <Button type=\"submit\" disabled={loading} className=\"w-full bg-indigo-600 hover:bg-indigo-700 text-white\">\r\n            {loading ? <Loader2 className=\"animate-spin mr-2\" size={18} /> : null}\r\n            Reset Password\r\n        </Button>\r\n      </form>\r\n    </div>\r\n  );\r\n}",
  "src\\features\\auth\\components\\SessionWrapper.jsx": "\"use client\";\r\nimport { SessionProvider } from \"next-auth/react\";\r\n\r\nexport default function SessionWrapper({ children }) {\r\n  return <SessionProvider>{children}</SessionProvider>;\r\n}",
  "src\\features\\auth\\models\\User.js": "import mongoose from \"mongoose\";\r\n\r\nconst userSchema = new mongoose.Schema({\r\n  name: { type: String, required: true },\r\n  email: { type: String, required: true, unique: true },\r\n  password: { type: String }, \r\n  image: { type: String },\r\n  phone: { type: String },\r\n  isAdmin: { type: Boolean, default: false },\r\n  provider: { type: String, default: \"credentials\" },\r\n  \r\n  // --- Verification & Security ---\r\n  isVerified: { type: Boolean, default: false },\r\n  verificationToken: { type: String },\r\n  verificationTokenExpire: { type: Date },\r\n\r\n  resetPasswordToken: { type: String },\r\n  resetPasswordExpire: { type: Date },\r\n  \r\n}, { timestamps: true });\r\n\r\nexport const User = mongoose.models?.User || mongoose.model(\"User\", userSchema);",
  "src\\features\\cart\\actions.js": "\"use server\";\r\n\r\nimport dbConnect from '@/lib/db';\r\nimport Cart from './models/Cart';\r\nimport Product from '@/features/product/models/Product';\r\n\r\n// 1. Fetch Cart\r\nexport const fetchCart = async (userId) => {\r\n  if (!userId) return null;\r\n  try {\r\n    await dbConnect();\r\n    const cart = await Cart.findOne({ userId }).lean();\r\n    if (cart) {\r\n      return {\r\n        items: cart.items,\r\n        totalQuantity: cart.totalQuantity,\r\n        totalPrice: cart.totalPrice\r\n      };\r\n    }\r\n    return null;\r\n  } catch (error) {\r\n    console.error(\"Failed to fetch cart:\", error);\r\n    return null;\r\n  }\r\n};\r\n\r\n// 2. Save Cart\r\nexport const saveCartToDB = async (userId, cartData) => {\r\n  if (!userId) return;\r\n  try {\r\n    await dbConnect();\r\n    await Cart.findOneAndUpdate(\r\n      { userId },\r\n      { \r\n        userId,\r\n        items: cartData.items,\r\n        totalQuantity: cartData.totalQuantity,\r\n        totalPrice: cartData.totalPrice\r\n      },\r\n      { upsert: true, new: true }\r\n    );\r\n  } catch (error) {\r\n    console.error(\"Failed to save cart:\", error);\r\n  }\r\n};\r\n\r\n// 3. Validate Cart (Validation Guard)\r\nexport const validateCart = async (clientItems) => {\r\n  await dbConnect();\r\n  \r\n  // FIX: Gracefully handle empty/null inputs\r\n  if (!clientItems || !Array.isArray(clientItems) || clientItems.length === 0) {\r\n    return {\r\n        cart: { items: [], totalQuantity: 0, totalPrice: 0 },\r\n        warnings: []\r\n    };\r\n  }\r\n\r\n  const validatedItems = [];\r\n  let totalQuantity = 0;\r\n  let totalPrice = 0;\r\n  const warnings = [];\r\n\r\n  for (const item of clientItems) {\r\n    // 1. Fetch latest product data\r\n    const product = await Product.findById(item._id).lean();\r\n\r\n    // Case A: Product Deleted or Hidden\r\n    if (!product) {\r\n      warnings.push(`\"${item.name}\" is no longer available and was removed.`);\r\n      continue;\r\n    }\r\n\r\n    // Case B: Out of Stock\r\n    if (!product.inStock) {\r\n      warnings.push(`\"${product.name}\" is currently out of stock.`);\r\n      continue;\r\n    }\r\n\r\n    // Case C: Price Changed\r\n    if (product.price !== item.price) {\r\n      warnings.push(`Price for \"${product.name}\" updated from $${item.price} to $${product.price}.`);\r\n    }\r\n\r\n    // Add to valid list with SERVER-SIDE price\r\n    validatedItems.push({\r\n      _id: product._id.toString(),\r\n      name: product.name,\r\n      price: product.price, // Trust server price ONLY\r\n      image: product.images?.[0] || \"\",\r\n      slug: product.slug,\r\n      quantity: item.quantity,\r\n      series: product.series,\r\n      year: product.year\r\n    });\r\n\r\n    totalQuantity += item.quantity;\r\n    totalPrice += product.price * item.quantity;\r\n  }\r\n\r\n  return {\r\n    cart: {\r\n      items: validatedItems,\r\n      totalQuantity,\r\n      totalPrice\r\n    },\r\n    warnings\r\n  };\r\n};",
  "src\\features\\cart\\cartSlice.js": "import { createSlice } from '@reduxjs/toolkit';\r\n\r\nconst initialState = {\r\n  items: [],      \r\n  totalQuantity: 0,\r\n  totalPrice: 0,\r\n  isLoaded: false,\r\n};\r\n\r\nconst cartSlice = createSlice({\r\n  name: 'cart',\r\n  initialState,\r\n  reducers: {\r\n    // Action to replace entire cart (used for DB fetch and Validation sync)\r\n    setCart: (state, action) => {\r\n      state.items = action.payload.items || [];\r\n      state.totalQuantity = action.payload.totalQuantity || 0;\r\n      state.totalPrice = action.payload.totalPrice || 0;\r\n      state.isLoaded = true;\r\n    },\r\n\r\n    addToCart: (state, action) => {\r\n      const newItem = action.payload;\r\n      const itemId = newItem._id || newItem.id;\r\n\r\n      if (!itemId) {\r\n        console.error(\"Cart Error: Item has no ID\", newItem);\r\n        return; \r\n      }\r\n\r\n      const existingItem = state.items.find((item) => item._id === itemId);\r\n\r\n      if (!existingItem) {\r\n        state.items.push({\r\n          _id: itemId,\r\n          name: newItem.name,\r\n          price: newItem.price,\r\n          image: newItem.image,\r\n          slug: newItem.slug,\r\n          series: newItem.series,\r\n          year: newItem.year,\r\n          quantity: newItem.quantity || 1,\r\n        });\r\n      } else {\r\n        existingItem.quantity += (newItem.quantity || 1);\r\n      }\r\n      \r\n      // Recalculate totals from scratch to avoid drift\r\n      state.totalQuantity = state.items.reduce((sum, item) => sum + item.quantity, 0);\r\n      state.totalPrice = state.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);\r\n      state.isLoaded = true;\r\n    },\r\n\r\n    decrementItem: (state, action) => {\r\n      const id = action.payload;\r\n      const existingItem = state.items.find(item => item._id === id);\r\n\r\n      if (existingItem) {\r\n        if (existingItem.quantity === 1) {\r\n           state.items = state.items.filter(item => item._id !== id);\r\n        } else {\r\n           existingItem.quantity--;\r\n        }\r\n        \r\n        state.totalQuantity = state.items.reduce((sum, item) => sum + item.quantity, 0);\r\n        state.totalPrice = state.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);\r\n        state.isLoaded = true;\r\n      }\r\n    },\r\n\r\n    removeFromCart: (state, action) => {\r\n      const id = action.payload;\r\n      state.items = state.items.filter(item => item._id !== id);\r\n      \r\n      state.totalQuantity = state.items.reduce((sum, item) => sum + item.quantity, 0);\r\n      state.totalPrice = state.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);\r\n      state.isLoaded = true;\r\n    },\r\n    \r\n    clearCart: (state) => {\r\n      state.items = [];\r\n      state.totalQuantity = 0;\r\n      state.totalPrice = 0;\r\n    }\r\n  },\r\n});\r\n\r\nexport const { addToCart, removeFromCart, clearCart, setCart, decrementItem } = cartSlice.actions;\r\nexport default cartSlice.reducer;",
  "src\\features\\cart\\components\\Cart.js": "\"use client\";\r\n\r\nimport React from 'react';\r\nimport Link from 'next/link';\r\nimport { useAppSelector, useAppDispatch } from '@/lib/hooks';\r\nimport { addToCart, removeFromCart, decrementItem } from '../cartSlice';\r\n\r\nexport default function Cart() {\r\n    // Removed unused local state for dummy address\r\n    const { items, totalPrice, totalQuantity } = useAppSelector((state) => state.cart);\r\n    const dispatch = useAppDispatch();\r\n\r\n    // Calculate Tax (2%) and Final Total based on Redux state\r\n    const taxAmount = totalPrice * 0.02;\r\n    const finalTotal = totalPrice + taxAmount;\r\n\r\n    // Empty State\r\n    if (items.length === 0) {\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center py-20 px-4\">\r\n                <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">Your cart is empty</h2>\r\n                <p className=\"text-gray-500 mb-8\">Looks like you haven't added any Hot Wheels yet.</p>\r\n                <Link href=\"/\">\r\n                    <button className=\"bg-indigo-600 text-white px-8 py-3 rounded-full hover:bg-indigo-700 transition font-medium\">\r\n                        Start Shopping\r\n                    </button>\r\n                </Link>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"flex flex-col md:flex-row py-16 max-w-7xl w-full px-6 mx-auto gap-8\">\r\n            <div className='flex-1 max-w-4xl'>\r\n                <h1 className=\"text-3xl font-medium mb-6\">\r\n                    Shopping Cart <span className=\"text-sm text-indigo-500\">{totalQuantity} Items</span>\r\n                </h1>\r\n\r\n                {/* Table Headers */}\r\n                <div className=\"grid grid-cols-[2fr_1fr_1fr] text-gray-500 text-base font-medium pb-3 border-b border-gray-200\">\r\n                    <p className=\"text-left\">Product Details</p>\r\n                    <p className=\"text-center\">Subtotal</p>\r\n                    <p className=\"text-center\">Action</p>\r\n                </div>\r\n\r\n                {/* Cart Items */}\r\n                <div className=\"flex flex-col gap-4 mt-3\">\r\n                    {items.map((item) => (\r\n                        <div key={item._id} className=\"grid grid-cols-[2fr_1fr_1fr] text-gray-500 items-center text-sm md:text-base font-medium pt-3 pb-3 border-b border-gray-100 last:border-0\">\r\n                            \r\n                            {/* Product Detail Column */}\r\n                            <div className=\"flex items-center md:gap-6 gap-3\">\r\n                                <div className=\"cursor-pointer w-20 h-20 md:w-24 md:h-24 flex items-center justify-center border border-gray-300 rounded overflow-hidden shrink-0\">\r\n                                    <img className=\"w-full h-full object-cover mix-blend-multiply\" src={item.image} alt={item.name} />\r\n                                </div>\r\n                                <div>\r\n                                    <Link href={`/products/${item.slug || '#'}`} className=\"hidden md:block font-semibold text-gray-900 hover:text-indigo-600 transition\">\r\n                                        {item.name}\r\n                                    </Link>\r\n                                    <div className=\"font-normal text-gray-500/70 mt-1\">\r\n                                        {/* Optional: Add Size here if you add it to schema later */}\r\n                                        <p className=\"text-xs mb-1\">Unit: ${item.price}</p>\r\n                                        <div className='flex items-center gap-2'>\r\n                                            <p>Qty:</p>\r\n                                            <div className='flex items-center border border-gray-300 rounded overflow-hidden bg-white'>\r\n                                                <button \r\n                                                    onClick={() => dispatch(decrementItem(item._id))}\r\n                                                    className='px-2 py-0.5 hover:bg-gray-100 transition text-gray-700'\r\n                                                >\r\n                                                    -\r\n                                                </button>\r\n                                                <span className='px-2 text-sm text-gray-900 min-w-[20px] text-center'>{item.quantity}</span>\r\n                                                <button \r\n                                                    onClick={() => dispatch(addToCart({ ...item, quantity: 1 }))}\r\n                                                    className='px-2 py-0.5 hover:bg-gray-100 transition text-gray-700'\r\n                                                >\r\n                                                    +\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Subtotal Column */}\r\n                            <p className=\"text-center font-semibold text-gray-900\">${item.price * item.quantity}</p>\r\n\r\n                            {/* Action Column */}\r\n                            <button \r\n                                onClick={() => dispatch(removeFromCart(item._id))}\r\n                                className=\"cursor-pointer mx-auto p-2 hover:bg-red-50 rounded-full transition group\"\r\n                                aria-label=\"Remove item\"\r\n                            >\r\n                                <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                    <path className=\"group-hover:stroke-red-600 transition\" d=\"m12.5 7.5-5 5m0-5 5 5m5.833-2.5a8.333 8.333 0 1 1-16.667 0 8.333 8.333 0 0 1 16.667 0\" stroke=\"#FF532E\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\r\n                                </svg>\r\n                            </button>\r\n\n// ‚úÇÔ∏è Truncated for AI (original 8491 characters)",
  "src\\features\\cart\\components\\CartSync.js": "\"use client\";\r\n\r\nimport { useEffect, useRef } from \"react\";\r\nimport { useSession } from \"next-auth/react\";\r\nimport { useAppDispatch, useAppSelector } from \"@/lib/hooks\";\r\nimport { fetchCart, saveCartToDB } from \"../actions\";\r\nimport { setCart } from \"../cartSlice\";\r\n\r\nexport default function CartSync() {\r\n  const { data: session } = useSession();\r\n  const dispatch = useAppDispatch();\r\n  const cart = useAppSelector((state) => state.cart);\r\n  \r\n  // Ref to track if this is the first mount to avoid overwriting DB with empty Redux\r\n  const isInitialMount = useRef(true);\r\n\r\n  // 1. LOAD: When user logs in, fetch their cart from DB\r\n  useEffect(() => {\r\n    if (session?.user?.id) {\r\n      const loadCart = async () => {\r\n        const dbCart = await fetchCart(session.user.id);\r\n        if (dbCart) {\r\n          dispatch(setCart(dbCart));\r\n        }\r\n      };\r\n      loadCart();\r\n    }\r\n  }, [session?.user?.id, dispatch]);\r\n\r\n  // 2. SAVE: When Redux cart changes, save to DB (Debounced slightly)\r\n  useEffect(() => {\r\n    // Don't save if it's the first mount (avoids wiping DB with empty init state)\r\n    if (isInitialMount.current) {\r\n      isInitialMount.current = false;\r\n      return;\r\n    }\r\n\r\n    // Only save if user is logged in\r\n    if (session?.user?.id && cart.isLoaded) {\r\n      const timer = setTimeout(() => {\r\n        saveCartToDB(session.user.id, {\r\n          items: cart.items,\r\n          totalQuantity: cart.totalQuantity,\r\n          totalPrice: cart.totalPrice\r\n        });\r\n      }, 1000); // 1-second debounce to reduce DB writes\r\n\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [cart, session?.user?.id]);\r\n\r\n  return null; // This component renders nothing\r\n}",
  "src\\features\\cart\\models\\Cart.js": "import mongoose from 'mongoose';\r\n\r\nconst CartSchema = new mongoose.Schema({\r\n  userId: {\r\n    type: mongoose.Schema.Types.ObjectId,\r\n    ref: 'User',\r\n    required: true,\r\n    unique: true // One cart per user\r\n  },\r\n  items: [\r\n    {\r\n      _id: { type: String, required: true }, // Product ID\r\n      name: { type: String, required: true },\r\n      price: { type: Number, required: true },\r\n      image: { type: String },\r\n      quantity: { type: Number, required: true, default: 1 }\r\n    }\r\n  ],\r\n  totalQuantity: { type: Number, default: 0 },\r\n  totalPrice: { type: Number, default: 0 }\r\n}, { timestamps: true });\r\n\r\nexport default mongoose.models.Cart || mongoose.model('Cart', CartSchema);",
  "src\\features\\checkout\\actions.js": "\"use server\";\r\n\r\nimport dbConnect from '@/lib/db';\r\nimport Order from '@/features/order/models/Order';\r\nimport { getStoreSettings } from '@/features/admin/settings/actions';\r\nimport { initiatePayment } from '@/lib/payment-adapters';\r\n\r\nexport const processPayment = async (orderId) => {\r\n  await dbConnect();\r\n\r\n  try {\r\n    // 1. Fetch Order\r\n    const order = await Order.findById(orderId);\r\n    if (!order) return { error: \"Order not found\" };\r\n\r\n    // 2. Fetch Store Settings (contains keys)\r\n    const settings = await getStoreSettings();\r\n\r\n    // 3. Validate Amount\r\n    if (order.totalAmount <= 0) return { error: \"Invalid order amount\" };\r\n\r\n    // 4. Handle Manual Gateways (COD, WhatsApp)\r\n    // These don't need a payment provider session\r\n    if (order.paymentMethod === 'cod' || order.paymentMethod === 'whatsapp') {\r\n        return { success: true, type: 'manual', message: 'Order placed successfully' };\r\n    }\r\n\r\n    // 5. Initiate Payment via Adapter\r\n    const paymentData = await initiatePayment(order.paymentMethod, order, settings);\r\n\r\n    return { success: true, ...paymentData };\r\n\r\n  } catch (error) {\r\n    console.error(\"Payment Processing Error:\", error);\r\n    return { error: error.message || \"Payment initialization failed\" };\r\n  }\r\n};",
  "src\\features\\checkout\\components\\Checkout.js": "\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { useAppDispatch, useAppSelector } from \"@/lib/hooks\";\r\nimport { clearCart, setCart } from \"@/features/cart/cartSlice\";\r\nimport { createOrder } from \"@/features/order/actions\";\r\nimport { processPayment } from \"@/features/checkout/actions\";\r\nimport { validateCart } from \"@/features/cart/actions\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { MapPin, CheckCircle, Plus, Loader2, ShieldCheck, AlertCircle, Pencil, Trash2, MessageCircle } from \"lucide-react\";\r\nimport Link from \"next/link\";\r\nimport { useToast } from \"@/context/ToastContext\";\r\nimport CheckoutAddressModal from \"./CheckoutAddressModal\";\r\nimport StripePaymentModal from \"./StripePaymentModal\"; // Import New Modal\r\n\r\n// Stripe Imports\r\nimport { loadStripe } from \"@stripe/stripe-js\";\r\n\r\nconst loadRazorpayScript = () => {\r\n    return new Promise((resolve) => {\r\n        if (window.Razorpay) {\r\n            resolve(true);\r\n            return;\r\n        }\r\n        const script = document.createElement(\"script\");\r\n        script.src = \"https://checkout.razorpay.com/v1/checkout.js\";\r\n        script.onload = () => resolve(true);\r\n        script.onerror = () => resolve(false);\r\n        document.body.appendChild(script);\r\n    });\r\n};\r\n\r\nexport default function Checkout({ userId, savedAddresses = [], availableGateways = [] }) {\r\n  const router = useRouter();\r\n  const dispatch = useAppDispatch();\r\n  const { addToast } = useToast();\r\n  \r\n  // 1. DEFENSIVE SELECTOR\r\n  const cartState = useAppSelector((state) => state.cart || {});\r\n  const items = Array.isArray(cartState?.items) ? cartState.items : [];\r\n  const totalPrice = cartState?.totalPrice || 0;\r\n\r\n  // FIX: Ensure safeAddresses is always an array\r\n  const safeAddresses = Array.isArray(savedAddresses) ? savedAddresses : [];\r\n\r\n  const [selectedAddressIndex, setSelectedAddressIndex] = useState(0);\r\n  const [paymentMethod, setPaymentMethod] = useState(availableGateways[0]?.id || \"\");\r\n  \r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [isVerifying, setIsVerifying] = useState(true);\r\n  const [isMounted, setIsMounted] = useState(false);\r\n  const [isAddressModalOpen, setIsAddressModalOpen] = useState(false);\r\n  const [addressToEdit, setAddressToEdit] = useState(null);\r\n\r\n  // Stripe State\r\n  const [stripePromise, setStripePromise] = useState(null);\r\n  const [clientSecret, setClientSecret] = useState(\"\");\r\n  const [isStripeModalOpen, setIsStripeModalOpen] = useState(false);\r\n\r\n  useEffect(() => {\r\n    setIsMounted(true);\r\n  }, []);\r\n\r\n  // 2. SERVER-SIDE VALIDATION\r\n  useEffect(() => {\r\n    if (!isMounted) return;\r\n\r\n    const verifyStock = async () => {\r\n        if (items.length === 0) { \r\n            setIsVerifying(false);\r\n            return;\r\n        }\r\n        \r\n        try {\r\n            const result = await validateCart(items);\r\n            if (result?.warnings?.length > 0) {\r\n                result.warnings.forEach(w => addToast(w, \"error\"));\r\n                if (result.cart) dispatch(setCart(result.cart)); \r\n                if (result.cart?.items?.length !== items.length) { router.push('/cart'); }\r\n            }\r\n        } catch (error) { console.error(\"Validation error:\", error); } \r\n        finally { setIsVerifying(false); }\r\n    };\r\n    verifyStock();\r\n  }, [isMounted]);\r\n\r\n  // 3. LOADING STATE\r\n  if (!isMounted || (isVerifying && items.length > 0)) {\r\n    return <div className=\"flex flex-col items-center justify-center min-h-[60vh]\"><Loader2 className=\"h-10 w-10 text-indigo-600 animate-spin mb-4\" /><p className=\"text-gray-500 font-medium\">Loading checkout...</p></div>;\r\n  }\r\n\r\n  // 4. EMPTY STATE\r\n  if (items.length === 0) {\r\n     return <div className=\"flex flex-col items-center justify-center min-h-[60vh] text-center px-4\"><div className=\"bg-gray-100 p-4 rounded-full mb-4\"><AlertCircle className=\"h-8 w-8 text-gray-400\" /></div><h2 className=\"text-2xl font-bold mb-2 text-gray-900\">Your cart is empty</h2><Link href=\"/\"><button className=\"bg-indigo-600 text-white px-6 py-2.5 rounded-full font-medium\">Return to Shop</button></Link></div>\r\n  }\r\n\r\n  const handlePlaceOrder = async () => {\r\n    if (safeAddresses.length === 0) return addToast(\"Add shipping address\", \"warning\");\r\n    if (!paymentMethod) return addToast(\"Select payment method\", \"warning\");\r\n\r\n    setIsProcessing(true);\r\n\r\n    const addressToUse = safeAddresses[selectedAddressIndex];\r\n    \r\n    // 1. Create Order\r\n    const orderRes = await createOrder(userId, {\r\n        shippingAddress: {\r\n            street: addressToUse.street,\r\n            city: addressToUse.city,\r\n            state: addressToUse.state,\r\n            zip: addressToUse.zip,\r\n            country: addressToUse.country,\r\n            phone: addressToUse.phone \r\n        },\r\n        paymentMethod\r\n    });\r\n\r\n    if (!orderRes.success) {\r\n        addToast(orderRes.error, \"error\");\r\n        setIsProcessing(false);\r\n        return;\r\n    }\r\n\r\n    // 2. Process Payment (Get Tokens)\r\n    const paymentRes = await processPayment(orderRes.orderId);\r\n\r\n    if (!paymentRes.success) {\r\n        addToast(paymentRes.error, \"error\");\r\n        setIsProcessing(false);\r\n        return;\r\n    }\r\n\r\n    dispatch(clearCart()); // Optimistic Clear\r\n\r\n    // 3. Handle Gateway Logic\r\n    if (paymentRes.type === 'stripe') {\r\n        // Init Stripe Modal\r\n        setStripePromise(loadStripe(paymentRes.publishableKey));\r\n        setClientSecret(paymentRes.clientSecret);\r\n        setIsStripeModalOpen(true);\r\n        // Note: We keep isProcessing=true while modal is open, reset in onClose if cancelled\r\n    } \r\n    else if (paymentRes.type === 'razorpay') {\r\n        // Init Razorpay Popup\r\n        const loaded = await loadRazorpayScript();\r\n        if (!loaded) {\r\n            addToast(\"Razorpay SDK failed to load\", \"error\");\r\n            setIsProcessing(false);\r\n            return;\r\n        }\r\n\r\n        const options = {\r\n            key: paymentRes.keyId,\r\n            amount: paymentRes.amount,\r\n   \n\n// ‚úÇÔ∏è Truncated for AI (original 13045 characters)",
  "src\\features\\checkout\\components\\CheckoutAddressModal.js": "\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { X, Loader2, MapPin } from \"lucide-react\";\r\nimport { addAddress, updateAddress } from \"@/features/user/actions\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { useToast } from \"@/context/ToastContext\";\r\n\r\nexport default function CheckoutAddressModal({ isOpen, onClose, userId, addressToEdit = null }) {\r\n  const router = useRouter();\r\n  const { addToast } = useToast();\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  \r\n  const [formData, setFormData] = useState({\r\n    street: \"\",\r\n    city: \"\",\r\n    state: \"\",\r\n    zip: \"\",\r\n    country: \"USA\",\r\n    phone: \"\"\r\n  });\r\n\r\n  // Populate form when addressToEdit changes\r\n  useEffect(() => {\r\n    if (addressToEdit) {\r\n      setFormData({\r\n        street: addressToEdit.street || \"\",\r\n        city: addressToEdit.city || \"\",\r\n        state: addressToEdit.state || \"\",\r\n        zip: addressToEdit.zip || \"\",\r\n        country: addressToEdit.country || \"USA\",\r\n        phone: addressToEdit.phone || \"\"\r\n      });\r\n    } else {\r\n      setFormData({ street: \"\", city: \"\", state: \"\", zip: \"\", country: \"USA\", phone: \"\" });\r\n    }\r\n  }, [addressToEdit, isOpen]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const handleChange = (e) => {\r\n    setFormData({ ...formData, [e.target.name]: e.target.value });\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setIsSubmitting(true);\r\n\r\n    try {\r\n      let result;\r\n      if (addressToEdit) {\r\n        result = await updateAddress(userId, addressToEdit._id, formData);\r\n      } else {\r\n        result = await addAddress(userId, formData);\r\n      }\r\n\r\n      if (result.success) {\r\n        addToast(addressToEdit ? \"Address updated\" : \"Address added\", \"success\");\r\n        router.refresh(); \r\n        onClose();\r\n      } else {\r\n        addToast(result.error || \"Failed to save address\", \"error\");\r\n      }\r\n    } catch (error) {\r\n      addToast(\"Something went wrong\", \"error\");\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in duration-200\">\r\n      <div className=\"bg-white rounded-xl shadow-xl w-full max-w-lg overflow-hidden animate-in zoom-in-95 duration-200\">\r\n        \r\n        {/* Header */}\r\n        <div className=\"px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50/50\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2\">\r\n            <MapPin size={18} className=\"text-indigo-600\"/> \r\n            {addressToEdit ? \"Edit Address\" : \"Add Delivery Address\"}\r\n          </h3>\r\n          <button \r\n            onClick={onClose}\r\n            className=\"text-gray-400 hover:text-gray-600 transition p-1 rounded-full hover:bg-gray-100\"\r\n          >\r\n            <X size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Form */}\r\n        <form onSubmit={handleSubmit} className=\"p-6 space-y-4\">\r\n          <div className=\"space-y-1\">\r\n            <label className=\"text-xs font-medium text-gray-500 uppercase\">Street Address</label>\r\n            <input \r\n              name=\"street\"\r\n              value={formData.street}\r\n              onChange={handleChange}\r\n              placeholder=\"123 Main St, Apt 4B\"\r\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition text-sm\"\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-xs font-medium text-gray-500 uppercase\">City</label>\r\n              <input \r\n                name=\"city\"\r\n                value={formData.city}\r\n                onChange={handleChange}\r\n                placeholder=\"New York\"\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition text-sm\"\r\n                required\r\n              />\r\n            </div>\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-xs font-medium text-gray-500 uppercase\">State</label>\r\n              <input \r\n                name=\"state\"\r\n                value={formData.state}\r\n                onChange={handleChange}\r\n                placeholder=\"NY\"\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition text-sm\"\r\n                required\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-xs font-medium text-gray-500 uppercase\">ZIP Code</label>\r\n              <input \r\n                name=\"zip\"\r\n                value={formData.zip}\r\n                onChange={handleChange}\r\n                placeholder=\"10001\"\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition text-sm\"\r\n                required\r\n              />\r\n            </div>\r\n            <div className=\"space-y-1\">\r\n              <label className=\"text-xs font-medium text-gray-500 uppercase\">Country</label>\r\n              <input \r\n                name=\"country\"\r\n                value={formData.country}\r\n                onChange={handleChange}\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition text-sm\"\r\n                required\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"space-y-1\">\r\n            <label className=\"text-xs font-medium text-gray-500 uppercase\">Phone Number</label>\r\n            <input \r\n              name=\"phone\"\r\n              type=\"tel\"\r\n              value={f\n\n// ‚úÇÔ∏è Truncated for AI (original 7165 characters)",
  "src\\features\\checkout\\components\\StripePaymentModal.js": "\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Elements, PaymentElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\r\nimport { X, Loader2, Lock } from \"lucide-react\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\nexport default function StripePaymentModal({ clientSecret, stripePromise, onClose }) {\r\n  if (!clientSecret || !stripePromise) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-200\">\r\n      <div className=\"bg-white p-6 rounded-xl w-full max-w-md shadow-2xl relative overflow-hidden\">\r\n        {/* Header */}\r\n        <div className=\"flex justify-between items-center mb-6\">\r\n            <h3 className=\"font-bold text-lg text-gray-900 flex items-center gap-2\">\r\n                <Lock size={18} className=\"text-indigo-600\" /> Secure Payment\r\n            </h3>\r\n            <button \r\n                onClick={onClose}\r\n                className=\"text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100 transition\"\r\n            >\r\n                <X size={20}/>\r\n            </button>\r\n        </div>\r\n        \r\n        {/* Stripe Elements Provider */}\r\n        <Elements stripe={stripePromise} options={{ clientSecret }}>\r\n            <StripePaymentForm />\r\n        </Elements>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction StripePaymentForm() {\r\n    const stripe = useStripe();\r\n    const elements = useElements();\r\n    const [msg, setMsg] = useState(\"\");\r\n    const [isPaying, setIsPaying] = useState(false);\r\n    const router = useRouter();\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        if (!stripe || !elements) return;\r\n\r\n        setIsPaying(true);\r\n        setMsg(\"\");\r\n\r\n        const { error } = await stripe.confirmPayment({\r\n            elements,\r\n            confirmParams: {\r\n                return_url: `${window.location.origin}/profile?success=true`,\r\n            },\r\n        });\r\n\r\n        // This point is reached only if there is an error or if payment requires further actions\r\n        if (error) {\r\n            setMsg(error.message);\r\n            setIsPaying(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n            <PaymentElement />\r\n            \r\n            {msg && (\r\n                <div className=\"bg-red-50 text-red-600 text-sm p-3 rounded-md border border-red-100\">\r\n                    {msg}\r\n                </div>\r\n            )}\r\n            \r\n            <button \r\n                disabled={!stripe || isPaying} \r\n                className=\"w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 disabled:opacity-50 transition flex items-center justify-center gap-2\"\r\n            >\r\n                {isPaying ? (\r\n                    <>\r\n                        <Loader2 className=\"animate-spin\" size={18} /> Processing...\r\n                    </>\r\n                ) : (\r\n                    \"Pay Now\"\r\n                )}\r\n            </button>\r\n            \r\n            <p className=\"text-center text-xs text-gray-400 mt-4\">\r\n                Payments are securely processed by Stripe.\r\n            </p>\r\n        </form>\r\n    );\r\n}",
  "src\\features\\hooks\\useAppHooks.js": "// src/features/hooks/useAppHooks.js\r\nimport { useDispatch, useSelector } from 'react-redux';\r\n\r\nexport const useAppDispatch = () => useDispatch();\r\nexport const useAppSelector = useSelector;",
  "src\\features\\order\\actions.js": "\"use server\";\r\n\r\nimport dbConnect, { withTransaction } from '@/lib/db';\r\nimport Order from './models/Order';\r\nimport Cart from '@/features/cart/models/Cart';\r\nimport Product from '@/features/product/models/Product';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport const createOrder = async (userId, orderData) => {\r\n  // Use our robust transaction helper (retries on standalone DB)\r\n  return await withTransaction(async (session) => {\r\n      // 1. Validation\r\n      const addr = orderData.shippingAddress;\r\n      if (!addr || !addr.street || !addr.city || !addr.zip || !addr.state || !addr.country) {\r\n          throw new Error(\"Please provide a complete shipping address.\");\r\n      }\r\n\r\n      // 2. Fetch User Cart\r\n      const cart = await Cart.findOne({ userId }).session(session);\r\n\r\n      if (!cart || cart.items.length === 0) {\r\n        throw new Error(\"Cart is empty\");\r\n      }\r\n\r\n      const orderItems = [];\r\n      \r\n      // 3. Check Stock & Decrement Inventory\r\n      for (const item of cart.items) {\r\n          const product = await Product.findById(item._id).session(session);\r\n          \r\n          if (!product) {\r\n              throw new Error(`Product \"${item.name}\" no longer exists.`);\r\n          }\r\n          \r\n          if (!product.inStock) {\r\n               throw new Error(`\"${product.name}\" is out of stock.`);\r\n          }\r\n          \r\n          // Decrement logic (assuming boolean inStock for now, but ready for numeric)\r\n          // If you add numeric stock: product.stock -= item.quantity;\r\n          \r\n          await product.save({ session });\r\n          \r\n          orderItems.push({\r\n            productId: item._id, \r\n            name: item.name,\r\n            price: item.price,\r\n            image: item.image,\r\n            quantity: item.quantity\r\n          });\r\n      }\r\n\r\n      // 4. Create Order\r\n      const newOrder = new Order({\r\n        userId,\r\n        items: orderItems, \r\n        totalAmount: cart.totalPrice, \r\n        shippingAddress: orderData.shippingAddress,\r\n        paymentMethod: orderData.paymentMethod,\r\n        status: 'Pending',\r\n        paymentStatus: 'Pending'\r\n      });\r\n      \r\n      await newOrder.save({ session });\r\n\r\n      // 5. Clear Cart\r\n      cart.items = [];\r\n      cart.totalQuantity = 0;\r\n      cart.totalPrice = 0;\r\n      await cart.save({ session });\r\n\r\n      revalidatePath('/profile');\r\n      revalidatePath('/cart');\r\n\r\n      return { success: true, orderId: newOrder._id.toString() };\r\n  }).catch(error => {\r\n      console.error(\"Create Order Error:\", error);\r\n      return { error: error.message || \"Failed to place order.\" };\r\n  });\r\n};",
  "src\\features\\order\\models\\Order.js": "import mongoose from 'mongoose';\r\n\r\nconst OrderSchema = new mongoose.Schema({\r\n  userId: {\r\n    type: mongoose.Schema.Types.ObjectId,\r\n    ref: 'User',\r\n    required: true,\r\n  },\r\n  items: [\r\n    {\r\n      productId: { type: String, required: true },\r\n      name: { type: String, required: true },\r\n      price: { type: Number, required: true },\r\n      image: { type: String },\r\n      quantity: { type: Number, required: true },\r\n      sku: { type: String } \r\n    }\r\n  ],\r\n  shippingAddress: {\r\n     street: String,\r\n     city: String,\r\n     state: String,\r\n     zip: String,\r\n     country: String,\r\n     phone: String \r\n  },\r\n  totalAmount: { type: Number, required: true },\r\n  status: { \r\n    type: String, \r\n    enum: ['Pending', 'Processing', 'Shipped', 'Delivered', 'Cancelled'],\r\n    default: 'Pending' \r\n  },\r\n  // Updated payment method enum\r\n  paymentMethod: { type: String, default: 'COD' }, // 'COD', 'WhatsApp'\r\n  paymentStatus: { type: String, enum: ['Pending', 'Paid', 'Failed'], default: 'Pending' },\r\n  \r\n  // New field for manual payment verification\r\n  upiReference: { type: String }, \r\n\r\n}, { timestamps: true });\r\n\r\nexport default mongoose.models.Order || mongoose.model('Order', OrderSchema);",
  "src\\features\\product\\actions.js": "'use server'\r\n\r\nimport dbConnect from '@/lib/db';\r\nimport Product from '@/features/product/models/Product';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\n// Fetch products with Search, Filter & Pagination\r\nexport async function getProducts({ query = '', category = '', page = 1, limit = 10 } = {}) {\r\n  await dbConnect();\r\n\r\n  try {\r\n    const skip = (page - 1) * limit;\r\n\r\n    // Build Query Object\r\n    const filter = {};\r\n    \r\n    // Search by Name or Description (Case Insensitive)\r\n    if (query) {\r\n      filter.$or = [\r\n        { name: { $regex: query, $options: 'i' } },\r\n        { description: { $regex: query, $options: 'i' } }\r\n      ];\r\n    }\r\n\r\n    // Filter by Category\r\n    if (category && category !== 'All') {\r\n      filter.category = category;\r\n    }\r\n\r\n    // Parallel Fetch: Data + Count\r\n    const [products, totalItems] = await Promise.all([\r\n      Product.find(filter)\r\n        .sort({ createdAt: -1 })\r\n        .skip(skip)\r\n        .limit(limit)\r\n        .lean(),\r\n      Product.countDocuments(filter)\r\n    ]);\r\n\r\n    const totalPages = Math.ceil(totalItems / limit);\r\n  \r\n    const serializedProducts = products.map(product => ({\r\n      ...product,\r\n      _id: product._id.toString(),\r\n      createdAt: product.createdAt?.toISOString() || new Date().toISOString(),\r\n      updatedAt: product.updatedAt?.toISOString() || new Date().toISOString(),\r\n    }));\r\n\r\n    return {\r\n      products: serializedProducts,\r\n      pagination: {\r\n        currentPage: page,\r\n        totalPages,\r\n        totalItems,\r\n        limit\r\n      }\r\n    };\r\n\r\n  } catch (error) {\r\n    console.error(\"Fetch Products Error:\", error);\r\n    // Return empty structure on error to prevent page crash\r\n    return { products: [], pagination: { currentPage: 1, totalPages: 1, totalItems: 0 } };\r\n  }\r\n}\r\n\r\n// Fetch products by Category (Public View)\r\nexport async function getProductsByCategory(category) {\r\n  await dbConnect();\r\n  const decodedCategory = decodeURIComponent(category);\r\n  const products = await Product.find({ category: decodedCategory }).sort({ createdAt: -1 }).lean();\r\n  \r\n  return products.map(product => ({\r\n    ...product,\r\n    _id: product._id.toString(),\r\n    createdAt: product.createdAt?.toISOString() || new Date().toISOString(),\r\n    updatedAt: product.updatedAt?.toISOString() || new Date().toISOString(),\r\n  }));\r\n}\r\n\r\n// Fetch single product by Slug\r\nexport const getProductBySlug = async (slug) => {\r\n  try {\r\n    await dbConnect();\r\n    const decodedSlug = decodeURIComponent(slug);\r\n    const product = await Product.findOne({ \r\n      $or: [{ slug: decodedSlug }, { name: decodedSlug }] \r\n    }).lean();\r\n    \r\n    if (!product) return null;\r\n\r\n    return {\r\n      ...product,\r\n      _id: product._id.toString(),\r\n      createdAt: product.createdAt?.toISOString() || new Date().toISOString(),\r\n      updatedAt: product.updatedAt?.toISOString() || new Date().toISOString(),\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Error fetching product by slug:\", error);\r\n    return null;\r\n  }\r\n};\r\n\r\nexport async function toggleStock(id, currentStatus) {\r\n  await dbConnect();\r\n  await Product.findByIdAndUpdate(id, { inStock: !currentStatus });\r\n  revalidatePath('/'); \r\n  revalidatePath('/admin');\r\n}",
  "src\\features\\product\\components\\AllProducts.js": "\"use client\";\r\n\r\nimport React, { useEffect } from \"react\";\r\nimport ProductCard from \"./ProductCard\";\r\nimport { useProductData } from \"../hooks/useProductData\";\r\n\r\nfunction AllProducts() {\r\n  const { products, status, error, fetchProductsIfIdle } = useProductData();\r\n\r\n  useEffect(() => {\r\n    fetchProductsIfIdle()\r\n  }, [fetchProductsIfIdle]);\r\n\r\n  if (status === 'loading' || status === 'idle') {\r\n    return <div className=\"text-center py-10\">Loading products...</div>;\r\n  }\r\n  \r\n  if (status === 'failed') {\r\n    return <div className=\"text-center py-10 text-red-600\">Error: {error}</div>;\r\n  }\r\n\r\n  return (\r\n    <div className='grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 max-w-7xl mx-auto -z-10'>\r\n      {products.map((product) => (\r\n        <ProductCard key={product._id} product={product} />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default AllProducts;",
  "src\\features\\product\\components\\ProductCard.js": "\"use client\";\r\nimport { motion } from \"framer-motion\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { useAppDispatch } from \"@/lib/hooks\";\r\nimport { addToCart } from \"@/features/cart/cartSlice\";\r\nimport Link from \"next/link\";\r\n\r\nexport default function ProductCard({ product }) {\r\n  const dispatch = useAppDispatch();\r\n  const displayImage = product.images?.[0] || \"/hotwheel.svg\";\r\n\r\n  const handleAddToCart = (e) => {\r\n    e.preventDefault(); \r\n    e.stopPropagation();\r\n    \r\n    dispatch(\r\n      addToCart({\r\n        id: product._id,\r\n        name: product.name,\r\n        price: product.price,\r\n        image: displayImage,\r\n        quantity: 1,\r\n      })\r\n    );\r\n  };\r\n\r\n  // Construct dynamic URL: /products/Category/Slug\r\n  // Ensure category is safe for URL (optional safety check)\r\n  const categoryPath = product.category ? encodeURIComponent(product.category) : 'Uncategorized';\r\n  const productUrl = `/products/${categoryPath}/${product.slug}`;\r\n\r\n  return (\r\n    <motion.div\r\n      whileHover={{ y: -2 }}\r\n      className='group relative border border-neutral-200 bg-white shadow-sm transition-shadow hover:shadow-md rounded-lg overflow-hidden'\r\n    >\r\n      <Link href={productUrl} className=\"h-full flex flex-col\">\r\n        <div className='aspect-square relative overflow-hidden bg-neutral-100'>\r\n          <img\r\n            src={displayImage}\r\n            alt={product.name}\r\n            className='h-full w-full object-cover transition-transform duration-500 group-hover:scale-105 mix-blend-multiply'\r\n          />\r\n          {!product.inStock && (\r\n            <div className='absolute inset-0 bg-black/50 flex items-center justify-center'>\r\n              <span className='text-white font-bold tracking-widest uppercase text-xs md:text-sm border-2 border-white px-3 py-1'>\r\n                Sold Out\r\n              </span>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className='p-3 md:p-4 flex flex-col flex-grow'>\r\n            <div className=\"mb-2\">\r\n                <p className='text-xs text-neutral-500 uppercase tracking-wide truncate'>\r\n                {product.category} ‚Ä¢ {product.year}\r\n                </p>\r\n                <h3 className='font-medium text-neutral-900 text-sm md:text-base line-clamp-2'>\r\n                {product.name}\r\n                </h3>\r\n                <p className='text-xs text-neutral-500 truncate'>\r\n                {product.description} \r\n                </p>\r\n            </div>\r\n\r\n            <div className='mt-auto'>\r\n                <p className='font-mono text-sm md:text-lg font-semibold text-gray-900'>${product.price}</p>\r\n            </div>\r\n        </div>\r\n      </Link>\r\n    </motion.div>\r\n  );\r\n}",
  "src\\features\\product\\components\\ProductDetail.js": "\"use client\";\r\nimport { useState } from \"react\";\r\nimport { useAppDispatch } from \"@/lib/hooks\";\r\nimport { addToCart } from \"@/features/cart/cartSlice\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\nfunction ProductDetail({ product }) {\r\n  const dispatch = useAppDispatch();\r\n  const router = useRouter();\r\n\r\n  const initialImage = product?.images?.[0] || \"/hotwheel.svg\";\r\n  const [thumbnail, setThumbnail] = useState(initialImage);\r\n\r\n  if (!product) {\r\n    return (\r\n      <div className='text-center py-20 text-gray-500'>\r\n        Loading product details...\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const handleAddToCart = () => {\r\n    dispatch(\r\n      addToCart({\r\n        id: product._id,\r\n        name: product.name,\r\n        price: product.price,\r\n        image: initialImage,\r\n        quantity: 1,\r\n      })\r\n    );\r\n  };\r\n\r\n  const handleBuyNow = () => {\r\n    // 1. Add item to cart\r\n    dispatch(\r\n      addToCart({\r\n        id: product._id,\r\n        name: product.name,\r\n        price: product.price,\r\n        image: initialImage,\r\n        quantity: 1,\r\n      })\r\n    );\r\n    // 2. Redirect to checkout immediately\r\n    router.push('/checkout');\r\n  };\r\n\r\n  const descriptionPoints = product.description\r\n    ? product.description.split(\"\\n\").filter((line) => line.trim() !== \"\")\r\n    : [\"No description available.\"];\r\n\r\n  // Encode category for the URL link\r\n  const categoryPath = product.category\r\n    ? encodeURIComponent(product.category)\r\n    : \"Uncategorized\";\r\n\r\n  return (\r\n    <>\r\n      <div className='flex w-full max-w-7xl px-8 pt-8 md:px-24 '>\r\n        {/* Dynamic Breadcrumbs */}\r\n        <p className='text-gray-500 text-sm flex gap-1 flex-wrap justify-self-start'>\r\n          <Link href='/' className='hover:text-indigo-500 transition'>\r\n            Home\r\n          </Link>\r\n          <span>/</span>\r\n\r\n          <Link\r\n            href={`/products/${categoryPath}`}\r\n            className='hover:text-indigo-500 transition'\r\n          >\r\n            {product.category}\r\n          </Link>\r\n          <span>/</span>\r\n          <span className='text-indigo-500 font-medium truncate max-w-[200px]'>\r\n            {product.name}\r\n          </span>\r\n        </p>\r\n      </div>\r\n      <div className=\"min-h-[60vh] flex items-center justify-center\">\r\n\r\n\r\n        <div className='max-w-6xl w-full p-8'>\r\n          <div className='flex flex-col md:flex-row gap-12 lg:gap-16'>\r\n            {/* Image Gallery Section */}\r\n            <div className='flex flex-col-reverse md:flex-row gap-4 w-full md:w-1/2'>\r\n              {/* Thumbnails */}\r\n              <div className='flex md:flex-col gap-3 overflow-x-auto md:overflow-visible no-scrollbar'>\r\n                {product.images?.map((image, index) => (\r\n                  <div\r\n                    key={index}\r\n                    onClick={() => setThumbnail(image)}\r\n                    className={`border-2 w-20 h-20 md:w-24 md:h-24 rounded-lg overflow-hidden cursor-pointer flex-shrink-0 transition-all ${thumbnail === image\r\n                        ? \"border-indigo-500\"\r\n                        : \"border-gray-200\"\r\n                      }`}\r\n                  >\r\n                    <img\r\n                      src={image}\r\n                      alt={`View ${index + 1}`}\r\n                      className='w-full h-full object-cover hover:scale-110 transition duration-300'\r\n                    />\r\n                  </div>\r\n                ))}\r\n              </div>\r\n\r\n              {/* Main Image */}\r\n              <div className='flex-1 border border-gray-200 rounded-xl overflow-hidden bg-gray-50 relative h-[400px] md:h-[500px]'>\r\n                <img\r\n                  src={thumbnail}\r\n                  alt={product.name}\r\n                  className='w-full h-full object-contain mix-blend-multiply p-4'\r\n                />\r\n                {!product.inStock && (\r\n                  <span className='absolute top-4 right-4 bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide'>\r\n                    Out of Stock\r\n                  </span>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Details Section */}\r\n            <div className='flex-1'>\r\n              <h1 className='text-2xl md:text-4xl font-bold text-gray-900'>\r\n                {product.name}\r\n              </h1>\r\n              <p className='text-gray-500 mt-2 text-sm'>\r\n                {product.series} ‚Ä¢ {product.year}\r\n              </p>\r\n\r\n              <div className='mt-6 flex items-baseline gap-4'>\r\n                <span className='text-3xl font-bold text-gray-900'>\r\n                  ${product.price}\r\n                </span>\r\n                {product.originalPrice &&\r\n                  product.originalPrice > product.price && (\r\n                    <>\r\n                      <span className='text-lg text-gray-400 line-through'>\r\n                        ${product.originalPrice}\r\n                      </span>\r\n                      <span className='text-sm font-medium text-green-600 bg-green-100 px-2 py-1 rounded'>\r\n                        {Math.round(\r\n                          ((product.originalPrice - product.price) /\r\n                            product.originalPrice) *\r\n                          100\r\n                        )}\r\n                        % OFF\r\n                      </span>\r\n                    </>\r\n                  )}\r\n              </div>\r\n              <p className='text-xs text-gray-500 mt-1'>Inclusive of all taxes</p>\r\n\r\n              <div className='mt-8'>\r\n                <h3 className='text-sm font-semibold text-gray-900 uppercase tracking-wider mb-3'>\r\n                  About Product\r\n                </h3>\r\n                <ul className='list-disc pl-5 space-y-2 text-gray-600'>\r\n                  {descriptionPoints.map((desc, index) => (\r\n                    <li key={index}>{desc}</li>\r\n                  ))}\r\n                </ul>\r\n              </div>\r\n\r\n              <div className='flex flex-col s\n\n// ‚úÇÔ∏è Truncated for AI (original 6928 characters)",
  "src\\features\\product\\hooks\\useProductData.js": "import { useCallback } from 'react';\r\nimport { useAppDispatch, useAppSelector } from '@/lib/hooks'; \r\nimport { setLoadingStatus, setProducts, setError } from '../productSlice';\r\nimport { getProducts } from '../actions'; // Importing the Server Action\r\n\r\nexport const useProductData = () => {\r\n  const products = useAppSelector((state) => state.product.list);\r\n  const status = useAppSelector((state) => state.product.status);\r\n  const error = useAppSelector((state) => state.product.error);\r\n  \r\n  const dispatch = useAppDispatch();\r\n\r\n  const fetchProductsIfIdle = useCallback(async () => {\r\n    // Only fetch if we haven't already\r\n    if (status === 'idle') {\r\n      dispatch(setLoadingStatus('loading'));\r\n      \r\n      try {\r\n        // 1. Call the Server Action directly\r\n        const data = await getProducts();\r\n        \r\n        // FIX: Handle both Array (Legacy) and Object (Paginated) responses\r\n        let productList = [];\r\n        \r\n        if (Array.isArray(data)) {\r\n            // Old format: just an array\r\n            productList = data;\r\n        } else if (data && Array.isArray(data.products)) {\r\n            // New format: { products: [], pagination: {} }\r\n            productList = data.products;\r\n        }\r\n        \r\n        // 2. Dispatch success action with the extracted array\r\n        dispatch(setProducts(productList));\r\n      } catch (err) {\r\n        console.error(\"Failed to fetch products:\", err);\r\n        // 3. Dispatch error action\r\n        dispatch(setError(err.message || 'Failed to fetch products'));\r\n      }\r\n    }\r\n  }, [status, dispatch]);\r\n\r\n  return {\r\n    products,\r\n    status,\r\n    error,\r\n    fetchProductsIfIdle,\r\n  };\r\n};",
  "src\\features\\product\\models\\Product.js": "import mongoose from 'mongoose';\r\n\r\nconst ProductSchema = new mongoose.Schema({\r\n  name: { \r\n    type: String, \r\n    required: [true, 'Please provide a product name'], \r\n    trim: true, \r\n    maxlength: [100, 'Name cannot be more than 100 characters']\r\n  },\r\n  slug: {\r\n    type: String,\r\n    required: true,\r\n    unique: true,\r\n    index: true\r\n  },\r\n  category: {\r\n    type: String,\r\n    required: true,\r\n  },\r\n  series: { \r\n    type: String, \r\n    required: true,\r\n    index: true \r\n  }, \r\n  year: { \r\n    type: Number, \r\n    required: true,\r\n  },\r\n  images: [{ \r\n    type: String, \r\n    required: true \r\n  }],\r\n  price: { \r\n    type: Number, \r\n    required: true,\r\n    min: [0, 'Price cannot be negative'] \r\n  },\r\n  originalPrice: {\r\n    type: Number, \r\n  },\r\n  inStock: { \r\n    type: Boolean, \r\n    default: true \r\n  },\r\n  description: { \r\n    type: String,\r\n    required: false\r\n  },\r\n  // --- SEO Fields ---\r\n  seoTitle: { type: String, trim: true },\r\n  seoDescription: { type: String, trim: true },\r\n  seoKeywords: { type: String, trim: true }, // Comma separated strings\r\n  \r\n}, { timestamps: true });\r\n\r\nProductSchema.index({ series: 1, year: -1 });\r\n\r\nexport default mongoose.models.Product || mongoose.model('Product', ProductSchema);",
  "src\\features\\product\\productSlice.js": "import { createSlice } from '@reduxjs/toolkit';\r\n\r\nconst initialState = {\r\n  list: [],\r\n  status: 'idle', // 'idle' | 'loading' | 'succeeded' | 'failed'\r\n  error: null,\r\n};\r\n\r\nconst productSlice = createSlice({\r\n  name: 'product',\r\n  initialState,\r\n  reducers: {\r\n    // Standard synchronous actions\r\n    setLoadingStatus: (state, action) => {\r\n      state.status = action.payload;\r\n    },\r\n    setProducts: (state, action) => {\r\n      state.list = action.payload;\r\n      state.status = 'succeeded';\r\n      state.error = null;\r\n    },\r\n    setError: (state, action) => {\r\n      state.status = 'failed';\r\n      state.error = action.payload;\r\n    },\r\n    resetProductState: (state) => {\r\n      state.list = [];\r\n      state.status = 'idle';\r\n      state.error = null;\r\n    }\r\n  },\r\n});\r\n\r\nexport const { setLoadingStatus, setProducts, setError, resetProductState } = productSlice.actions;\r\nexport default productSlice.reducer;",
  "src\\features\\user\\actions.js": "\"use server\";\r\n\r\nimport dbConnect from '@/lib/db';\r\nimport Address from './models/Address';\r\nimport Order from '@/features/order/models/Order';\r\nimport { User } from '@/features/auth/models/User';\r\nimport { revalidatePath } from 'next/cache';\r\nimport mongoose from 'mongoose';\r\n\r\n// --- User Profile Actions ---\r\n\r\nexport const updateUserProfile = async (userId, data) => {\r\n  await dbConnect();\r\n\r\n  if (!mongoose.Types.ObjectId.isValid(userId)) {\r\n    return { error: \"Invalid User Session\" };\r\n  }\r\n\r\n  try {\r\n    // Prevent updating email/password via this simple route for security\r\n    const { email, password, isAdmin, ...safeData } = data;\r\n    \r\n    await User.findByIdAndUpdate(userId, safeData);\r\n    \r\n    revalidatePath('/profile');\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"Profile Update Error:\", error);\r\n    return { error: \"Failed to update profile.\" };\r\n  }\r\n};\r\n\r\n// --- Address Actions ---\r\n\r\nexport const getUserAddresses = async (userId) => {\r\n  await dbConnect();\r\n  \r\n  if (!mongoose.Types.ObjectId.isValid(userId)) {\r\n    console.error(\"Invalid User ID in getUserAddresses:\", userId);\r\n    return [];\r\n  }\r\n\r\n  const addresses = await Address.find({ userId }).lean();\r\n  \r\n  return addresses.map(addr => ({\r\n    ...addr,\r\n    _id: addr._id.toString(),\r\n    userId: addr.userId.toString(),\r\n    createdAt: addr.createdAt?.toISOString(),\r\n    updatedAt: addr.updatedAt?.toISOString(),\r\n  }));\r\n};\r\n\r\nexport const addAddress = async (userId, addressData) => {\r\n  await dbConnect();\r\n  \r\n  // FIX: Validate ID format to prevent App Crash\r\n  if (!mongoose.Types.ObjectId.isValid(userId)) {\r\n    return { error: \"Session invalid. Please sign out and sign in again.\" };\r\n  }\r\n\r\n  // Enforce Max 2 rule\r\n  const count = await Address.countDocuments({ userId });\r\n  if (count >= 2) {\r\n    return { error: \"Maximum of 2 addresses allowed.\" };\r\n  }\r\n\r\n  await Address.create({ userId, ...addressData });\r\n  revalidatePath('/profile');\r\n  return { success: true };\r\n};\r\n\r\nexport const updateAddress = async (userId, addressId, addressData) => {\r\n  await dbConnect();\r\n\r\n  if (!mongoose.Types.ObjectId.isValid(userId)) {\r\n    return { error: \"Session invalid.\" };\r\n  }\r\n\r\n  const updatedAddress = await Address.findOneAndUpdate(\r\n    { _id: addressId, userId }, \r\n    { ...addressData },\r\n    { new: true }\r\n  );\r\n\r\n  if (!updatedAddress) {\r\n    return { error: \"Address not found or unauthorized.\" };\r\n  }\r\n\r\n  revalidatePath('/profile');\r\n  return { success: true };\r\n};\r\n\r\nexport const deleteAddress = async (addressId) => {\r\n  await dbConnect();\r\n  await Address.findByIdAndDelete(addressId);\r\n  revalidatePath('/profile');\r\n  return { success: true };\r\n};\r\n\r\n// --- Order Actions ---\r\n\r\nexport const getUserOrders = async (userId) => {\r\n  await dbConnect();\r\n\r\n  if (!mongoose.Types.ObjectId.isValid(userId)) {\r\n    return [];\r\n  }\r\n\r\n  const orders = await Order.find({ userId }).sort({ createdAt: -1 }).lean();\r\n  \r\n  return orders.map(order => ({\r\n    ...order,\r\n    _id: order._id.toString(),\r\n    userId: order.userId.toString(),\r\n    createdAt: order.createdAt?.toISOString(),\r\n    updatedAt: order.updatedAt?.toISOString(),\r\n    items: order.items.map(item => ({\r\n        ...item, \r\n        _id: item._id?.toString() \r\n    }))\r\n  }));\r\n};",
  "src\\features\\user\\components\\AccountSettings.js": "\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { updateUserProfile } from \"../actions\";\r\nimport { useToast } from \"@/context/ToastContext\";\r\nimport { User, Phone, Mail, Loader2 } from \"lucide-react\";\r\n\r\nexport default function AccountSettings({ user }) {\r\n  const { addToast } = useToast();\r\n  const [isSaving, setIsSaving] = useState(false);\r\n  \r\n  const [formData, setFormData] = useState({\r\n    name: user.name || \"\",\r\n    phone: user.phone || \"\",\r\n    // Email is read-only for now\r\n  });\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setIsSaving(true);\r\n\r\n    const res = await updateUserProfile(user.id, formData);\r\n\r\n    if (res.success) {\r\n        addToast(\"Profile updated successfully\", \"success\");\r\n    } else {\r\n        addToast(res.error || \"Failed to update profile\", \"error\");\r\n    }\r\n    \r\n    setIsSaving(false);\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-2xl\">\r\n        <div className=\"mb-6\">\r\n            <h2 className=\"text-xl font-semibold text-gray-900\">Personal Information</h2>\r\n            <p className=\"text-sm text-gray-500\">Manage your personal details and contact info.</p>\r\n        </div>\r\n\r\n        <form onSubmit={handleSubmit} className=\"space-y-6 bg-white p-6 rounded-lg border border-gray-200 shadow-sm\">\r\n            \r\n            <div className=\"space-y-2\">\r\n                <label className=\"text-sm font-medium text-gray-700 flex items-center gap-2\">\r\n                    <User size={16} /> Full Name\r\n                </label>\r\n                <Input \r\n                    value={formData.name}\r\n                    onChange={(e) => setFormData({...formData, name: e.target.value})}\r\n                    placeholder=\"John Doe\"\r\n                    required\r\n                />\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n                <label className=\"text-sm font-medium text-gray-700 flex items-center gap-2\">\r\n                    <Phone size={16} /> Phone Number\r\n                </label>\r\n                <Input \r\n                    value={formData.phone}\r\n                    onChange={(e) => setFormData({...formData, phone: e.target.value})}\r\n                    placeholder=\"+1 234 567 890\"\r\n                    type=\"tel\"\r\n                />\r\n            </div>\r\n\r\n            <div className=\"space-y-2 opacity-60 cursor-not-allowed\">\r\n                <label className=\"text-sm font-medium text-gray-700 flex items-center gap-2\">\r\n                    <Mail size={16} /> Email Address\r\n                </label>\r\n                <Input \r\n                    value={user.email}\r\n                    disabled\r\n                    className=\"bg-gray-50\"\r\n                />\r\n                <p className=\"text-xs text-gray-400\">Email address cannot be changed directly.</p>\r\n            </div>\r\n\r\n            <div className=\"pt-4 border-t border-gray-100 flex justify-end\">\r\n                <Button type=\"submit\" disabled={isSaving} className=\"w-full sm:w-auto\">\r\n                    {isSaving && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                    Save Changes\r\n                </Button>\r\n            </div>\r\n        </form>\r\n    </div>\r\n  );\r\n}",
  "src\\features\\user\\components\\AddressManager.js": "\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Trash2, MapPin, Plus, Pencil, Loader2 } from \"lucide-react\";\r\nimport { addAddress, deleteAddress, updateAddress } from \"../actions\";\r\nimport { useToast } from \"@/context/ToastContext\";\r\n\r\nexport default function AddressManager({ addresses, userId }) {\r\n  const { addToast } = useToast();\r\n  const [isAdding, setIsAdding] = useState(false);\r\n  const [editingId, setEditingId] = useState(null);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [formData, setFormData] = useState({\r\n    street: \"\", city: \"\", state: \"\", zip: \"\", country: \"USA\"\r\n  });\r\n\r\n  const resetForm = () => {\r\n    setIsAdding(false);\r\n    setEditingId(null);\r\n    setFormData({ street: \"\", city: \"\", state: \"\", zip: \"\", country: \"USA\" });\r\n    setIsSubmitting(false);\r\n  };\r\n\r\n  const handleAddNew = () => {\r\n    setEditingId(null);\r\n    setFormData({ street: \"\", city: \"\", state: \"\", zip: \"\", country: \"USA\" });\r\n    setIsAdding(true);\r\n  };\r\n\r\n  const handleEdit = (addr) => {\r\n    setEditingId(addr._id);\r\n    setFormData({\r\n      street: addr.street,\r\n      city: addr.city,\r\n      state: addr.state,\r\n      zip: addr.zip,\r\n      country: addr.country\r\n    });\r\n    setIsAdding(true);\r\n  };\r\n\r\n  const handleSave = async (e) => {\r\n    e.preventDefault();\r\n    setIsSubmitting(true);\r\n    let res;\r\n\r\n    if (editingId) {\r\n      res = await updateAddress(userId, editingId, formData);\r\n    } else {\r\n      res = await addAddress(userId, formData);\r\n    }\r\n\r\n    if (res?.success) {\r\n      addToast(editingId ? \"Address updated successfully\" : \"Address added successfully\", \"success\");\r\n      resetForm();\r\n    } else {\r\n      addToast(res.error || \"Failed to save address\", \"error\");\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (id) => {\r\n    if(confirm(\"Are you sure you want to delete this address?\")) {\r\n        const res = await deleteAddress(id);\r\n        if (res.success) {\r\n            addToast(\"Address deleted\", \"success\");\r\n        } else {\r\n            addToast(\"Failed to delete address\", \"error\");\r\n        }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex justify-between items-center\">\r\n        <div>\r\n            <h2 className=\"text-xl font-semibold\">My Addresses</h2>\r\n            <p className=\"text-sm text-gray-500\">Manage your shipping destinations.</p>\r\n        </div>\r\n        {/* Only show Add button if limit not reached AND not currently editing/adding */}\r\n        {addresses.length < 2 && !isAdding && (\r\n          <Button onClick={handleAddNew} size=\"sm\" variant=\"outline\" className=\"gap-2\">\r\n            <Plus size={16} /> Add New\r\n          </Button>\r\n        )}\r\n      </div>\r\n\r\n      {isAdding && (\r\n        <form onSubmit={handleSave} className=\"bg-gray-50 p-4 rounded-lg border border-gray-200 grid grid-cols-1 md:grid-cols-2 gap-3 animate-in fade-in slide-in-from-top-2\">\r\n            <h3 className=\"md:col-span-2 font-medium text-gray-900 mb-2\">\r\n                {editingId ? \"Edit Address\" : \"Add New Address\"}\r\n            </h3>\r\n            <Input \r\n                placeholder=\"Street Address\" \r\n                value={formData.street} \r\n                onChange={e => setFormData({...formData, street: e.target.value})} \r\n                required \r\n                className=\"md:col-span-2\"\r\n            />\r\n            <Input \r\n                placeholder=\"City\" \r\n                value={formData.city} \r\n                onChange={e => setFormData({...formData, city: e.target.value})} \r\n                required \r\n            />\r\n            <Input \r\n                placeholder=\"State\" \r\n                value={formData.state} \r\n                onChange={e => setFormData({...formData, state: e.target.value})} \r\n                required \r\n            />\r\n            <Input \r\n                placeholder=\"ZIP Code\" \r\n                value={formData.zip} \r\n                onChange={e => setFormData({...formData, zip: e.target.value})} \r\n                required \r\n            />\r\n            <Input \r\n                placeholder=\"Country\" \r\n                value={formData.country} \r\n                onChange={e => setFormData({...formData, country: e.target.value})} \r\n                required \r\n            />\r\n            <div className=\"md:col-span-2 flex gap-2 justify-end mt-2\">\r\n                <Button type=\"button\" variant=\"ghost\" onClick={resetForm} disabled={isSubmitting}>Cancel</Button>\r\n                <Button type=\"submit\" disabled={isSubmitting}>\r\n                    {isSubmitting && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                    {editingId ? \"Update\" : \"Save\"} Address\r\n                </Button>\r\n            </div>\r\n        </form>\r\n      )}\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n        {addresses.map((addr) => (\r\n          <div key={addr._id} className=\"border border-gray-200 rounded-lg p-5 flex justify-between items-start bg-white shadow-sm hover:shadow-md transition\">\r\n            <div className=\"flex gap-3\">\r\n               <div className=\"bg-indigo-50 p-2 rounded-full h-fit text-indigo-600\">\r\n                  <MapPin size={20} />\r\n               </div>\r\n               <div>\r\n                  <p className=\"font-medium text-gray-900\">{addr.street}</p>\r\n                  <p className=\"text-gray-500 text-sm\">{addr.city}, {addr.state} {addr.zip}</p>\r\n                  <p className=\"text-gray-500 text-sm\">{addr.country}</p>\r\n               </div>\r\n            </div>\r\n            <div className=\"flex gap-1\">\r\n                <button \r\n                    onClick={() => handleEdit(addr)}\r\n                    className=\"text-gray-400 hover:text-indigo-600 transition p-2 rounded-full hover:bg-gray-100\"\r\n                    title=\"Edit Address\"\r\n                >\r\n                    <Pencil size={16} />\r\n                </button>\r\n      \n\n// ‚úÇÔ∏è Truncated for AI (original 6660 characters)",
  "src\\features\\user\\components\\OrderHistory.js": "\"use client\";\r\n\r\nimport { Badge } from \"@/components/ui/badge\";\r\n\r\nexport default function OrderHistory({ orders }) {\r\n  if (orders.length === 0) {\r\n    return (\r\n      <div className=\"text-center py-16\">\r\n        <div className=\"bg-gray-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n             <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"text-gray-400\"><path d=\"M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z\"></path><line x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\"></line><path d=\"M16 10a4 4 0 0 1-8 0\"></path></svg>\r\n        </div>\r\n        <h3 className=\"text-lg font-medium text-gray-900\">No Orders Yet</h3>\r\n        <p className=\"text-gray-500\">Looks like you haven't placed an order yet.</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <h2 className=\"text-xl font-semibold mb-4\">Order History</h2>\r\n      {orders.map((order) => (\r\n        <div key={order._id} className=\"border border-gray-200 rounded-lg overflow-hidden bg-white shadow-sm\">\r\n          <div className=\"bg-gray-50 px-6 py-4 flex flex-col md:flex-row justify-between md:items-center gap-4 border-b border-gray-200\">\r\n            <div className=\"flex gap-6 text-sm\">\r\n                <div>\r\n                    <p className=\"text-gray-500 uppercase text-xs font-bold tracking-wider\">Order Placed</p>\r\n                    <p className=\"font-medium text-gray-900\">{new Date(order.createdAt).toLocaleDateString()}</p>\r\n                </div>\r\n                <div>\r\n                    <p className=\"text-gray-500 uppercase text-xs font-bold tracking-wider\">Total</p>\r\n                    <p className=\"font-medium text-gray-900\">${order.totalAmount}</p>\r\n                </div>\r\n                <div>\r\n                     <p className=\"text-gray-500 uppercase text-xs font-bold tracking-wider\">Order #</p>\r\n                     <p className=\"font-medium text-gray-900 truncate w-24 md:w-auto\">{order._id.slice(-6).toUpperCase()}</p>\r\n                </div>\r\n            </div>\r\n            \r\n            <div>\r\n                 <Badge className={`\r\n                    ${order.status === 'Delivered' ? 'bg-green-100 text-green-700 hover:bg-green-100' : ''}\r\n                    ${order.status === 'Shipped' ? 'bg-purple-100 text-purple-700 hover:bg-purple-100' : ''}\r\n                    ${order.status === 'Pending' ? 'bg-yellow-100 text-yellow-700 hover:bg-yellow-100' : ''}\r\n                    ${order.status === 'Cancelled' ? 'bg-red-100 text-red-700 hover:bg-red-100' : ''}\r\n                 `}>\r\n                    {order.status}\r\n                 </Badge>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"p-6\">\r\n             {order.items.map((item, idx) => (\r\n                 <div key={idx} className=\"flex gap-4 mb-4 last:mb-0\">\r\n                     <div className=\"w-16 h-16 bg-gray-100 rounded-md overflow-hidden shrink-0\">\r\n                         {item.image ? (\r\n                            <img src={item.image} alt={item.name} className=\"w-full h-full object-cover mix-blend-multiply\" />\r\n                         ) : (\r\n                            <div className=\"w-full h-full flex items-center justify-center text-xs text-gray-400\">N/A</div>\r\n                         )}\r\n                     </div>\r\n                     <div>\r\n                         <h4 className=\"font-medium text-gray-900\">{item.name}</h4>\r\n                         <p className=\"text-sm text-gray-500\">Qty: {item.quantity} √ó ${item.price}</p>\r\n                     </div>\r\n                 </div>\r\n             ))}\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n} ",
  "src\\features\\user\\components\\UserProfile.js": "\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport AddressManager from \"./AddressManager\";\r\nimport OrderHistory from \"./OrderHistory\";\r\nimport AccountSettings from \"./AccountSettings\"; // Import new component\r\nimport { User, Package, MapPin, LogOut, Settings } from \"lucide-react\";\r\nimport { signOut } from \"next-auth/react\";\r\n\r\nexport default function UserProfile({ user, addresses, orders }) {\r\n  const [activeTab, setActiveTab] = useState(\"orders\");\r\n\r\n  const menuItems = [\r\n    { id: \"orders\", label: \"My Orders\", icon: <Package size={20} /> },\r\n    { id: \"addresses\", label: \"Addresses\", icon: <MapPin size={20} /> },\r\n    { id: \"settings\", label: \"Account Settings\", icon: <Settings size={20} /> },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"max-w-6xl mx-auto px-4 py-8 md:py-12 flex flex-col md:flex-row gap-8\">\r\n       \r\n       {/* Sidebar */}\r\n       <aside className=\"w-full md:w-64 shrink-0 space-y-6\">\r\n          <div className=\"flex items-center gap-4 p-4 bg-white border border-gray-200 rounded-xl shadow-sm\">\r\n             <div className=\"w-12 h-12 rounded-full bg-gray-100 overflow-hidden shrink-0\">\r\n                {user.image ? (\r\n                    <img src={user.image} alt=\"Profile\" className=\"w-full h-full object-cover\" />\r\n                ) : (\r\n                    <div className=\"flex items-center justify-center h-full text-gray-400\">\r\n                        <User size={24} />\r\n                    </div>\r\n                )}\r\n             </div>\r\n             <div className=\"overflow-hidden\">\r\n                <h2 className=\"font-bold text-gray-900 truncate\">{user.name}</h2>\r\n                <p className=\"text-xs text-gray-500 truncate\">{user.email}</p>\r\n             </div>\r\n          </div>\r\n\r\n          <nav className=\"space-y-1\">\r\n             {menuItems.map((item) => (\r\n                 <button \r\n                    key={item.id}\r\n                    onClick={() => setActiveTab(item.id)}\r\n                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg font-medium transition ${activeTab === item.id ? 'bg-indigo-50 text-indigo-600' : 'text-gray-600 hover:bg-gray-50'}`}\r\n                 >\r\n                    {item.icon} {item.label}\r\n                 </button>\r\n             ))}\r\n             \r\n             <hr className=\"my-2 border-gray-100\" />\r\n             \r\n             <button \r\n                onClick={() => signOut({ callbackUrl: '/' })}\r\n                className=\"w-full flex items-center gap-3 px-4 py-3 rounded-lg font-medium text-red-600 hover:bg-red-50 transition\"\r\n             >\r\n                <LogOut size={20} /> Logout\r\n             </button>\r\n          </nav>\r\n       </aside>\r\n\r\n       {/* Main Content */}\r\n       <main className=\"flex-1 bg-white border border-gray-200 rounded-xl shadow-sm p-6 md:p-8 min-h-[500px]\">\r\n           {activeTab === 'orders' && <OrderHistory orders={orders} />}\r\n           {activeTab === 'addresses' && <AddressManager addresses={addresses} userId={user.id} />}\r\n           {activeTab === 'settings' && <AccountSettings user={user} />}\r\n       </main>\r\n    </div>\r\n  );\r\n}",
  "src\\features\\user\\models\\Address.js": "  import mongoose from 'mongoose';\r\n\r\n  const AddressSchema = new mongoose.Schema({\r\n    userId: {\r\n      type: mongoose.Schema.Types.ObjectId,\r\n      ref: 'User',\r\n      required: true,\r\n    },\r\n    street: { type: String, required: true },\r\n    city: { type: String, required: true },\r\n    state: { type: String, required: true },\r\n    zip: { type: String, required: true },\r\n    country: { type: String, required: true },\r\n  }, { timestamps: true });\r\n\r\n  export default mongoose.models.Address || mongoose.model('Address', AddressSchema);",
  "src\\lib\\auth.config.js": "import GoogleProvider from \"next-auth/providers/google\";\r\nimport CredentialsProvider from \"next-auth/providers/credentials\";\r\nimport { User } from \"@/features/auth/models/User\";\r\nimport dbConnect from \"@/lib/db\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\nexport const authOptions = {\r\n  providers: [\r\n    GoogleProvider({\r\n      clientId: process.env.GOOGLE_CLIENT_ID,\r\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET,\r\n    }),\r\n    CredentialsProvider({\r\n      name: \"credentials\",\r\n      credentials: {\r\n        email: { label: \"Email\", type: \"email\" },\r\n        password: { label: \"Password\", type: \"password\" },\r\n      },\r\n      async authorize(credentials) {\r\n        await dbConnect();\r\n        \r\n        const user = await User.findOne({ email: credentials.email });\r\n        \r\n        if (!user || !user.password) {\r\n           throw new Error(\"Invalid email or password\");\r\n        }\r\n\r\n        // CRITICAL: Check verification status\r\n        // We throw a specific string \"unverified\" to catch it in the UI\r\n        if (!user.isVerified) {\r\n            throw new Error(\"unverified\");\r\n        }\r\n\r\n        const isMatch = await bcrypt.compare(credentials.password, user.password);\r\n        if (!isMatch) {\r\n           throw new Error(\"Invalid email or password\");\r\n        }\r\n\r\n        return {\r\n            id: user._id.toString(),\r\n            name: user.name,\r\n            email: user.email,\r\n            image: user.image,\r\n            role: user.isAdmin ? \"admin\" : \"user\"\r\n        };\r\n      },\r\n    }),\r\n  ],\r\n  callbacks: {\r\n    async signIn({ user, account }) {\r\n      if (account.provider === \"google\") {\r\n        try {\r\n          await dbConnect();\r\n          const existingUser = await User.findOne({ email: user.email });\r\n          \r\n          if (!existingUser) {\r\n            // Create new Google user (Auto Verified)\r\n            await User.create({\r\n              name: user.name,\r\n              email: user.email,\r\n              image: user.image,\r\n              provider: \"google\",\r\n              isAdmin: false,\r\n              isVerified: true, \r\n            });\r\n          } else if (!existingUser.isVerified) {\r\n            // Existing unverified user logging in with Google -> Verify them now\r\n            existingUser.isVerified = true;\r\n            existingUser.provider = \"google\"; \r\n            await existingUser.save();\r\n          }\r\n          return true;\r\n        } catch (error) {\r\n          console.error(\"Error saving Google user:\", error);\r\n          return false;\r\n        }\r\n      }\r\n      return true; \r\n    },\r\n    \r\n    async jwt({ token, user, account }) {\r\n        if (user) {\r\n            token.id = user.id;\r\n            token.role = user.role;\r\n        }\r\n        \r\n        // Sync with DB for Google Logins to get role/id\r\n        if (account?.provider === \"google\") {\r\n            await dbConnect();\r\n            const dbUser = await User.findOne({ email: token.email });\r\n            if (dbUser) {\r\n                token.id = dbUser._id.toString();\r\n                token.role = dbUser.isAdmin ? \"admin\" : \"user\";\r\n                token.picture = dbUser.image || token.picture;\r\n            }\r\n        }\r\n        return token;\r\n    },\r\n\r\n    async session({ session, token }) {\r\n        if (session.user) {\r\n            session.user.id = token.id;\r\n            session.user.role = token.role;\r\n            session.user.image = token.picture;\r\n        }\r\n        return session;\r\n    }\r\n  },\r\n  pages: {\r\n    signIn: \"/login\",\r\n  },\r\n  session: {\r\n    strategy: \"jwt\",\r\n  },\r\n  secret: process.env.NEXTAUTH_SECRET,\r\n};",
  "src\\lib\\db.js": "import mongoose from 'mongoose';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI;\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error('Please define the MONGODB_URI environment variable inside .env.local');\r\n}\r\n\r\nlet cached = global.mongoose;\r\n\r\nif (!cached) {\r\n  cached = global.mongoose = { conn: null, promise: null };\r\n}\r\n\r\nasync function dbConnect() {\r\n  if (cached.conn) {\r\n    return cached.conn;\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n\r\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\r\n      return mongoose;\r\n    });\r\n  }\r\n\r\n  try {\r\n    cached.conn = await cached.promise;\r\n  } catch (e) {\r\n    cached.promise = null;\r\n    throw e;\r\n  }\r\n\r\n  return cached.conn;\r\n}\r\n\r\n/**\r\n * Executes a function within a transaction if possible.\r\n * Implements a Retry-on-Fail pattern for Standalone MongoDB instances.\r\n * * @param {Function} handler - Async function(session) => Promise\r\n */\r\nexport async function withTransaction(handler) {\r\n  await dbConnect();\r\n  const session = await mongoose.startSession();\r\n\r\n  try {\r\n    session.startTransaction();\r\n    // Execute handler with session\r\n    const result = await handler(session);\r\n    await session.commitTransaction();\r\n    return result;\r\n  } catch (error) {\r\n    // Attempt abort, but wrap in try-catch because aborting on standalone might also throw\r\n    try {\r\n        await session.abortTransaction();\r\n    } catch (abortError) {\r\n        // Ignore abort error if it's the transaction support error\r\n    }\r\n\r\n    // Check for \"Transaction numbers are only allowed on a replica set member\" error (Code 20)\r\n    // or similar topology errors\r\n    if (error.code === 20 || error.message?.includes('Transaction numbers are only allowed')) {\r\n      console.warn(\"‚ö†Ô∏è Transaction failed (Standalone DB detected). Retrying in non-transactional mode.\");\r\n      // Retry without a transaction session (passing null lets mongoose execute normally)\r\n      return await handler(null);\r\n    }\r\n\r\n    // Re-throw critical errors (validation, logic errors, etc.) that happened inside the transaction\r\n    throw error;\r\n  } finally {\r\n    await session.endSession();\r\n  }\r\n}\r\n\r\nexport default dbConnect;",
  "src\\lib\\hooks.js": "import { useDispatch, useSelector, useStore } from 'react-redux';\r\n\r\n// Use these throughout your app instead of plain `useDispatch` and `useSelector`\r\nexport const useAppDispatch = useDispatch.withTypes();\r\nexport const useAppSelector = useSelector.withTypes();\r\nexport const useAppStore = useStore.withTypes();",
  "src\\lib\\mail.js": "import nodemailer from \"nodemailer\";\r\n\r\nconst transporter = nodemailer.createTransport({\r\n  service: \"gmail\",\r\n  auth: {\r\n    user: process.env.SMTP_EMAIL,\r\n    pass: process.env.SMTP_PASSWORD, \r\n  },\r\n});\r\n\r\nexport const sendVerificationEmail = async (email, token) => {\r\n  const confirmLink = `${process.env.NEXTAUTH_URL}/verify-email?token=${token}`;\r\n\r\n  const mailOptions = {\r\n    from: `\"Dream Collection\" <${process.env.SMTP_EMAIL}>`,\r\n    to: email,\r\n    subject: \"Verify your email\",\r\n    html: `\r\n      <div style=\"font-family: sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; border: 1px solid #e5e7eb; border-radius: 8px;\">\r\n        <h2 style=\"color: #4F46E5; text-align: center;\">Welcome to Dream Collection!</h2>\r\n        <p style=\"color: #374151; font-size: 16px;\">Hi there,</p>\r\n        <p style=\"color: #374151; line-height: 1.5;\">Please verify your email address to activate your account and start collecting.</p>\r\n        \r\n        <div style=\"text-align: center; margin: 30px 0;\">\r\n          <a href=\"${confirmLink}\" style=\"background-color: #4F46E5; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: bold; font-size: 16px;\">Verify Email</a>\r\n        </div>\r\n        <p style=\"color: #6B7280; font-size: 12px; text-align: center;\">Link expires in 24 hours.</p>\r\n      </div>\r\n    `,\r\n  };\r\n\r\n  try {\r\n    await transporter.sendMail(mailOptions);\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"Email error:\", error);\r\n    return { success: false, error: \"Failed to send email\" };\r\n  }\r\n};\r\n\r\nexport const sendPasswordResetEmail = async (email, resetToken) => {\r\n  const resetUrl = `${process.env.NEXTAUTH_URL}/reset-password/${resetToken}`;\r\n\r\n  const mailOptions = {\r\n    from: `\"Dream Collection Support\" <${process.env.SMTP_EMAIL}>`,\r\n    to: email,\r\n    subject: \"Reset Your Password\",\r\n    html: `\r\n      <div style=\"font-family: sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; border: 1px solid #e5e7eb; border-radius: 8px;\">\r\n        <h2 style=\"color: #4F46E5;\">Reset Password</h2>\r\n        <p>Click below to reset your password:</p>\r\n        <a href=\"${resetUrl}\" style=\"background-color: #4F46E5; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;\">Reset Password</a>\r\n      </div>\r\n    `,\r\n  };\r\n\r\n  try {\r\n    await transporter.sendMail(mailOptions);\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { success: false };\r\n  }\r\n};",
  "src\\lib\\payment-adapters.js": "import Stripe from 'stripe';\r\nimport Razorpay from 'razorpay';\r\n\r\nexport const initiatePayment = async (gatewayId, order, settings) => {\r\n  // Find config for the selected gateway\r\n  const gatewaySettings = settings.paymentGateways.find(g => g.id === gatewayId);\r\n  const config = gatewaySettings?.config || {};\r\n\r\n  if (!gatewaySettings || !gatewaySettings.enabled) {\r\n    throw new Error(`Payment method ${gatewayId} is not available.`);\r\n  }\r\n\r\n  switch (gatewayId) {\r\n    case 'stripe':\r\n      return await createStripeIntent(order, config);\r\n    case 'razorpay':\r\n      return await createRazorpayOrder(order, config);\r\n    default:\r\n      throw new Error(`Unsupported gateway: ${gatewayId}`);\r\n  }\r\n};\r\n\r\nconst createStripeIntent = async (order, config) => {\r\n  // FIX: Trim keys to prevent whitespace errors\r\n  const secretKey = config.secretKey?.trim();\r\n  const publishableKey = config.publishableKey?.trim();\r\n\r\n  if (!secretKey) throw new Error(\"Stripe Secret Key missing in settings\");\r\n\r\n  try {\r\n    const stripe = new Stripe(secretKey);\r\n    \r\n    // Create PaymentIntent\r\n    const paymentIntent = await stripe.paymentIntents.create({\r\n      amount: Math.round(order.totalAmount * 100), // Stripe expects cents\r\n      currency: (config.currency || 'usd').toLowerCase(), \r\n      metadata: { orderId: order._id.toString() },\r\n      automatic_payment_methods: { enabled: true },\r\n    });\r\n\r\n    return {\r\n      clientSecret: paymentIntent.client_secret,\r\n      publishableKey: publishableKey,\r\n      type: 'stripe'\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Stripe Init Error:\", error);\r\n    // Return generic error to client\r\n    throw new Error(\"Payment system misconfigured. Please contact support.\");\r\n  }\r\n};\r\n\r\nconst createRazorpayOrder = async (order, config) => {\r\n  // FIX: Trim keys\r\n  const keyId = config.keyId?.trim();\r\n  const keySecret = config.keySecret?.trim();\r\n\r\n  if (!keyId || !keySecret) throw new Error(\"Razorpay Keys missing in settings\");\r\n\r\n  try {\r\n    const razorpay = new Razorpay({\r\n      key_id: keyId,\r\n      key_secret: keySecret,\r\n    });\r\n\r\n    const options = {\r\n      amount: Math.round(order.totalAmount * 100), // Razorpay expects paise\r\n      currency: config.currency || \"INR\",\r\n      receipt: order._id.toString(),\r\n    };\r\n\r\n    const razorpayOrder = await razorpay.orders.create(options);\r\n\r\n    return {\r\n      orderId: razorpayOrder.id,\r\n      keyId: keyId,\r\n      amount: options.amount,\r\n      currency: options.currency,\r\n      type: 'razorpay'\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Razorpay Init Error:\", error);\r\n    throw new Error(\"Payment system misconfigured. Please contact support.\");\r\n  }\r\n};",
  "src\\lib\\store.js": "import { configureStore } from \"@reduxjs/toolkit\";\r\nimport cartReducer from \"../features/cart/cartSlice\"; // We will create this next\r\nimport productReducer from \"@/features/product/productSlice\";\r\nimport authReducer from \"../features/auth/authSlice\";\r\n\r\n// Function to create the store (essential for Next.js SSR to avoid state pollution)\r\nexport const makeStore = () => {\r\n  return configureStore({\r\n    reducer: {\r\n      // Add your feature reducers here\r\n      cart: cartReducer,\r\n      product: productReducer,\r\n      auth: authReducer,\r\n      // user: userReducer,\r\n    },\r\n  });\r\n};\r\n",
  "src\\lib\\StoreProvider.js": "'use client';\r\n\r\nimport { useRef } from 'react';\r\nimport { Provider } from 'react-redux';\r\nimport { makeStore } from './store';\r\n\r\nexport default function StoreProvider({ children }) {\r\n  const storeRef = useRef();\r\n\r\n  if (!storeRef.current) {\r\n    // Create the store instance the first time this renders\r\n    storeRef.current = makeStore();\r\n  }\r\n\r\n  return <Provider store={storeRef.current}>{children}</Provider>;\r\n}",
  "src\\lib\\utils.js": "import { clsx } from \"clsx\";\r\nimport { twMerge } from \"tailwind-merge\"\r\n\r\nexport function cn(...inputs) {\r\n  return twMerge(clsx(inputs));\r\n}\r\n",
  "src\\middleware.js": "import { NextResponse } from \"next/server\";\r\nimport { getToken } from \"next-auth/jwt\";\r\n\r\nexport async function middleware(req) {\r\n  const path = req.nextUrl.pathname;\r\n\r\n  // 1. Check if the route is protected (Admin Routes)\r\n  if (path.startsWith(\"/admin\")) {\r\n    // Get the token (decodes the NextAuth JWT securely)\r\n    const token = await getToken({ \r\n      req, \r\n      secret: process.env.NEXTAUTH_SECRET \r\n    });\r\n\r\n    // Case A: User is NOT logged in\r\n    if (!token) {\r\n      const url = new URL(\"/login\", req.url);\r\n      url.searchParams.set(\"callbackUrl\", path); // Preserve the intended destination\r\n      return NextResponse.redirect(url);\r\n    }\r\n\r\n    // Case B: User IS logged in, but NOT an Admin\r\n    if (token.role !== \"admin\") {\r\n      // Redirect to Home\r\n      return NextResponse.redirect(new URL(\"/\", req.url));\r\n    }\r\n  }\r\n\r\n  // Allow access if checks pass\r\n  return NextResponse.next();\r\n}\r\n\r\nexport const config = {\r\n  // Apply this middleware only to admin routes\r\n  matcher: [\"/admin\", \"/admin/:path*\"],\r\n};"
}